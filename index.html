<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tamacoin Fishing Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #87CEEB; overflow: hidden; font-family: sans-serif; }
        
        /* –°—Ü–µ–Ω–∞ –æ–∑–µ—Ä–∞ */
        .lake { position: relative; width: 100vw; height: 60vh; background: linear-gradient(180deg, #4da6ff, #0066cc); border-bottom: 5px solid #004d99; }
        
        /* –ö–∞–º—ã—à–∏ */
        .reed { position: absolute; bottom: 0; width: 20px; height: 100px; background: #2d5a27; border-radius: 10px 10px 0 0; }
        .reed::after { content: ''; position: absolute; top: -20px; left: 0; width: 20px; height: 40px; background: #4b3621; border-radius: 10px; }
        
        /* –û–±–ª–∞–∫–∞ */
        .cloud { position: absolute; background: white; width: 60px; height: 20px; border-radius: 20px; opacity: 0.8; animation: moveClouds 20s linear infinite; }
        @keyframes moveClouds { from { left: -100px; } to { left: 100vw; } }

        /* –£–¥–æ—á–∫–∞ –∏ –ü–æ–ø–ª–∞–≤–æ–∫ */
        .rod { position: absolute; right: 20%; bottom: 80px; width: 5px; height: 150px; background: #4b3621; transform: rotate(45deg); transition: 0.5s; }
        .line { position: absolute; top: 0; left: 2px; width: 1px; height: 200px; background: white; transform: rotate(-45deg); transform-origin: top; }
        .bobber { position: absolute; bottom: -200px; left: -140px; width: 15px; height: 25px; background: red; border-radius: 50% 50% 5px 5px; border: 2px solid white; display: none; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∫–ª–µ–≤–∫–∏ */
        .bite { animation: shake 0.5s infinite; }
        @keyframes shake { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(10px); } }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .ui { height: 40vh; background: #1a2a6c; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; }
        .btn { background: #4CAF50; border: none; color: white; padding: 15px; width: 100%; font-size: 18px; border-radius: 12px; font-weight: bold; margin-bottom: 10px; }
        #status { color: #88bdff; text-align: center; font-size: 14px; }
    </style>
</head>
<body>

    <div class="lake">
        <div class="cloud" style="top: 20px; animation-duration: 25s;"></div>
        <div class="cloud" style="top: 60px; animation-duration: 35s; left: 50%;"></div>
        
        <div class="reed" style="left: 10px; height: 120px;"></div>
        <div class="reed" style="left: 40px; height: 90px;"></div>
        <div class="reed" style="right: 20px; height: 110px;"></div>

        <div class="rod" id="rod">
            <div class="line">
                <div class="bobber" id="bobber"></div>
            </div>
        </div>
    </div>

    <div class="ui">
        <button class="btn" id="catchBtn" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
        <button class="btn" style="background:#f44336" onclick="sendAction('sell_fish')">–ü–†–û–î–ê–¢–¨ –í–ï–°–¨ –£–õ–û–í üí∞</button>
        <div id="status">–ì–æ—Ç–æ–≤ –∫ —Ä—ã–±–∞–ª–∫–µ</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const SERVER_URL = 'https://tama-bot-server.onrender.com/api/action';

        async function startFishing() {
            const bobber = document.getElementById('bobber');
            const status = document.getElementById('status');
            const btn = document.getElementById('catchBtn');

            btn.disabled = true;
            status.innerText = "–ó–∞–±—Ä–∞—Å—ã–≤–∞–µ–º... –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–∫–ª–µ–≤–∫–∏...";
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–ª–∞–≤–æ–∫ –∏ –≤–∫–ª—é—á–∞–µ–º "—Ç—Ä—è—Å–∫—É" —á–µ—Ä–µ–∑ 1 —Å–µ–∫
            bobber.style.display = 'block';
            setTimeout(() => { bobber.classList.add('bite'); }, 1000);

            // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            setTimeout(async () => {
                await sendAction('catch_fish');
                bobber.style.display = 'none';
                bobber.classList.remove('bite');
                btn.disabled = false;
            }, 3500);
        }

        async function sendAction(actionName) {
            const status = document.getElementById('status');
            const user = tg.initDataUnsafe?.user;

            try {
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: user.id, action: actionName })
                });

                if (response.ok) {
                    status.innerText = "‚úÖ –£—Å–ø–µ—à–Ω–æ! –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —á–∞—Ç–µ.";
                    if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                }
            } catch (e) {
                status.innerText = "‚ùå –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º";
            }
        }
    </script>
</body>
</html>
