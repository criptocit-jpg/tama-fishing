<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Fishing MONOLITH v4.2.3</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --gold: #FFD700;
            --gold-dark: #B8860B;
            --blue: #0088CC;
            --bg: #050810;
            --glass: rgba(255, 255, 255, 0.07);
            --border: rgba(255, 255, 255, 0.12);
        }

        body {
            margin: 0; padding: 0; background: var(--bg); color: white;
            font-family: -apple-system, system-ui, sans-serif;
            overflow: hidden; user-select: none; -webkit-tap-highlight-color: transparent;
        }

        /* –®–ê–ü–ö–ê */
        .header {
            background: linear-gradient(180deg, #1a1f2c 0%, #050810 100%);
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .rank-badge {
            background: var(--gold); color: #000; padding: 2px 8px;
            border-radius: 4px; font-size: 10px; font-weight: 900; margin-top: 4px;
        }

        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .balance-box { text-align: center; padding: 25px 0; }
        .balance-main { font-size: 45px; font-weight: 900; }
        .balance-main span { color: var(--gold); }

        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; padding: 0 15px;
        }

        .stat-card {
            background: var(--glass); border: 1px solid var(--border);
            padding: 12px 5px; border-radius: 18px; text-align: center;
        }

        .stat-card small { display: block; font-size: 9px; color: #556080; font-weight: 800; margin-bottom: 4px; }
        .stat-card b { font-size: 16px; }

        /* –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê */
        .lake {
            margin: 15px; height: 200px; background: rgba(0,0,0,0.4);
            border-radius: 30px; border: 1px solid var(--border);
            position: relative; display: flex; align-items: center; justify-content: center;
            overflow: hidden; transition: 0.3s;
        }

        .lake.sea-mode {
            background: radial-gradient(circle, #001a33 0%, #050810 100%);
            border-color: var(--blue); box-shadow: inset 0 0 30px rgba(0,136,204,0.3);
        }

        #splash-anim {
            position: absolute; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(0,136,204,0.2) 0%, transparent 70%);
            display: none; pointer-events: none;
        }

        #bag-captcha {
            position: absolute; width: 70px; display: none;
            filter: drop-shadow(0 0 15px var(--gold)); cursor: pointer; z-index: 100;
        }

        /* –ö–ù–û–ü–ö–ò */
        .btn {
            width: 90%; margin: 8px auto; border: none; border-radius: 20px;
            padding: 16px; font-size: 16px; font-weight: 900; color: white;
            cursor: pointer; text-transform: uppercase; display: block;
        }
        .btn-blue { background: linear-gradient(180deg, var(--blue), #005580); }
        .btn-gold { background: linear-gradient(180deg, var(--gold), var(--gold-dark)); color: black; }

        /* –ú–û–î–ê–õ–ö–ê –Ø–©–ò–ö–ê */
        #box-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none; z-index: 1000;
            flex-direction: column; align-items: center; justify-content: center;
        }

        .box-img { width: 160px; animation: shake 0.5s infinite; }
        @keyframes shake { 0%,100%{transform:rotate(0)} 25%{transform:rotate(5deg)} 75%{transform:rotate(-5deg)} }

        /* –°–¢–†–ê–ù–ò–¶–´ */
        .page { display: none; height: 100vh; flex-direction: column; overflow-y: auto; padding-bottom: 100px; }
        .page.active { display: flex; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav {
            position: fixed; bottom: 0; width: 100%; height: 80px;
            background: #0a0e17; display: flex; border-top: 1px solid var(--border);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-link {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: #444; text-decoration: none; font-size: 10px;
        }
        .nav-link.active { color: var(--gold); }
        .nav-link span { font-size: 20px; margin-bottom: 3px; }

        /* –ò–ù–§–û –ë–õ–û–ö */
        .info-card { background: var(--glass); margin: 15px; padding: 20px; border-radius: 20px; border: 1px solid var(--border); }
        .info-card h3 { margin-top: 0; color: var(--gold); }
    </style>
</head>
<body>

    <div id="box-modal">
        <div id="box-stage-1" style="text-align:center;">
            <img src="https://cdn-icons-png.flaticon.com/512/679/679821.png" class="box-img">
            <h2 style="color:var(--gold)">–û–¢–ö–†–´–í–ê–ï–ú –Ø–©–ò–ö...</h2>
        </div>
        <div id="box-stage-2" style="display:none; text-align:center;">
            <div id="prize-val" style="font-size: 50px; color: var(--gold); font-weight: 900;">+0</div>
            <p>TC –ó–ê–ß–ò–°–õ–ï–ù–û –ù–ê –ë–ê–õ–ê–ù–°</p>
            <button class="btn btn-gold" style="width:180px" onclick="closeBox()">–ü–†–ò–ù–Ø–¢–¨</button>
        </div>
    </div>

    <div id="p-game" class="page active">
        <div class="header">
            <div><div id="u-name">–†–´–ë–ê–ö</div><div class="rank-badge" id="u-rank">–°–ê–õ–ê–ì–ê üå±</div></div>
            <div style="text-align:right"><small style="color:#556080">ID:</small> <span id="u-id" style="font-size:10px">---</span></div>
        </div>
        <div class="balance-box">
            <small style="color:#556080; letter-spacing:2px">–ë–ê–õ–ê–ù–°</small>
            <div class="balance-main"><span id="v-bal">0</span> <span>TC</span></div>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><small>–≠–ù–ï–†–ì–ò–Ø</small><b id="v-en">0</b></div>
            <div class="stat-card"><small>–£–î–û–ß–ö–ê</small><b id="v-dur">0%</b></div>
            <div class="stat-card"><small>–Ø–©–ò–ö–ò</small><b id="v-box" style="color:var(--gold)">0</b></div>
        </div>
        <div class="lake" id="lake-zone">
            <div id="splash-anim"></div>
            <img src="https://cdn-icons-png.flaticon.com/512/2953/2953363.png" id="bag-captcha" onclick="handleCaptcha()">
            <div id="status-text" style="position:absolute; bottom:15px; font-size:10px; opacity:0.5">–ì–û–¢–û–í –ö –ó–ê–ë–†–û–°–£</div>
        </div>
        <button class="btn btn-blue" id="fish-btn" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
        <button class="btn btn-gold" onclick="api('get_daily')">–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° üéÅ</button>
    </div>

    <div id="p-shop" class="page">
        <h2 style="padding:15px">–ú–ê–†–ö–ï–¢</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; padding:10px">
            <div class="stat-card"><b>–•–ª–µ–±</b><br><small>+5 –∑–∞–±—Ä–æ—Å–æ–≤</small><button class="btn btn-blue" style="padding:8px; font-size:11px" onclick="api('buy_tc',{itemId:'bread'})">50 TC</button></div>
            <div class="stat-card"><b>–ú–∞—Å–ª–æ</b><br><small>-50% –∏–∑–Ω–æ—Å</small><button class="btn btn-blue" style="padding:8px; font-size:11px" onclick="api('buy_tc',{itemId:'oil'})">150 TC</button></div>
            <div class="stat-card"><b>–†–µ–º–æ–Ω—Ç</b><br><small>–î–æ 100%</small><button class="btn btn-blue" style="padding:8px; font-size:11px" onclick="api('repair')">50 TC</button></div>
            <div class="stat-card" style="border-color:var(--gold)"><b>VIP</b><br><small>–ë–∏–ª–µ—Ç –≤ –º–æ—Ä–µ</small><button class="btn btn-gold" style="padding:8px; font-size:11px" onclick="api('buy_stars',{itemId:'sea_pass'})">‚≠êÔ∏è 250</button></div>
        </div>
    </div>

    <div id="p-prof" class="page">
        <h2 style="padding:15px">–ü–†–û–§–ò–õ–¨</h2>
        <div class="info-card" style="text-align:center">
            <small>–í–ï–° –£–õ–û–í–ê –í –°–£–ú–ö–ï</small>
            <div style="font-size:30px; font-weight:900; margin:10px 0" id="v-fish">0.00 –ö–ì</div>
            <button class="btn btn-blue" onclick="api('sell_fish')">–ü–†–û–î–ê–¢–¨ –í–ï–°–¨ –£–õ–û–í</button>
        </div>
        <button class="btn btn-gold" onclick="openBoxAnim()">–û–¢–ö–†–´–¢–¨ –Ø–©–ò–ö üì¶</button>
        <div class="info-card">
            <h3 style="font-size:14px">–†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê</h3>
            <p style="font-size:11px; color:#8892b0">–ü–æ–ª—É—á–∞–π—Ç–µ 10% –æ—Ç –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–∏ —Ä—ã–±—ã –≤–∞—à–∏–º–∏ –¥—Ä—É–∑—å—è–º–∏!</p>
            <button class="btn btn-gold" style="font-size:12px; padding:12px" onclick="copyRef()">–ö–û–ü–ò–†–û–í–ê–¢–¨ –°–°–´–õ–ö–£</button>
        </div>
    </div>

    <div id="p-info" class="page">
        <h2 style="padding:15px">–ò–ù–§–û–†–ú–ê–¶–ò–Ø</h2>
        <div class="info-card">
            <h3>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</h3>
            <p style="font-size:13px; line-height:1.5">1. –ù–∞–∂–∏–º–∞–π—Ç–µ "–ó–∞–±—Ä–æ—Å–∏—Ç—å", —á—Ç–æ–±—ã –ª–æ–≤–∏—Ç—å —Ä—ã–±—É.<br>2. –°–ª–µ–¥–∏—Ç–µ –∑–∞ —ç–Ω–µ—Ä–≥–∏–µ–π –∏ –ø—Ä–æ—á–Ω–æ—Å—Ç—å—é —É–¥–æ—á–∫–∏.<br>3. –ü—Ä–æ–¥–∞–≤–∞–π—Ç–µ —Ä—ã–±—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∑–∞ TC.<br>4. –ü–æ–∫—É–ø–∞–π—Ç–µ –Ω–∞–∂–∏–≤–∫—É –∏ –º–∞—Å–ª–æ –≤ –º–∞—Ä–∫–µ—Ç–µ.<br>5. –°–æ–±–∏—Ä–∞–π—Ç–µ —è—â–∏–∫–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –±–æ–Ω—É—Å—ã!</p>
        </div>
        <div class="info-card">
            <h3>–õ–æ–∫–∞—Ü–∏–∏</h3>
            <p style="font-size:13px"><b>–û–∑–µ—Ä–æ:</b> –ë–µ—Å–ø–ª–∞—Ç–Ω–æ. –†—ã–±–∞ –¥–æ 2.5 –∫–≥.<br><b>–ú–æ—Ä–µ:</b> –¢—Ä–µ–±—É–µ—Ç—Å—è VIP. –†—ã–±–∞ –¥–æ 10 –∫–≥ + —à–∞–Ω—Å –Ω–∞ –ó–æ–ª–æ—Ç–æ–≥–æ –ö–∞—Ä–ø–∞.</p>
        </div>
    </div>

    <nav class="nav">
        <a href="#" class="nav-link active" onclick="tab('p-game',this)"><span>üé£</span>–ò–≥—Ä–∞</a>
        <a href="#" class="nav-link" onclick="tab('p-shop',this)"><span>üõí</span>–ú–∞—Ä–∫–µ—Ç</a>
        <a href="#" class="nav-link" onclick="tab('p-prof',this)"><span>üë§</span>–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="#" class="nav-link" onclick="tab('p-info',this)"><span>‚ÑπÔ∏è</span>–ò–Ω—Ñ–æ</a>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        const API_URL = 'https://tama-bot-server.onrender.com/api/action';
        let user = {};

        tg.ready(); tg.expand();

        function tab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            el.classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        async function api(act, extra = {}) {
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: tg.initDataUnsafe?.user?.id || "7883085758",
                        userName: tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫",
                        action: act, ...extra
                    })
                });
                user = await res.json();
                render();
                if (user.msg && act !== 'load') tg.showAlert(user.msg);
                return user;
            } catch (e) { console.error(e); }
        }

        function render() {
            document.getElementById('v-bal').innerText = Math.floor(user.b).toLocaleString();
            document.getElementById('v-en').innerText = Math.floor(user.energy);
            document.getElementById('v-dur').innerText = Math.floor(user.durability) + '%';
            document.getElementById('v-box').innerText = user.boxes;
            document.getElementById('v-fish').innerText = (user.fish || 0).toFixed(2) + ' –ö–ì';
            document.getElementById('u-name').innerText = (user.n || "–†–´–ë–ê–ö").toUpperCase();
            document.getElementById('u-rank').innerText = user.level || "–°–ê–õ–ê–ì–ê üå±";
            document.getElementById('u-id').innerText = user.id;

            const lake = document.getElementById('lake-zone');
            if (user.location === 'sea') lake.classList.add('sea-mode');
            else lake.classList.remove('sea-mode');
        }

        function startFishing() {
            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–±—Ä–æ—Å–∞
            const splash = document.getElementById('splash-anim');
            const status = document.getElementById('status-text');
            const btn = document.getElementById('fish-btn');

            btn.disabled = true;
            status.innerText = "–ó–ê–ë–†–û–°...";
            splash.style.display = 'block';
            tg.HapticFeedback.impactOccurred('medium');

            setTimeout(() => {
                splash.style.display = 'none';
                btn.disabled = false;
                status.innerText = "–ì–û–¢–û–í –ö –ó–ê–ë–†–û–°–£";

                if ((user.castCount + 1) % 5 === 0) {
                    const bag = document.getElementById('bag-captcha');
                    bag.style.display = 'block';
                    bag.style.left = Math.random() * 60 + 10 + '%';
                    bag.style.top = Math.random() * 40 + 10 + '%';
                } else {
                    api('catch_fish');
                }
            }, 800);
        }

        function handleCaptcha() {
            document.getElementById('bag-captcha').style.display = 'none';
            api('catch_fish', { captchaPassed: true });
        }

        async function openBoxAnim() {
            if (user.boxes <= 0) return tg.showAlert("–ù–ï–¢ –î–û–°–¢–£–ü–ù–´–• –Ø–©–ò–ö–û–í!");
            document.getElementById('box-modal').style.display = 'flex';
            document.getElementById('box-stage-1').style.display = 'block';
            document.getElementById('box-stage-2').style.display = 'none';

            const res = await api('open_box');

            setTimeout(() => {
                document.getElementById('box-stage-1').style.display = 'none';
                document.getElementById('box-stage-2').style.display = 'block';
                document.getElementById('prize-val').innerText = '+' + (res.prize || 0);
                tg.HapticFeedback.notificationOccurred('success');
            }, 2000);
        }

        function closeBox() {
            document.getElementById('box-modal').style.display = 'none';
            api('load');
        }

        function copyRef() {
            const link = `https://t.me/Tamacoin_bot?start=${user.id}`;
            const el = document.createElement('textarea');
            el.value = link; document.body.appendChild(el);
            el.select(); document.execCommand('copy');
            document.body.removeChild(el);
            tg.showAlert("–°–°–´–õ–ö–ê –°–ö–û–ü–ò–†–û–í–ê–ù–ê!");
        }

        setInterval(() => api('load'), 15000);
        api('load');
    </script>
</body>
</html>
