<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Tamacoin Gold 3.4.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --blue: #0088CC; --bg: #050810; --glass: rgba(255,255,255,0.08); }
        body { margin: 0; background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; overflow: hidden; user-select: none; }
        
        .page { display: none; height: 100vh; padding: 20px; box-sizing: border-box; flex-direction: column; padding-bottom: 90px; overflow-y: auto; }
        .active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –®–∞–ø–∫–∞ */
        .header-ui { text-align: center; margin-bottom: 15px; flex-shrink: 0; }
        .balance-val { font-size: 42px; font-weight: 900; color: var(--gold); }
        .timer-box { font-size: 10px; color: #8892b0; font-family: monospace; letter-spacing: 1px; }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card { background: var(--glass); padding: 12px; border-radius: 18px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-card small { display: block; font-size: 9px; color: #8892b0; text-transform: uppercase; margin-bottom: 4px; }
        .stat-card b { font-size: 18px; }

        /* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
        .fishing-area { flex-grow: 1; display: flex; align-items: center; justify-content: center; min-height: 200px; }
        #fishAnim { width: 90%; max-height: 80%; object-fit: contain; display: none; filter: drop-shadow(0 0 30px var(--blue)); }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .item-card { background: var(--glass); border-radius: 18px; padding: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .item-icon { font-size: 24px; display: block; margin-bottom: 5px; }
        .price { color: var(--gold); font-size: 12px; font-weight: 800; display: block; margin: 5px 0; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { border: none; border-radius: 20px; font-weight: 800; font-size: 16px; cursor: pointer; width: 100%; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-blue { background: var(--blue); color: #fff; padding: 18px; box-shadow: 0 4px 15px rgba(0,136,204,0.3); }
        .btn-gold { background: var(--gold); color: #000; padding: 15px; margin-bottom: 8px; }
        .btn:active { transform: scale(0.96); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 80px; background: rgba(0,0,0,0.9); display: flex; border-top: 1px solid #222; backdrop-filter: blur(10px); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #555; text-decoration: none; font-weight: 700; }
        .nav-item.active { color: var(--gold); }
        .nav-item span { font-size: 22px; margin-bottom: 3px; }

        input { width: 100%; padding: 15px; border-radius: 15px; border: none; background: #151a25; color: #fff; margin: 8px 0; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="game" class="page active">
    <div class="header-ui">
        <div class="balance-val" id="b-val">0 TC</div>
        <div class="timer-box" id="timers">–ó–ê–ì–†–£–ó–ö–ê...</div>
    </div>
    <div class="stats-grid">
        <div class="stat-card"><small>–≠–ù–ï–†–ì–ò–Ø</small><b id="u-en">0</b></div>
        <div class="stat-card"><small>–ê–†–¢–ï–§–ê–ö–¢–´</small><b id="u-art">0/5</b></div>
    </div>
    <div class="fishing-area"><img src="fish_anim.webp" id="fishAnim"></div>
    <div style="background:var(--glass); padding:12px; border-radius:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
        <div style="font-size:12px;"><b>–ì–õ–£–ë–û–ö–û–í–û–î–ù–´–ô</b><br><small style="color:#888">–†–∏—Å–∫ –æ–±—Ä—ã–≤–∞ | –£–ª–æ–≤ x10</small></div>
        <input type="checkbox" id="isDeep" style="width:22px; height:22px; margin:0;">
    </div>
    <button class="btn btn-gold" onclick="doAction('get_bonus')">–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° üéÅ</button>
    <button class="btn btn-blue" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
</div>

<div id="shop" class="page">
    <h2 style="color:var(--blue)">–¢–û–†–ì–û–í–´–ô –£–ó–ï–õ üõí</h2>
    <div class="stat-card" style="border: 1px solid var(--blue); margin-bottom: 15px;">
        <small>–í–ê–® –£–õ–û–í –í –°–ê–î–ö–ï</small>
        <b style="font-size:24px;"><span id="shop-fish">0.00</span> –∫–≥</b>
        <button class="btn btn-blue" style="padding:10px; margin-top:10px; font-size:12px;" onclick="doAction('sell_fish')">–ü–†–û–î–ê–¢–¨ –ó–ê TC</button>
    </div>
    <div class="shop-grid">
        <div class="item-card"><span class="item-icon">üé£</span><small>–°–ø–∏–Ω–Ω–∏–Ω–≥ "Carbon"</small><span class="price">50 Stars</span><button class="btn btn-blue" style="padding:5px; font-size:10px;" onclick="buyItem()">–ö–£–ü–ò–¢–¨</button></div>
        <div class="item-card"><span class="item-icon">üîã</span><small>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</small><span class="price">10 Stars</span><button class="btn btn-blue" style="padding:5px; font-size:10px;" onclick="buyItem()">–ö–£–ü–ò–¢–¨</button></div>
        <div class="item-card"><span class="item-icon">üì°</span><small>–≠—Ö–æ–ª–æ—Ç</small><span class="price">120 Stars</span><button class="btn btn-blue" style="padding:5px; font-size:10px;" onclick="buyItem()">–ö–£–ü–ò–¢–¨</button></div>
        <div class="item-card"><span class="item-icon">üëë</span><small>–ó–æ–ª–æ—Ç–æ–π —á–µ—Ä–≤—å</small><span class="price">100 Stars</span><button class="btn btn-blue" style="padding:5px; font-size:10px;" onclick="buyItem()">–ö–£–ü–ò–¢–¨</button></div>
    </div>
</div>

<div id="wallet" class="page">
    <h2 style="color:var(--gold)">–í–´–í–û–î TC üí∞</h2>
    <div class="stat-card" style="margin-bottom:15px;">
        <small>–î–û–°–¢–£–ü–ù–û –î–õ–Ø –í–´–í–û–î–ê</small>
        <b id="withdraw-balance">0 TC</b>
    </div>
    <input type="text" id="wallet-addr" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ (TON)">
    <input type="number" id="withdraw-amount" placeholder="–°—É–º–º–∞ (–º–∏–Ω. 30,000)">
    <button class="btn btn-blue" onclick="withdraw()">–°–û–ó–î–ê–¢–¨ –ó–ê–Ø–í–ö–£</button>
</div>

<div id="info" class="page">
    <h2 style="color:var(--gold)">–ö–õ–£–ë –†–´–ë–ê–ö–û–í üë•</h2>
    <div class="stat-card">
        <h3>–ò–ù–§–û–†–ú–ê–¶–ò–Ø</h3>
        <p style="font-size:12px; color:#8892b0; line-height:1.4;">1 –∫–≥ = 0.5 TC. –ó–æ–ª–æ—Ç–æ–π —á–∞—Å: 19:00 (—É–ª–æ–≤ x2). –°–æ–±–µ—Ä–∏ 5 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ –ø–æ–ª—É—á–∏ 30,000 TC!</p>
    </div>
    <div class="stat-card" style="margin-top:15px;">
        <h3>–ü–†–ò–ì–õ–ê–°–ò –î–†–£–ì–ê</h3>
        <p style="font-size:11px; color:#8892b0;">–î–∞–µ–º 1 –ö–æ—Ä–æ–±–∫—É –£–¥–∞—á–∏ –∑–∞ –∫–∞–∂–¥–æ–≥–æ!</p>
        <code id="ref-link" style="background:#000; padding:10px; display:block; border-radius:10px; color:var(--gold); font-size:11px;">loading...</code>
        <button class="btn btn-gold" style="padding:10px; margin-top:10px;" onclick="copyRef()">–ö–û–ü–ò–†–û–í–ê–¢–¨ –°–°–´–õ–ö–£</button>
    </div>
</div>

<nav class="navbar">
    <a href="#" class="nav-item active" onclick="showPage('game', this)"><span>üéÆ</span>–ò–ì–†–ê</a>
    <a href="#" class="nav-item" onclick="showPage('shop', this)"><span>üõí</span>–ú–ê–†–ö–ï–¢</a>
    <a href="#" class="nav-item" onclick="showPage('wallet', this)"><span>üí∞</span>–í–´–í–û–î</a>
    <a href="#" class="nav-item" onclick="showPage('info', this)"><span>üë•</span>–ö–õ–£–ë</a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const API = 'https://tama-bot-server.onrender.com/api/action';
    let nextBonusTime = 0;

    function showPage(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    async function doAction(action) {
        try {
            const res = await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    userId: tg.initDataUnsafe?.user?.id || "7883085758",
                    userName: tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫",
                    action, isDeep: document.getElementById('isDeep').checked
                })
            });
            const d = await res.json();
            if(d.msg) tg.showAlert(d.msg);
            updateUI(d);
        } catch(e) { console.error(e); }
    }

    function updateUI(d) {
        const b = Math.floor(d.b).toLocaleString();
        document.getElementById('b-val').innerText = b + " TC";
        document.getElementById('withdraw-balance').innerText = b + " TC";
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('u-art').innerText = (d.artifacts?.length || 0) + "/5";
        document.getElementById('u-fish').innerText = d.fish.toFixed(2);
        document.getElementById('shop-fish').innerText = d.fish.toFixed(2);
        document.getElementById('ref-link').innerText = `https://t.me/–¢–í–û–ô_–ë–û–¢?start=${d.id}`;
        nextBonusTime = d.lastBonus + 86400000;
    }

    function startFishing() {
        document.getElementById('fishAnim').style.display = 'block';
        tg.HapticFeedback.impactOccurred('heavy');
        setTimeout(() => { document.getElementById('fishAnim').style.display = 'none'; doAction('catch_fish'); }, 1200);
    }

    function buyItem() { tg.showAlert("–û–ø–ª–∞—Ç–∞ Stars —Å–∫–æ—Ä–æ!"); }
    function copyRef() { navigator.clipboard.writeText(document.getElementById('ref-link').innerText); tg.showAlert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!"); }
    function withdraw() { doAction('withdraw'); }

    setInterval(() => {
        const now = new Date();
        const gold = new Date(); gold.setHours(19,0,0,0);
        if(now > gold) gold.setDate(gold.getDate()+1);
        const ms = gold - now;
        const h = Math.floor(ms/3600000).toString().padStart(2,'0');
        const m = Math.floor((ms%3600000)/60000).toString().padStart(2,'0');
        const s = Math.floor((ms%60000)/1000).toString().padStart(2,'0');
        
        let bonusText = (nextBonusTime - now.getTime() > 0) ? "–ë–û–ù–£–° –ß–ï–†–ï–ó: " + new Date(nextBonusTime-now.getTime()).toISOString().substr(11,8) : "–ë–û–ù–£–° –ì–û–¢–û–í! üéÅ";
        document.getElementById('timers').innerText = `–ó–û–õ–û–¢–û–ô –ß–ê–°: ${h}:${m}:${s} | ${bonusText}`;
    }, 1000);

    doAction('load');
</script>
</body>
</html>
