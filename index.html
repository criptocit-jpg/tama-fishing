<script>
    const tg = window.Telegram.WebApp;
    const url = 'https://tama-bot-server.onrender.com/api/action';
    
    // Ждем, пока TelegramWebApp инициализируется
    tg.ready();

    function getUID() {
        return tg.initDataUnsafe?.user?.id ? String(tg.initDataUnsafe.user.id) : "569502967"; 
    }

    async function load() {
        const uid = getUID();
        try {
            const r = await fetch(`${url}?userId=${uid}`);
            const d = await r.json();
            document.getElementById('b1').innerText = d.balance.toFixed(2);
            document.getElementById('s-fish').innerText = d.fish.toFixed(2);
            document.getElementById('s-rod').innerText = d.rod_durability;
        } catch(e) { console.log("Ошибка загрузки"); }
    }

    async function doAction(act) {
        const uid = getUID();
        await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ userId: uid, action: act })
        });
        load();
    }
    // ... остальной код анимации допиши сюда
</script>
