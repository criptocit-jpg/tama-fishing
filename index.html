<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Fishing Gold v5.0.1</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ü–û–õ–ù–´–ô –ù–ê–ë–û–† –°–¢–ò–õ–ï–ô –ò–ó –ó–û–õ–û–¢–û–ô –ë–ê–ó–´ */
        :root {
            --gold: #FFD700;
            --gold-dark: #B8860B;
            --bg: #050810;
            --glass: rgba(255, 255, 255, 0.06);
            --glass-border: rgba(255, 255, 255, 0.12);
            --blue: #0088CC;
            --blue-dark: #005580;
            --red: #e91e63;
            --green: #4caf50;
        }

<body>
    <div id="toast"></div>

    <div class="marquee-container">
        <div id="news-line">–ó–ê–ì–†–£–ó–ö–ê –ù–û–í–û–°–¢–ï–ô –û–ö–ï–ê–ù–ê...</div>
    </div>

    <div id="screen-game" class="page active">
        <div class="header-info">
            <div id="display-level" class="lvl-tag">–ó–ê–ì–†–£–ó–ö–ê...</div>
            <div class="balance-display"><span id="display-balance">0</span> <small style="font-size: 16px;">TC</small></div>
            <div style="color: #FFB300; font-weight: 800;">‚≠ê STARS: <span id="display-stars">0</span></div>
        </div>
        <div class="timers-row">
            <div class="timer-block"><span class="timer-label">–ó–æ–ª–æ—Ç–æ–π —á–∞—Å</span><span id="timer-golden-val" class="timer-value">--:--</span></div>
            <div class="timer-block" style="text-align: right;"><span class="timer-label">–ë–æ–Ω—É—Å</span><span id="timer-daily-val" class="timer-value">--:--</span></div>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><small>–≠–Ω–µ—Ä–≥–∏—è</small><b id="val-energy">0</b></div>
            <div class="stat-card"><small>–£–¥–æ—á–∫–∞</small><b id="val-durability">0%</b></div>
            <div class="stat-card"><small>–Ø—â–∏–∫–∏</small><b id="val-boxes">0</b></div>
        </div>
        <div class="fishing-zone" id="main-pond">
            <img src="https://cdn-icons-png.flaticon.com/512/2953/2953363.png" id="captcha-object" onclick="onCaptchaClick()" style="width: 80px; position: absolute; display: none; z-index: 10;">
            <img src="fish_anim.webp" id="fish-animation" style="width: 180px; display: none;">
            <div id="status-label">–ì–û–¢–û–í –ö –ó–ê–ë–†–û–°–£</div>
        </div>
        <button id="btn-get-daily" class="action-button btn-reward" onclick="handleAction('get_daily')">–ü–û–î–ê–†–û–ö üéÅ</button>
        <button id="btn-main-cast" class="action-button btn-primary" onclick="startFishingSequence()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
    </div>

    <div id="screen-menu" class="page">
        <h2 style="margin-top: 0;">üéí –ú–ê–ì–ê–ó–ò–ù –ò –£–õ–û–í</h2>
        <div class="ui-section is-open">
            <div class="ui-section-head" onclick="toggleAccordion(this)"><span>üêü –¢–í–û–ô –£–õ–û–í</span><span>‚ñº</span></div>
            <div class="ui-section-body">
                <div style="font-size: 20px; margin-bottom: 10px;">–í —Å—É–º–∫–µ: <b id="val-fish-weight">0</b> –∫–≥</div>
                <button class="action-button btn-primary" style="padding: 12px;" onclick="handleAction('sell_fish')">–ü–†–û–î–ê–¢–¨ –í–°–Å üí∞</button>
            </div>
        </div>
        <div class="ui-section is-open">
            <div class="ui-section-head" onclick="toggleAccordion(this)"><span>üõí –ú–ê–ì–ê–ó–ò–ù</span><span>‚ñº</span></div>
            <div class="ui-section-body">
                <div class="shop-row">
                    <div class="shop-info"><b>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</b><br><small>+40‚ö°</small></div>
                    <button class="buy-control" onclick="handleAction('buy_item', {itemId:'energy_drink'})">100 TC</button>
                </div>
                <div class="shop-row">
                    <div class="shop-info"><b>–ú—è—á–∏–∫</b><br><small>–ú–µ–Ω—å—à–µ —Å—Ä—ã–≤–æ–≤</small></div>
                    <button class="buy-control" onclick="handleAction('buy_item', {itemId:'safe_ball'})">50 TC</button>
                </div>
                <div class="shop-row" style="border: 1px solid var(--gold); padding: 5px; border-radius: 10px; margin-top: 10px;">
                    <div class="shop-info"><b>–û–ó–ï–†–û –ù–ê–î–ï–ñ–î–´</b><br><small>–î–ª—è –ø—Ä–æ—Ñ–∏</small></div>
                    <button class="buy-control" style="background: var(--gold);" onclick="handleAction('buy_item', {itemId:'golden_lake'})">150 ‚≠ê</button>
                </div>
            </div>
        </div>
        <div class="ui-section">
            <div class="ui-section-head" onclick="toggleAccordion(this)"><span>üõ†Ô∏è –ú–ê–°–¢–ï–†–°–ö–ê–Ø</span><span>‚ñº</span></div>
            <div class="ui-section-body">
                <button class="action-button btn-reward" style="padding: 12px;" onclick="handleAction('repair')">–†–ï–ú–û–ù–¢ (50 TC)</button>
            </div>
        </div>
    </div>

    <div id="screen-top" class="page">
        <h2 style="margin-top: 0;">üèÜ –†–ï–ô–¢–ò–ù–ì</h2>
        <div id="container-leaderboard"></div>
    </div>

    <div id="screen-info" class="page">
        <h2 style="margin-top: 0;">‚ÑπÔ∏è –ò–ù–§–û–†–ú–ê–¶–ò–Ø</h2>
        <div class="info-card">
            <h3 style="color: var(--gold);">üí∞ –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê</h3>
            <p>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π <b>10%</b> –æ—Ç —Å—É–º–º—ã –∫–∞–∂–¥–æ–π –∏—Ö –ø—Ä–æ–¥–∞–∂–∏ —Ä—ã–±—ã! –¢–≤–æ—è —Å—Å—ã–ª–∫–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –±–æ—Ç–∞.</p>
        </div>
        <div class="info-card">
            <h3>üé£ –ü–†–ê–í–ò–õ–ê</h3>
            <p>- –ó–∞–±—Ä–æ—Å: 2‚ö°<br>- –ó–æ–ª–æ—Ç–æ–π —á–∞—Å: –≤ 19:00 (—É–ª–æ–≤ x3)<br>- –ú–µ—à–∫–∏: –∫–∞–∂–¥—ã–π 5-–π –∑–∞–±—Ä–æ—Å</p>
        </div>
        <div style="text-align: center; margin-top: 30px; opacity: 0.3; font-size: 10px;">v5.0.2 Monolith Stable</div>
    </div>

    <nav class="bottom-nav">
        <a href="javascript:void(0)" class="nav-button is-active" onclick="navigateTo('screen-game', this)"><i>üéÆ</i>–ò–ì–†–ê</a>
        <a href="javascript:void(0)" class="nav-button" onclick="navigateTo('screen-menu', this)"><i>üéí</i>–ú–ï–ù–Æ</a>
        <a href="javascript:void(0)" class="nav-button" onclick="navigateTo('screen-top', this)"><i>üèÜ</i>–¢–û–ü</a>
        <a href="javascript:void(0)" class="nav-button" onclick="navigateTo('screen-info', this)"><i>‚ÑπÔ∏è</i>–ò–ù–§–û</a>
    </nav>

    <script>
        const telegram = window.Telegram.WebApp;
        const ENDPOINT = 'https://tama-bot-server.onrender.com/api/action';
        let currentUserData = {};

        telegram.ready();
        telegram.expand();

        function showNotification(text) {
            const el = document.getElementById('toast');
            el.innerText = text;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        function toggleAccordion(element) {
            element.parentElement.classList.toggle('is-open');
        }

        function navigateTo(screenId, navElement) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('is-active'));
            navElement.classList.add('is-active');
        }

        async function handleAction(actionName, payload = {}) {
            try {
                const uid = telegram.initDataUnsafe?.user?.id || "7883085758";
                const uname = telegram.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫";
                const response = await fetch(ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: uid, userName: uname, action: actionName, ...payload })
                });
                const data = await response.json();
                if (data.msg && actionName !== 'load_data') showNotification(data.msg);
                renderUI(data);
            } catch (err) { console.error("API Error"); }
        }

        function renderUI(data) {
            currentUserData = data;
            document.getElementById('display-balance').innerText = Math.floor(data.b).toLocaleString();
            document.getElementById('display-stars').innerText = data.s || 0;
            document.getElementById('display-level').innerText = data.level || "–†–´–ë–ê–ö";
            document.getElementById('val-energy').innerText = data.energy;
            document.getElementById('val-durability').innerText = data.durability + '%';
            document.getElementById('val-boxes').innerText = data.boxes;
            document.getElementById('val-fish-weight').innerText = (data.fish || 0).toFixed(2);
            if (data.logs) document.getElementById('news-line').innerText = data.logs.join('   ‚Ä¢   ');
            if (data.top) {
                document.getElementById('container-leaderboard').innerHTML = data.top.map((p, i) => `
                    <div class="leader-item"><span>#${i+1} ${p.n}</span><b>${p.b} TC</b></div>
                `).join('');
            }
        }

        function startFishingSequence() {
            if (currentUserData.energy < 2) return showNotification("–ù–ï–¢ –≠–ù–ï–†–ì–ò–ò ‚ö°");
            if (currentUserData.durability <= 0) return showNotification("–ü–û–ß–ò–ù–ò –£–î–û–ß–ö–£ üõ†Ô∏è");

            if ((currentUserData.castCount + 1) % 5 === 0) {
                const bag = document.getElementById('captcha-object');
                bag.style.display = 'block';
                bag.style.left = '45%'; bag.style.top = '40%';
                document.getElementById('btn-main-cast').disabled = true;
                document.getElementById('status-label').innerText = "–õ–û–í–ò –ú–ï–®–û–ö! üì¶";
            } else {
                const fish = document.getElementById('fish-animation');
                fish.style.display = 'block';
                document.getElementById('btn-main-cast').disabled = true;
                setTimeout(() => {
                    fish.style.display = 'none';
                    document.getElementById('btn-main-cast').disabled = false;
                    handleAction('catch_fish');
                }, 1000);
            }
        }

        function onCaptchaClick() {
            document.getElementById('captcha-object').style.display = 'none';
            document.getElementById('btn-main-cast').disabled = false;
            handleAction('catch_fish', { captchaPassed: true });
        }

        setInterval(() => {
            const now = Date.now();
            const nextBonus = (currentUserData.lastBonus || 0) + 86400000;
            const diff = nextBonus - now;
            if (diff > 0) {
                const h = Math.floor(diff/3600000);
                const m = Math.floor((diff%3600000)/60000);
                document.getElementById('timer-daily-val').innerText = `${h}—á ${m}–º`;
                document.getElementById('btn-get-daily').disabled = true;
            } else {
                document.getElementById('timer-daily-val').innerText = "–ì–û–¢–û–í!";
                document.getElementById('btn-get-daily').disabled = false;
            }
            const h = new Date().getHours();
            document.getElementById('timer-golden-val').innerText = (h === 19) ? "–ê–ö–¢–ò–í–ï–ù! üî•" : "–≤ 19:00";
        }, 1000);

        setInterval(() => handleAction('load_data'), 15000);
        handleAction('load_data');
    </script>
</body>
</html>


