<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tamacoin Crypto Fishing</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --dark: #0a0e1a; --glass: rgba(255,255,255,0.07); }
        body { margin: 0; background: var(--dark); color: white; font-family: sans-serif; overflow: hidden; height: 100vh; }
        #news-line { background: rgba(255, 215, 0, 0.1); color: var(--gold); padding: 8px; font-size: 11px; overflow: hidden; white-space: nowrap; }
        #news-content { display: inline-block; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .page { display: none; height: calc(100vh - 70px); padding: 15px; box-sizing: border-box; overflow-y: auto; flex-direction: column; }
        .page.active { display: flex; }
        .btn-main { width: 100%; padding: 18px; background: var(--gold); border: none; border-radius: 15px; font-weight: bold; font-size: 18px; margin-top: 10px; }
        .acc-item { background: var(--glass); border-radius: 12px; margin-bottom: 8px; }
        .acc-head { padding: 15px; display: flex; justify-content: space-between; font-weight: bold; }
        .acc-body { padding: 15px; display: none; }
        .acc-item.open .acc-body { display: block; }
        nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #070a14; display: flex; border-top: 1px solid #1e2638; }
        .nav-item { flex: 1; display: flex; flex-direction: center; align-items: center; justify-content: center; font-size: 10px; color: #4a5265; text-decoration: none; flex-direction: column;}
        .nav-item.active { color: var(--gold); }
        .top-list { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 10px; }
        .top-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

<div id="news-line"><div id="news-content">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>

<div id="p-game" class="page active">
    <div style="text-align:center;">
        <div id="u-b" style="font-size:40px; font-weight:bold; color:var(--gold);">0</div>
        <div style="font-size:10px; opacity:0.5;">TAMACON (TC)</div>
    </div>
    <div style="display:flex; gap:10px; margin: 15px 0;">
        <div style="flex:1; background:var(--glass); padding:10px; border-radius:10px; text-align:center;">‚ö° <span id="u-en">0</span></div>
        <div style="flex:1; background:var(--glass); padding:10px; border-radius:10px; text-align:center;">üõ†Ô∏è <span id="u-dur">0</span>%</div>
    </div>
    <div style="display:flex; gap:5px; margin-bottom:10px;">
        <button id="l-sea" onclick="setLoc('sea')" style="flex:1; padding:10px; border-radius:10px; background:var(--gold); border:none;">–ú–û–†–ï</button>
        <button id="l-lake" onclick="setLoc('hope_lake')" style="flex:1; padding:10px; border-radius:10px; background:#1e2638; color:white; border:none;">–û–ó–ï–†–û</button>
    </div>
    <div id="ocean" style="height:150px; background:radial-gradient(circle, #1a2a44 0%, #000 100%); border-radius:20px; display:flex; align-items:center; justify-content:center; position:relative;">
        <img src="https://cdn-icons-png.flaticon.com/512/2274/2274532.png" id="fish-anim" style="width:60px; display:none;">
    </div>
    <button id="btn-cast" class="btn-main" onclick="doCast()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
    <button id="btn-daily" style="width:100%; padding:12px; margin-top:10px; background:#2e7d32; border:none; border-radius:10px; color:white; font-weight:bold; display:none;" onclick="api('get_daily')">üéÅ –ë–û–ù–£–°</button>
</div>

<div id="p-shop" class="page">
    <div class="acc-item open">
        <div class="acc-head">üêü –°–ê–î–û–ö: <span id="u-fish">0</span> –∫–≥ <button onclick="api('sell')" style="background:var(--gold); border:none; padding:5px 10px; border-radius:5px;">–ü–†–û–î–ê–¢–¨</button></div>
    </div>
    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)">üíé VIP –ú–ê–ì–ê–ó–ò–ù (TON) <span>‚ñº</span></div>
        <div class="acc-body">
            <p style="font-size:10px; color:var(--gold);">–ö–æ—à–µ–ª–µ–∫: –¢–í–û–ô_–ö–û–®–ï–õ–ï–ö</p>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span>–õ–∏—Ü–µ–Ω–∑–∏—è –û–∑–µ—Ä–æ</span>
                <button onclick="api('request_buy',{id:'license'})" style="background:#2e7d32; color:white; border:none; padding:5px; border-radius:5px;">1 TON</button>
            </div>
        </div>
    </div>
</div>

<div id="p-info" class="page">
    <button onclick="loadTop()" style="width:100%; padding:10px; background:var(--gold); border:none; border-radius:10px; font-weight:bold; margin-bottom:15px;">–û–ë–ù–û–í–ò–¢–¨ –¢–û–ü üèÜ</button>
    <div id="top-container" class="top-list"></div>
    <div style="margin-top:20px;">
        <div style="font-size:11px; color:var(--gold);">–†–ï–§. –°–°–´–õ–ö–ê:</div>
        <div id="ref-link" style="font-size:10px; word-break:break-all; background:rgba(255,255,255,0.05); padding:10px; border-radius:8px;"></div>
    </div>
</div>

<nav>
    <a href="#" class="nav-item active" onclick="showP('p-game',this)">–ò–ì–†–ê</a>
    <a href="#" class="nav-item" onclick="showP('p-shop',this)">–ú–ê–ì–ê–ó–ò–ù</a>
    <a href="#" class="nav-item" onclick="showP('p-info',this)">–¢–û–ü/–ò–ù–§–û</a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const URL = 'https://tama-bot-server.onrender.com/api/action';
    let user = {}; let currentLoc = 'sea';
    tg.expand();

    async function api(action, payload = {}) {
        const uid = tg.initDataUnsafe?.user?.id || "123";
        const uname = tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫";
        try {
            const r = await fetch(URL, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ userId: uid, userName: uname, action, payload })
            });
            const d = await r.json();
            if (d.msg) tg.showAlert(d.msg);
            if (d.top) { renderTop(d.top); } else { render(d); }
            if (d.catchData) tg.showAlert("–ü–æ–π–º–∞–Ω–æ: " + d.catchData.w);
        } catch(e) { tg.showAlert("–û—à–∏–±–∫–∞: " + e.message); }
    }

    function render(d) {
        user = d;
        document.getElementById('u-b').innerText = Math.floor(d.b).toLocaleString();
        document.getElementById('u-fish').innerText = (d.fish || 0).toFixed(2);
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('u-dur').innerText = d.dur;
        document.getElementById('news-content').innerText = d.logs ? d.logs.join('  ‚Ä¢  ') : "";
        document.getElementById('btn-daily').style.display = (Date.now() - d.lastBonus > 86400000) ? 'block' : 'none';
        document.getElementById('ref-link').innerText = "https://t.me/–¢–í–û–ô_–ë–û–¢?start=" + d.id;
    }

    function loadTop() { api('get_top'); }
    function renderTop(top) {
        const c = document.getElementById('top-container');
        c.innerHTML = top.map((p, i) => `<div class="top-item"><span>${i+1}. ${p.n}</span><b>${p.b} TC</b></div>`).join('');
    }

    function doCast() {
        if (user.energy < 2) return tg.showAlert("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏!");
        const f = document.getElementById('fish-anim');
        const b = document.getElementById('btn-cast');
        f.style.display = 'block'; b.disabled = true;
        setTimeout(() => { f.style.display = 'none'; b.disabled = false; api('cast', { location: currentLoc }); }, 1200);
    }

    function showP(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }
    function toggleAcc(el) { el.parentElement.classList.toggle('open'); }
    function setLoc(l) {
        currentLoc = l;
        document.getElementById('l-sea').style.background = (l==='sea') ? 'var(--gold)' : '#1e2638';
        document.getElementById('l-lake').style.background = (l==='hope_lake') ? 'var(--gold)' : '#1e2638';
    }

    api('load');
</script>
</body>
</html>

