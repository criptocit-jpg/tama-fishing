<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Tamacoin Fishing Gold 7.0</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root { --gold: #FFD700; --dark: #0a0e1a; --wood: #5d4037; --glass: rgba(255,255,255,0.07); --accent: #0088cc; }
body { margin: 0; background: var(--dark); color: white; font-family: 'Segoe UI', Roboto, sans-serif; overflow: hidden; height: 100vh; }

/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü */
.page { display: none; height: 100vh; padding: 15px; box-sizing: border-box; flex-direction: column; padding-bottom: 110px; overflow-y: auto; }
.page.active { display: flex; }

/* –î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –ø–ª–∞—à–∫–∞ —É–ª–æ–≤–∞ */
#wood-plate { 
    position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0); 
    background: var(--wood); border: 3px solid #3e2723; border-radius: 16px; 
    padding: 20px; text-align: center; width: 80%; z-index: 2000; 
    box-shadow: 0 20px 50px rgba(0,0,0,0.9); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
}
#wood-plate.show { transform: translate(-50%, -50%) scale(1); }

/* –ê–∫–∫–æ—Ä–¥–µ–æ–Ω */
.acc-item { background: var(--glass); border-radius: 12px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.1); }
.acc-head { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; }
.acc-body { display: none; padding: 10px; grid-template-columns: 1fr 1fr; gap: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
.acc-item.open .acc-body { display: grid; }

.top-row { display: flex; justify-content: space-between; font-size: 11px; color: var(--gold); margin-bottom: 10px; font-weight: bold; }

/* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
.lake-zone { 
    flex-grow: 1; position: relative; background: radial-gradient(circle, #1a3a5a 0%, #0a0e1a 100%); 
    border-radius: 25px; display: flex; align-items: center; justify-content: center; 
    margin-bottom: 15px; border: 2px solid rgba(0,136,204,0.2); overflow: hidden; 
}
.lake-zone.active { box-shadow: inset 0 0 60px rgba(0,136,204,0.6); border-color: var(--gold); }

#fish-anim { width: 120px; height: 120px; display: none; filter: drop-shadow(0 0 10px var(--accent)); }

/* –ö–Ω–æ–ø–∫–∏ */
.btn-cast { 
    width: 100%; padding: 20px; background: linear-gradient(180deg, var(--gold), #ffa000); 
    border: none; border-radius: 20px; font-weight: 900; font-size: 22px; color: #3e2723; 
    box-shadow: 0 6px 0 #b8860b; active { transform: translateY(4px); box-shadow: 0 2px 0 #b8860b; }
}
.btn-daily { background: #2e7d32; color: white; border: none; padding: 14px; border-radius: 15px; width: 100%; margin-bottom: 10px; font-weight: bold; display: none; }

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: #0d121f; display: flex; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000; padding-bottom: 15px; }
.nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #5a6275; text-decoration: none; font-weight: bold; }
.nav-item.active { color: var(--gold); }
.nav-item i { font-style: normal; font-size: 24px; margin-bottom: 4px; }

.stat-mini { background: var(--glass); padding: 10px; border-radius: 10px; text-align: center; font-size: 12px; }
.shop-btn { background: #2e7d32; color: white; border: none; padding: 8px; border-radius: 6px; width: 100%; margin-top: 5px; font-weight: bold; }

.toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: var(--gold); color: #000; padding: 12px 25px; border-radius: 30px; display:none; z-index:4000; font-weight:900; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
input { width: 100%; padding: 14px; margin-bottom: 10px; background: rgba(0,0,0,0.5); border: 1px solid #333; color: #fff; border-radius: 10px; box-sizing: border-box; }

/* –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ */
#ticker { position: fixed; top: 0; width: 100%; overflow: hidden; white-space: nowrap; background: rgba(0,0,0,0.8); color: var(--gold); padding: 6px 0; font-size: 11px; z-index: 3001; border-bottom: 1px solid var(--gold); }
.ticker-content { display: inline-block; padding-left: 100%; animation: scroll 25s linear infinite; }
@keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
</style>
</head>
<body>

<div id="ticker"><div class="ticker-content" id="ticker-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å–µ—Ä–≤–µ—Ä–∞...</div></div>
<div id="toast" class="toast"></div>

<div id="wood-plate" onclick="this.classList.remove('show')">
    <div style="font-size:12px; opacity:0.8; color:white; text-transform:uppercase;">–û—Ç–ª–∏—á–Ω—ã–π —É–ª–æ–≤!</div>
    <p id="catch-res" style="font-size: 28px; font-weight: 900; margin: 15px 0; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.5);"></p>
    <div style="font-size:10px; color:var(--gold); border: 1px solid var(--gold); display:inline-block; padding: 4px 10px; border-radius:10px;">–ó–ê–ë–†–ê–¢–¨</div>
</div>

<div id="p-game" class="page active">
    <div class="top-row">
        <div>–ì–û–†–Ø–ß–ò–ô –ß–ê–°: <span id="t-gold">--:--:--</span></div>
        <div>–ë–û–ù–£–°: <span id="t-daily">--:--:--</span></div>
    </div>
    
    <div style="text-align:center; margin: 10px 0 20px;">
        <div id="u-b" style="font-size:46px; font-weight:900; color:var(--gold); line-height:1;">0</div>
        <div style="font-size:12px; opacity:0.5; letter-spacing: 2px;">TAMACON</div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:20px;">
        <div class="stat-mini">‚ö° <span id="u-en">0</span></div>
        <div class="stat-mini">üõ†Ô∏è <span id="u-dur">0%</span></div>
        <div class="stat-mini">üèÜ <span id="u-box">0</span></div>
    </div>

    <div id="ocean" class="lake-zone">
        <img src="https://cdn-icons-png.flaticon.com/512/2274/2274532.png" id="fish-anim" alt="fish">
    </div>

    <div style="margin-top: auto;">
        <button id="btn-daily" class="btn-daily" onclick="api('get_daily')">üéÅ –ü–û–õ–£–ß–ò–¢–¨ –ë–û–ù–£–°</button>
        <button id="btn-cast" class="btn-cast" onclick="doCast()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
    </div>

    <div style="margin-top:15px; text-align:center;">
        <div class="stat-mini" style="border: 1px solid var(--gold); background: rgba(255,215,0,0.05);">
            üí∞ –î–ñ–ï–ö–ü–û–¢: <span id="jp-pool" style="color:var(--gold); font-weight:900;">0</span> TC
        </div>
    </div>
</div>

<div id="p-sadok" class="page">
    <div class="acc-item open">
        <div class="acc-head">üêü –í–ê–® –£–õ–û–í</div>
        <div class="acc-body" style="display:flex; justify-content:space-between; grid-template-columns:none; align-items: center;">
            <span style="font-size:18px;">–í–µ—Å: <b id="u-fish" style="color:var(--gold);">0</b> –∫–≥</span>
            <button onclick="api('sell')" style="background:var(--gold); border:none; padding:12px 25px; border-radius:12px; font-weight:900; color:#3e2723;">–ü–†–û–î–ê–¢–¨</button>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)">üõí –ú–ê–ì–ê–ó–ò–ù –ü–†–ï–î–ú–ï–¢–û–í <span>‚ñº</span></div>
        <div class="acc-body">
            <div class="stat-mini">–ú—è–∫–∏—à (100)<button class="shop-btn" onclick="api('buy',{id:'myakish'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini">–°–Ω–∞—Å—Ç–∏ (200)<button class="shop-btn" onclick="api('buy',{id:'gear'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini">–≠–Ω–µ—Ä–≥–∏—è (50)<button class="shop-btn" onclick="api('buy',{id:'energy'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini">–†–µ–º–æ–Ω—Ç (50)<button class="shop-btn" onclick="api('buy',{id:'repair'})">–ö–£–ü–ò–¢–¨</button></div>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)" style="color:var(--gold)">üíé VIP –£–õ–£–ß–®–ï–ù–ò–Ø <span>‚ñº</span></div>
        <div class="acc-body">
            <div class="stat-mini">–¢–∏—Ç–∞–Ω (150)<button class="shop-btn" onclick="api('buy',{id:'titan'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini">–ü—Ä–∏–∫–æ—Ä–º (200)<button class="shop-btn" onclick="api('buy',{id:'bait'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini">–°–Ω–∞—Å—Ç–∏+ (200)<button class="shop-btn" onclick="api('buy',{id:'strong'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini">–õ–∏—Ü–µ–Ω–∑–∏—è (500)<button class="shop-btn" onclick="api('buy',{id:'license'})">–ö–£–ü–ò–¢–¨</button></div>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)">üí≥ –í–´–í–û–î –°–†–ï–î–°–¢–í <span>‚ñº</span></div>
        <div class="acc-body" style="grid-template-columns:1fr;">
            <input id="w-wallet" placeholder="–í–∞—à TON –ö–æ—à–µ–ª–µ–∫">
            <input id="w-sum" type="number" placeholder="–°—É–º–º–∞ TC (–æ—Ç 30 000)">
            <button onclick="withdraw()" style="background:var(--accent); color:white; border:none; padding:15px; border-radius:12px; width:100%; font-weight: bold; font-size:16px;">–°–û–ó–î–ê–¢–¨ –ó–ê–Ø–í–ö–£</button>
        </div>
    </div>
</div>

<div id="p-top" class="page">
    <h2 style="text-align:center; color:var(--gold); text-transform:uppercase;">üèÜ –õ—É—á—à–∏–µ –†—ã–±–∞–∫–∏</h2>
    <div id="top-list"></div>
</div>

<div id="p-info" class="page">
    <h2 style="color:var(--gold);">Tamacoin Economy</h2>
    <div class="stat-mini" style="text-align:left; line-height:1.5; margin-bottom:15px;">
        <b>Tamacoin (TC)</b> ‚Äî —ç—Ç–æ –∏–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –¥–æ–±—ã–≤–∞—Ç—å, –ª–æ–≤—è —Ä—ã–±—É. <br><br>
        ‚Ä¢ <b>–ó–æ–ª–æ—Ç–æ–π —á–∞—Å:</b> –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 19:00 –ø–æ —Å–µ—Ä–≤–µ—Ä—É —É–ª–æ–≤ —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è!<br>
        ‚Ä¢ <b>–õ–∏—Ü–µ–Ω–∑–∏—è:</b> –ü–æ–∑–≤–æ–ª—è–µ—Ç –ª–æ–≤–∏—Ç—å –ó–æ–ª–æ—Ç—ã—Ö –ö–∞—Ä–ø–æ–≤ –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–æ—à–µ–ª—å–∫–∏.<br>
        ‚Ä¢ <b>–î–∂–µ–∫–ø–æ—Ç:</b> –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è —Å –∫–∞–∂–¥—ã–º –∑–∞–±—Ä–æ—Å–æ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤.
    </div>

    <h3 style="color:var(--gold);">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</h3>
    <div id="ref-link" style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; word-break:break-all; font-size:12px; color:var(--gold); border: 1px dashed var(--gold);"></div>
    <button onclick="copyRef()" class="btn-cast" style="padding:15px; font-size:16px; margin-top:15px; height:auto;">–ö–û–ü–ò–†–û–í–ê–¢–¨ üìã</button>
</div>

<nav>
    <a href="javascript:void(0)" class="nav-item active" onclick="showP('p-game',this)"><i>üéÆ</i>–ò–ì–†–ê</a>
    <a href="javascript:void(0)" class="nav-item" onclick="showP('p-sadok',this)"><i>üéí</i>–°–ê–î–û–ö</a>
    <a href="javascript:void(0)" class="nav-item" onclick="showP('p-top',this)"><i>üèÜ</i>–¢–û–ü</a>
    <a href="javascript:void(0)" class="nav-item" onclick="showP('p-info',this)"><i>‚ÑπÔ∏è</i>–ò–ù–§–û</a>
</nav>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

const BACKEND_URL = 'https://tama-bot-server.onrender.com/api/action';
let user = { lastBonus: 0 };

function showP(id, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
    el.classList.add('active');
}

function toggleAcc(el) { el.parentElement.classList.toggle('open'); }

function toast(txt) {
    const t = document.getElementById('toast');
    t.innerText = txt;
    t.style.display = 'block';
    setTimeout(() => t.style.display = 'none', 3000);
}

function updateTicker(events) {
    const ticker = document.getElementById('ticker-text');
    if (events && events.length > 0) {
        ticker.innerText = events.join('  ‚Ä¢  ');
    }
}

async function api(action, payload = {}) {
    try {
        const uid = tg.initDataUnsafe?.user?.id || "7883085758";
        const uname = tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫";
        
        const r = await fetch(BACKEND_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId: uid, userName: uname, action, payload })
        });
        
        const d = await r.json();
        if (d.msg) toast(d.msg);
        render(d);
        
        if (d.events) updateTicker(d.events);
        
        if (d.catchData) {
            document.getElementById('catch-res').innerHTML = d.catchData.type + '<br><span style="color:var(--gold)">' + d.catchData.w + ' –∫–≥</span>';
            document.getElementById('wood-plate').classList.add('show');
        }
    } catch (e) {
        console.error("API Error:", e);
        toast("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
    }
}

function render(d) {
    if (!d || !d.id) return;
    user = d;
    document.getElementById('u-b').innerText = Math.floor(d.b).toLocaleString();
    document.getElementById('u-fish').innerText = (d.fish || 0).toFixed(2);
    document.getElementById('u-en').innerText = d.energy || 0;
    document.getElementById('u-dur').innerText = Math.max(0, Math.floor(d.dur || 0)) + '%';
    document.getElementById('u-box').innerText = d.total || 0;
    document.getElementById('ref-link').innerText = "https://t.me/TamacoinBot?start=" + d.id;
    
    if (d.jackpot) {
        document.getElementById('jp-pool').innerText = Math.floor(d.jackpot.pool).toLocaleString();
    }

    if (d.top) {
        document.getElementById('top-list').innerHTML = d.top.map((x, i) => `
            <div class="stat-mini" style="margin-bottom:8px; display:flex; justify-content:space-between; align-items:center;">
                <span><b style="color:var(--gold)">${i+1}</b>. ${x.n}</span>
                <b style="font-family:monospace;">${Math.floor(x.b).toLocaleString()} TC</b>
            </div>
        `).join('');
    }
}

function doCast() {
    const f = document.getElementById('fish-anim');
    const b = document.getElementById('btn-cast');
    const o = document.getElementById('ocean');
    
    if (user.energy < 2) return toast("–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏! ‚ö°");
    if (user.dur <= 0) return toast("–°–Ω–∞—á–∞–ª–∞ –ø–æ—á–∏–Ω–∏ —É–¥–æ—á–∫—É! üõ†Ô∏è");

    f.style.display = 'block';
    b.disabled = true;
    b.style.opacity = '0.7';
    o.classList.add('active');
    
    setTimeout(() => {
        f.style.display = 'none';
        b.disabled = false;
        b.style.opacity = '1';
        o.classList.remove('active');
        api('cast');
    }, 1500);
}

function withdraw() {
    const wallet = document.getElementById('w-wallet').value;
    const sum = parseInt(document.getElementById('w-sum').value);
    if (!wallet || !sum) return toast("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
    if (sum < 30000) return toast("–ú–∏–Ω–∏–º—É–º 30 000 TC!");
    api('withdraw', { wallet, sum });
}

function copyRef() {
    const link = document.getElementById('ref-link').innerText;
    navigator.clipboard.writeText(link);
    toast("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! üîó");
}

// –¢–∞–π–º–µ—Ä—ã
setInterval(() => {
    const now = new Date();
    
    // –ó–æ–ª–æ—Ç–æ–π —á–∞—Å (19:00)
    let target = new Date(); 
    target.setHours(19, 0, 0, 0);
    if (now > target) target.setDate(target.getDate() + 1);
    
    let diff = target - now;
    if (now.getHours() === 19) {
        document.getElementById('t-gold').innerText = "–ê–ö–¢–ò–í–ï–ù! üî•";
        document.getElementById('t-gold').style.color = "#ff4500";
    } else {
        const h = String(Math.floor(diff / 3600000)).padStart(2, '0');
        const m = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
        const s = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
        document.getElementById('t-gold').innerText = h + ":" + m + ":" + s;
        document.getElementById('t-gold').style.color = "var(--gold)";
    }

    // –ë–æ–Ω—É—Å
    let bDiff = (user.lastBonus + 86400000) - now.getTime();
    if (bDiff > 0) {
        const bh = String(Math.floor(bDiff / 3600000)).padStart(2, '0');
        const bm = String(Math.floor((bDiff % 3600000) / 60000)).padStart(2, '0');
        const bs = String(Math.floor((bDiff % 60000) / 1000)).padStart(2, '0');
        document.getElementById('t-daily').innerText = bh + ":" + bm + ":" + bs;
        document.getElementById('btn-daily').style.display = 'none';
    } else {
        document.getElementById('t-daily').innerText = "–ì–û–¢–û–í!";
        document.getElementById('btn-daily').style.display = 'block';
    }
}, 1000);

// –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
api('load');
</script>

</body>
</html>
