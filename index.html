<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Tamacoin Gold 2.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --blue: #0088CC; --bg: #050810; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; }
        
        .page { display: none; height: 100vh; padding: 20px; box-sizing: border-box; flex-direction: column; }
        .active { display: flex; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ */
        .balance-val { font-size: 42px; font-weight: 900; color: var(--gold); transition: 0.5s; }
        
        .level-badge { font-size: 12px; background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 10px; margin-top: 5px; display: inline-block; }

        .fishing-area { flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        #fishAnim { width: 100%; max-height: 80%; display: none; filter: drop-shadow(0 0 30px var(--blue)); }

        /* –†–∏—Å–∫ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å */
        .risk-toggle { background: #1a1a1a; padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; margin: 10px 0; border: 1px solid #333; }
        
        .btn { border: none; border-radius: 15px; padding: 18px; font-weight: 800; font-size: 16px; cursor: pointer; width: 100%; }
        .btn-blue { background: var(--blue); color: #fff; }
        .btn-gold { background: var(--gold); color: #000; margin-bottom: 10px; }

        .timer-box { font-size: 11px; color: #888; text-align: center; margin-bottom: 10px; }

        .navbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; background: #000; display: flex; border-top: 1px solid #222; }
        .nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 20px; color: #555; text-decoration: none; }
        .nav-link.active { color: var(--gold); }
        .nav-link label { font-size: 10px; }

        /* –ò–Ω—Ñ–æ –º–æ–¥–∞–ª–∫–∞ */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; padding: 40px 20px; z-index: 10000; overflow-y: auto; }
    </style>
</head>
<body>

<div id="game" class="page active">
    <div style="text-align:center;">
        <div id="u-level" class="level-badge">–ù–æ–≤–∏—á–æ–∫ üé£</div>
        <div class="balance-val" id="b-val">0</div>
        <div class="timer-box" id="timers">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤...</div>
    </div>

    <div class="fishing-area">
        <img src="fish_anim.webp" id="fishAnim">
    </div>

    <div class="risk-toggle">
        <span>–ì–ª—É–±–æ–∫–æ–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º (x10)</span>
        <input type="checkbox" id="riskMode" onchange="tg.HapticFeedback.impactOccurred('light')">
    </div>

    <div class="bottom-actions">
        <button class="btn btn-gold" id="btn-bonus" onclick="doAction('get_bonus')">–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° üéÅ</button>
        <button class="btn btn-blue" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
    </div>
</div>

<div id="info" class="modal">
    <h2 style="color:var(--gold)">–°–ü–†–ê–í–ö–ê</h2>
    <p>‚Ä¢ 1 –∫–≥ —Ä—ã–±—ã = 0.5 TC<br>‚Ä¢ –í—ã–≤–æ–¥ –æ—Ç 30,000 TC<br>‚Ä¢ –ó–æ–ª–æ—Ç–æ–π —á–∞—Å: 19:00 (–£–ª–æ–≤ x2)<br>‚Ä¢ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: —Å–æ–±–µ—Ä–∏ 5 —à—Ç –∏ –ø–æ–ª—É—á–∏ 30,000 TC!</p>
    <p><b>–°–í–Ø–ó–¨:</b> –°–∫–æ—Ä–æ...</p>
    <button class="btn btn-blue" onclick="closeInfo()">–ó–ê–ö–†–´–¢–¨</button>
</div>

<nav class="navbar">
    <a href="#" class="nav-link active" onclick="showPage('game', this)"><span>üéÆ</span><label>–ò–≥—Ä–∞</label></a>
    <a href="#" class="nav-link" onclick="openInfo()"><span>‚ÑπÔ∏è</span><label>–ò–Ω—Ñ–æ</label></a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const API = 'https://tama-bot-server.onrender.com/api/action';
    let currentBalance = 0;

    function openInfo() { document.getElementById('info').style.display = 'flex'; }
    function closeInfo() { document.getElementById('info').style.display = 'none'; }

    function updateBalanceAnim(target) {
        const el = document.getElementById('b-val');
        const start = currentBalance;
        const duration = 1000;
        let startTime = null;

        function animate(currentTime) {
            if (!startTime) startTime = currentTime;
            const progress = Math.min((currentTime - startTime) / duration, 1);
            const val = Math.floor(progress * (target - start) + start);
            el.innerText = val.toLocaleString() + ' TC';
            if (progress < 1) requestAnimationFrame(animate);
            else currentBalance = target;
        }
        requestAnimationFrame(animate);
    }

    function updateTimers() {
        const now = new Date();
        const hour = now.getHours();
        const nextGolden = hour >= 19 ? 19 + 24 - hour : 19 - hour;
        document.getElementById('timers').innerText = `–î–æ –ó–æ–ª–æ—Ç–æ–≥–æ –ß–∞—Å–∞: ~${nextGolden}—á | –ó–æ–ª–æ—Ç–∞—è —Ä—ã–±–∫–∞ –≥–¥–µ-—Ç–æ —Ä—è–¥–æ–º...`;
    }

    async function doAction(action) {
        const res = await fetch(API, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                userId: tg.initDataUnsafe?.user?.id || "7883085758",
                action, isDeep: document.getElementById('riskMode').checked
            })
        });
        const d = await res.json();
        if(d.msg) alert(d.msg);
        if(d.isGoldFish) tg.HapticFeedback.notificationOccurred('success');
        updateUI(d);
    }

    function updateUI(d) {
        updateBalanceAnim(d.b);
        const levels = ["–ù–æ–≤–∏—á–æ–∫ üé£", "–†—ã–±–∞–∫ üõ∂", "–ü—Ä–æ—Ñ–∏ üõ•Ô∏è", "–ú–∞—Å—Ç–µ—Ä üö¢", "–õ–ï–ì–ï–ù–î–ê üëë"];
        const lvlIdx = Math.min(4, Math.floor(d.b / 10000));
        document.getElementById('u-level').innerText = levels[lvlIdx];
        updateTimers();
    }

    function startFishing() {
        const anim = document.getElementById('fishAnim');
        anim.style.display = 'block';
        tg.HapticFeedback.impactOccurred('heavy');
        setTimeout(() => {
            anim.style.display = 'none';
            doAction('catch_fish');
        }, 1300);
    }

    setInterval(updateTimers, 60000);
    doAction('load'); // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
</script>
</body>
</html>
