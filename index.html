<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Fishing 6.1</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --dark: #0a0e1a; --wood: #5d4037; --glass: rgba(255,255,255,0.07); }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        .page { display: none; height: 100vh; padding: 15px; box-sizing: border-box; overflow-y: auto; padding-bottom: 110px; }
        .active { display: flex; flex-direction: column; }
        
        /* –ü–õ–ê–®–ö–ê –ö–û–†–Ø–ì–ê */
        #wood-plate {
            position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: var(--wood); border: 3px solid #3e2723; border-radius: 12px;
            padding: 15px; text-align: center; width: 75%; z-index: 2000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #wood-plate.show { transform: translate(-50%, -50%) scale(1); }
        #wood-plate p { font-size: 22px; font-weight: 900; margin: 10px 0; color: #fff; text-shadow: 1px 1px 2px black; }

        /* –í–´–ü–ê–î–ê–Æ–©–ò–ï –°–ü–ò–°–ö–ò (ACCORDION) */
        .acc-item { background: var(--glass); border-radius: 12px; margin-bottom: 8px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .acc-head { padding: 15px; background: rgba(255,255,255,0.05); cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; }
        .acc-body { display: none; padding: 10px; grid-template-columns: 1fr 1fr; gap: 8px; }
        .acc-item.open .acc-body { display: grid; }
        .acc-item.open .acc-head { border-bottom: 1px solid rgba(255,255,255,0.1); color: var(--gold); }

        /* –¢–ê–ô–ú–ï–†–´ –ò –°–¢–ê–¢–´ */
        .top-row { display: flex; justify-content: space-between; font-size: 10px; color: var(--gold); margin-bottom: 10px; font-family: monospace; }
        .stat-bar { display: flex; gap: 5px; margin-bottom: 10px; }
        .stat-mini { flex: 1; background: var(--glass); padding: 5px; border-radius: 8px; text-align: center; font-size: 11px; }

        /* –õ–û–ö–ê–¶–ò–Ø –ò –ö–ù–û–ü–ö–ê */
        .lake-zone { flex-grow: 1; position: relative; background: radial-gradient(circle, #1a2a44 0%, #0a0e1a 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; }
        #fish-anim { width: 100px; display: none; }
        
        /* –ö–ù–û–ü–ö–ê –ó–ê–ë–†–û–°–ê (–í–ù–ò–ó–£) */
        .main-action-area { padding-top: 10px; }
        .btn-cast { width: 100%; padding: 20px; background: var(--gold); border: none; border-radius: 18px; font-weight: 900; font-size: 18px; color: #000; box-shadow: 0 -5px 15px rgba(255,215,0,0.2); }
        .btn-cast:disabled { opacity: 0.5; background: #555; }

        .btn-daily { background: #2e7d32; color: white; border: none; padding: 10px; border-radius: 10px; width: 100%; margin-bottom: 10px; font-weight: bold; }

        /* NAV */
        nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: #0d121f; display: flex; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #5a6275; text-decoration: none; }
        .nav-item.active { color: var(--gold); }
        .nav-item i { font-size: 22px; font-style: normal; margin-bottom: 3px; }

        input { background: rgba(0,0,0,0.3); border: 1px solid #333; color: white; padding: 10px; border-radius: 8px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        .marquee { background: rgba(255,215,0,0.05); padding: 5px; font-size: 10px; border-radius: 5px; overflow: hidden; white-space: nowrap; margin-bottom: 5px; }
    </style>
</head>
<body>

<div id="toast" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); background:var(--gold); color:#000; padding:10px 20px; border-radius:20px; display:none; z-index:3000; font-weight:bold;"></div>

<div id="wood-plate" onclick="this.classList.remove('show')">
    <div style="font-size:10px; opacity:0.7; color:white;">–í–´ –í–´–õ–û–í–ò–õ–ò:</div>
    <p id="catch-res">...</p>
    <div style="font-size:9px; color:var(--gold);">–ö–õ–ò–ö–ù–ò–¢–ï, –ß–¢–û–ë–´ –ó–ê–ë–†–ê–¢–¨</div>
</div>

<div id="p-game" class="page active">
    <div class="top-row">
        <div>–ó–û–õ–û–¢–û–ô –ß–ê–°: <b id="t-gold">00:00:00</b></div>
        <div>–ë–û–ù–£–°: <b id="t-daily">00:00:00</b></div>
    </div>
    
    <div style="text-align:center; margin-bottom:10px;">
        <div id="u-b" style="font-size:36px; font-weight:900; color:var(--gold);">0</div>
        <div style="font-size:10px; opacity:0.5; letter-spacing:2px;">TAMACON BALANCE</div>
    </div>

    <div class="stat-bar">
        <div class="stat-mini">‚ö° <span id="u-en">0</span></div>
        <div class="stat-mini">üõ†Ô∏è <span id="u-dur">0%</span></div>
        <div class="stat-mini">üì¶ <span id="u-box">0</span></div>
    </div>

    <div class="marquee"><div id="log-line">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ç–∏...</div></div>

    <div class="lake-zone">
        <img src="fish_anim.webp" id="fish-anim">
        <div id="status" style="font-weight:bold; opacity:0.4;">–û–ö–ï–ê–ù –°–ü–û–ö–û–ï–ù</div>
    </div>

    <div class="main-action-area">
        <button id="btn-daily" class="btn-daily" onclick="api('get_daily')" style="display:none;">–ü–û–õ–£–ß–ò–¢–¨ –ë–û–ù–£–° üéÅ</button>
        <button id="btn-cast" class="btn-cast" onclick="doCast()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
    </div>
</div>

<div id="p-sadok" class="page">
    <div class="acc-item open">
        <div class="acc-head">üêü –ú–û–ô –°–ê–î–û–ö</div>
        <div class="acc-body" style="display:flex; justify-content:space-between; align-items:center; grid-template-columns: none;">
            <span>–£–ª–æ–≤: <b id="u-fish">0</b> –∫–≥</span>
            <button onclick="api('sell')" style="background:var(--gold); border:none; padding:8px 15px; border-radius:8px; font-weight:bold;">–ü–†–û–î–ê–¢–¨ –í–°–Å</button>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="this.parentElement.classList.toggle('open')">üõí –ú–ê–ì–ê–ó–ò–ù (TC) <span>‚ñº</span></div>
        <div class="acc-body">
            <div class="stat-mini"><b>–ú—è–∫–∏—à</b>100 TC<button onclick="api('buy',{id:'myakish'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–°–Ω–∞—Å—Ç–∏</b>200 TC<button onclick="api('buy',{id:'gear'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–≠–Ω–µ—Ä–≥–∏—è</b>50 TC<button onclick="api('buy',{id:'energy'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–†–µ–º–æ–Ω—Ç</b>50 TC<button onclick="api('buy',{id:'repair'})">–ö–£–ü–ò–¢–¨</button></div>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="this.parentElement.classList.toggle('open')" style="color:var(--gold)">üíé VIP (STARS) <span>‚ñº</span></div>
        <div class="acc-body">
            <div class="stat-mini"><b>–¢–∏—Ç–∞–Ω</b>150 ‚≠ê<button onclick="api('buy',{id:'titan'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–ü—Ä–∏–∫–æ—Ä–º</b>200 ‚≠ê<button onclick="api('buy',{id:'bait'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–°–Ω–∞—Å—Ç–∏+</b>200 ‚≠ê<button onclick="api('buy',{id:'strong'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–û–∑–µ—Ä–æ</b>500 ‚≠ê<button onclick="api('buy',{id:'license'})">–ö–£–ü–ò–¢–¨</button></div>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="this.parentElement.classList.toggle('open')">üí≥ –í–´–í–û–î –°–†–ï–î–°–¢–í <span>‚ñº</span></div>
        <div class="acc-body" style="grid-template-columns: 1fr; display:none;">
            <input id="w-wallet" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ (TON/–ö–∞—Ä—Ç–∞)">
            <input id="w-sum" type="number" placeholder="–°—É–º–º–∞ TC">
            <button onclick="withdraw()" style="background:#0088cc; color:white; border:none; padding:12px; border-radius:10px; font-weight:bold;">–°–û–ó–î–ê–¢–¨ –ó–ê–Ø–í–ö–£</button>
        </div>
    </div>
</div>

<div id="p-top" class="page">
    <h2 style="text-align:center; color:var(--gold);">üèÜ –õ–ò–î–ï–†–´</h2>
    <div id="top-list"></div>
</div>

<div id="p-info" class="page">
    <h2 style="color:var(--gold);">–ò–ù–§–û</h2>
    <div class="acc-item open">
        <div class="acc-head">–ü–†–ê–í–ò–õ–ê</div>
        <div class="acc-body" style="display:block; font-size:13px; opacity:0.8;">
            –†—ã–±–∞–ª–∫–∞: 2‚ö° –∑–∞ –∑–∞–±—Ä–æ—Å.<br>
            –ó–æ–ª–æ—Ç–æ–π —á–∞—Å: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 19:00.<br>
            –†–µ—Ñ–µ—Ä–∞–ª–∫–∞: –ü–æ–ª—É—á–∞–π 10% –æ—Ç –ø—Ä–æ–¥–∞–∂ –¥—Ä—É–∑–µ–π!
        </div>
    </div>
    <p style="font-size:11px; margin-top:20px;">–¢–í–û–Ø –°–°–´–õ–ö–ê:</p>
    <div id="ref-link" style="background:rgba(0,0,0,0.3); padding:10px; border-radius:8px; font-size:10px; color:var(--gold);"></div>
</div>

<nav>
    <a href="#" class="nav-item active" onclick="showP('p-game',this)"><i>üéÆ</i>–ò–ì–†–ê</a>
    <a href="#" class="nav-item" onclick="showP('p-sadok',this)"><i>üéí</i>–°–ê–î–û–ö</a>
    <a href="#" class="nav-item" onclick="showP('p-top',this)"><i>üèÜ</i>–¢–û–ü</a>
    <a href="#" class="nav-item" onclick="showP('p-info',this)"><i>‚ÑπÔ∏è</i>–ò–ù–§–û</a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const URL = 'https://tama-bot-server.onrender.com/api/action';
    let user = { lastBonus: 0 };

    tg.ready(); tg.expand();

    function showP(id, el) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active'));
        el.classList.add('active');
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ, –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ –≤ —Å–∞–¥–∫–µ
        if(id === 'p-sadok') {
            document.querySelectorAll('.acc-body').forEach(b => b.style.display = 'none');
            document.querySelectorAll('.acc-item').forEach(i => i.classList.remove('open'));
            document.querySelector('.acc-item').classList.add('open');
            document.querySelector('.acc-body').style.display = 'flex';
        }
    }

    async function api(action, payload = {}) {
        try {
            const r = await fetch(URL, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ userId: tg.initDataUnsafe.user?.id || "7883085758", userName: tg.initDataUnsafe.user?.first_name || "–†—ã–±–∞–∫", action, payload })
            });
            const d = await r.json();
            if (d.msg) {
                const t = document.getElementById('toast');
                t.innerText = d.msg; t.style.display='block';
                setTimeout(()=>t.style.display='none', 2500);
            }
            render(d);
            if (d.catchData) {
                const w = document.getElementById('wood-plate');
                document.getElementById('catch-res').innerHTML = `${d.catchData.type}<br>${d.catchData.w} –∫–≥`;
                w.classList.add('show');
            }
        } catch(e) { console.log(e); }
    }

    function render(d) {
        user = d;
        document.getElementById('u-b').innerText = Math.floor(d.b).toLocaleString();
        document.getElementById('u-fish').innerText = (d.fish || 0).toFixed(2);
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('u-dur').innerText = Math.max(0, d.dur) + '%';
        document.getElementById('u-box').innerText = d.boxes || 0;
        document.getElementById('log-line').innerText = d.logs.join('  ‚Ä¢  ');
        document.getElementById('ref-link').innerText = `https://t.me/TamacoinBot?start=${d.id}`;
        if(d.top) {
            document.getElementById('top-list').innerHTML = d.top.map((x,i)=>`<div class="stat-mini" style="margin-bottom:5px; display:flex; justify-content:space-between;"><span>${i+1}. ${x.n}</span><b>${x.b} TC</b></div>`).join('');
        }
    }

    function doCast() {
        const f = document.getElementById('fish-anim');
        const b = document.getElementById('btn-cast');
        f.style.display = 'block'; b.disabled = true;
        document.getElementById('status').innerText = "–õ–ï–°–ö–ê –í –í–û–î–ï...";
        setTimeout(() => {
            f.style.display = 'none'; b.disabled = false;
            document.getElementById('status').innerText = "–û–ö–ï–ê–ù –°–ü–û–ö–û–ï–ù";
            api('cast');
        }, 1300);
    }

    function withdraw() {
        const wallet = document.getElementById('w-wallet').value;
        const sum = document.getElementById('w-sum').value;
        if(!wallet || !sum) return;
        api('withdraw', {wallet, sum: parseInt(sum)});
    }

    // –¢–ê–ô–ú–ï–†–´
    setInterval(() => {
        const now = new Date();
        // –ó–æ–ª–æ—Ç–æ–π —á–∞—Å
        let target = new Date();
        target.setHours(19,0,0,0);
        if (now > target) target.setDate(target.getDate() + 1);
        let diff = target - now;
        
        const h = String(Math.floor(diff/3600000)).padStart(2,'0');
        const m = String(Math.floor((diff%3600000)/60000)).padStart(2,'0');
        const s = String(Math.floor((diff%60000)/1000)).padStart(2,'0');
        document.getElementById('t-gold').innerText = (now.getHours() === 19) ? "–ê–ö–¢–ò–í–ï–ù! üî•" : `${h}:${m}:${s}`;
        
        // –ë–æ–Ω—É—Å
        let bDiff = (user.lastBonus + 86400000) - Date.now();
        if(bDiff > 0) {
            const bh = String(Math.floor(bDiff/3600000)).padStart(2,'0');
            const bm = String(Math.floor((bDiff%3600000)/60000)).padStart(2,'0');
            const bs = String(Math.floor((bDiff%60000)/1000)).padStart(2,'0');
            document.getElementById('t-daily').innerText = `${bh}:${bm}:${bs}`;
            document.getElementById('btn-daily').style.display = 'none';
        } else
