<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tama Fishing 2026</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #070b1a; color: white; font-family: sans-serif; overflow: hidden; }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-120px); background: gold; color: #000; padding: 10px 20px; border-radius: 50px; font-weight: bold; z-index: 10000; transition: 0.5s; font-size: 14px; }
        #toast.show { transform: translateX(-50%) translateY(0); }
        
        .page { display: none; height: 100vh; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .page.active { display: flex; }
        
        .balance-val { font-size: 38px; color: gold; font-weight: 900; text-align: center; margin-top: 10px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .card { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px; border: 1px solid #333; text-align: center; }
        
        .game-zone { position: relative; flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #fishAnim { width: 260px; height: 260px; display: none; margin-bottom: 20px; }
        #idle-text { font-size: 16px; color: #3a4a6a; font-weight: bold; margin-bottom: 10px; }
        
        #cBtn { 
            position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%);
            background: #4CAF50; border: none; padding: 8px 0; border-radius: 10px; 
            color: white; font-weight: bold; width: 90%; font-size: 14px; 
            box-shadow: 0 3px 0 #2d5a27; z-index: 100; text-transform: uppercase;
        }
        #cBtn:active { transform: translateX(-50%) translateY(2px); box-shadow: 0 1px 0 #2d5a27; }
        
        .btn-action { background: #0288d1; border: none; padding: 15px; border-radius: 15px; color: white; font-weight: bold; box-shadow: 0 4px 0 #01579b; width: 100%; font-size: 13px; margin-top: 5px; }
        
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; height: 75px; background: #000; display: flex; border-top: 1px solid #333; }
        .nav-item { flex: 1; text-align: center; display: flex; flex-direction: column; justify-content: center; font-size: 12px; color: #555; }
        .nav-item.active { color: gold; font-weight: bold; }
        
        /* –ú–û–î–ê–õ–ö–ò */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 9000; }
        .modal-inner { background: #1a2235; padding: 20px; border-radius: 20px; width: 85%; max-height: 80vh; overflow-y: auto; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; background: #070b1a; color: white; border: 1px solid #333; box-sizing: border-box; }
        
        .shop-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .shop-info b { font-size: 14px; display: block; }
        .shop-info small { color: #888; font-size: 11px; }

        #ban-screen { display: none; flex-direction: column; height: 100vh; align-items: center; justify-content: center; text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <div id="toast"></div>

    <div id="ban-screen">
        <h1 style="color: #ff4444; font-size: 60px; margin: 0;">üö´</h1>
        <h2>–î–û–°–¢–£–ü –û–ì–†–ê–ù–ò–ß–ï–ù</h2>
        <p>–í—ã –±—ã–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã.</p>
    </div>

    <div id="wModal" class="modal">
        <div class="modal-inner">
            <h3 style="margin:0">üí≥ –í–´–í–û–î TC</h3>
            <p style="font-size: 11px; color: gold;">–í–Ω–∏–º–∞–Ω–∏–µ: –ö–æ—à–µ–ª–µ–∫ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞!</p>
            <input type="text" id="wallet" placeholder="TON –ö–æ—à–µ–ª–µ–∫">
            <input type="number" id="wAmount" placeholder="–°—É–º–º–∞ (–º–∏–Ω 30000)">
            <button class="btn-action" onclick="submitWithdraw()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
            <button class="btn-action" style="background:#444" onclick="closeW()">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div id="topModal" class="modal">
        <div class="modal-inner">
            <h3 style="margin:0">üèÜ –¢–û–ü –†–´–ë–ê–ö–û–í</h3>
            <div id="topList" style="margin: 15px 0;"></div>
            <button class="btn-action" onclick="document.getElementById('topModal').style.display='none'">–ü–û–ù–Ø–¢–ù–û</button>
        </div>
    </div>

    <div id="shopModal" class="modal">
        <div class="modal-inner">
            <h3 style="margin:0">üõí –ú–ê–ì–ê–ó–ò–ù STARS</h3>
            <p style="font-size: 11px; color: #888;">–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É –ø—Ä–∏–¥–µ—Ç –≤ –ª–∏—á–∫—É –±–æ—Ç–∞</p>
            <div style="margin: 15px 0;">
                <div class="shop-item">
                    <div class="shop-info"><b>–¢–∏—Ç–∞–Ω–æ–≤–∞—è –ª–µ—Å–∫–∞</b><small>–ü—Ä–æ—á–Ω–æ—Å—Ç—å -1 –≤–º–µ—Å—Ç–æ -2</small></div>
                    <button class="btn-action" style="width:auto; padding:5px 10px;" onclick="buyItem('titan_line')">50 ‚≠ê</button>
                </div>
                <div class="shop-item">
                    <div class="shop-info"><b>–ó–æ–ª–æ—Ç–∞—è –∫–∞—à–∞</b><small>+50% –∫ –≤–µ—Å—É —Ä—ã–±—ã</small></div>
                    <button class="btn-action" style="width:auto; padding:5px 10px;" onclick="buyItem('gold_bait')">100 ‚≠ê</button>
                </div>
                <div class="shop-item">
                    <div class="shop-info"><b>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</b><small>+30 —ç–Ω–µ—Ä–≥–∏–∏ –º–æ–ª–Ω–∏–µ–π</small></div>
                    <button class="btn-action" style="width:auto; padding:5px 10px;" onclick="buyItem('energy_pack')">30 ‚≠ê</button>
                </div>
            </div>
            <button class="btn-action" style="background:#444" onclick="document.getElementById('shopModal').style.display='none'">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div id="p-game" class="page active">
        <div class="balance-val"><span id="b1">0.00</span> TC</div>
        <div class="stat-grid">
            <div class="card"><small>–≠–ù–ï–†–ì–ò–Ø</small><br><span id="u-en">0</span></div>
            <div class="card"><small>–†–ê–ù–ì</small><br><span id="u-lvl">1</span></div>
        </div>
        <div class="game-zone">
            <div id="idle-text">üèù –¢–ò–•–ê–Ø –ó–ê–í–û–î–¨</div>
            <img src="fish_anim.webp" id="fishAnim">
            <button id="cBtn" onclick="doFish()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£</button>
        </div>
    </div>

    <div id="p-menu" class="page">
        <h2 style="text-align:center; margin-top:0">üéí –ú–ï–ù–Æ</h2>
        <div class="stat-grid">
            <div class="card"><small>–í–ï–° –†–´–ë–´</small><br><span id="s-fish">0.00</span></div>
            <div class="card"><small>–£–î–û–ß–ö–ê</small><br><span id="s-rod">100</span>%</div>
        </div>
        <button class="btn-action" style="background:#4CAF50" onclick="doAction('sell_fish')">üí∞ –ü–†–û–î–ê–¢–¨ (0.5)</button>
        <button class="btn-action" onclick="doAction('repair_rod')">üõ† –ß–ò–ù–ò–¢–¨ (10)</button>
        <button class="btn-action" style="background: linear-gradient(to right, #00d2ff, #3a7bd5)" onclick="document.getElementById('shopModal').style.display='flex'">üõí –ú–ê–ì–ê–ó–ò–ù STARS</button>
        <button class="btn-action" style="background:#6a1b9a" onclick="openTop()">üèÜ –¢–û–ü</button>
        <button class="btn-action" style="background:#e53935" onclick="openW()">üí≥ –í–´–í–û–î</button>
        <button class="btn-action" style="background:orange" onclick="shareRef()">üîó –ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê</button>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="tab('game', this)">üéÆ –ò–ì–†–ê</div>
        <div class="nav-item" onclick="tab('menu', this)">üéí –ú–ï–ù–Æ</div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    const url = 'https://tama-bot-server.onrender.com/api/action';
    let lastData = { top: [] };
    tg.ready(); tg.expand();

    function showToast(txt) {
        const t = document.getElementById('toast'); t.innerText = txt;
        t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2000);
    }

    async function load() {
        const uid = tg.initDataUnsafe?.user?.id || "569502967";
        try {
            const r = await fetch(`${url}?userId=${uid}`);
            lastData = await r.json();
            updateUI(lastData);
        } catch(e) {}
    }

    function updateUI(d) {
        // –ü–†–û–í–ï–†–ö–ê –ù–ê –ë–ê–ù
        if (d.banned) {
            document.getElementById('p-game').style.display = 'none';
            document.getElementById('p-menu').style.display = 'none';
            document.querySelector('.nav-bar').style.display = 'none';
            document.getElementById('ban-screen').style.display = 'flex';
            return;
        }

        document.getElementById('b1').innerText = Number(d.balance).toFixed(2);
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('u-lvl').innerText = d.level;
        document.getElementById('s-fish').innerText = Number(d.fish).toFixed(2);
        document.getElementById('s-rod').innerText = d.rod_durability;
        
        // –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω
        if (d.wallet) document.getElementById('wallet').value = d.wallet;
    }

    async function doAction(act, extra = {}) {
        const r = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ 
                userId: tg.initDataUnsafe?.user?.id || "569502967", 
                userName: tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫", 
                action: act, ...extra 
            })
        });
        const d = await r.json();
        if (d.msg && act !== 'catch_fish') showToast(d.msg);
        updateUI(d);
        return d;
    }

    async function doFish() {
        const btn = document.getElementById('cBtn');
        const anim = document.getElementById('fishAnim');
        const txt = document.getElementById('idle-text');
        
        // –ü–ï–†–ï–ó–ê–ü–£–°–ö –ì–ò–§–ö–ò
        anim.src = "fish_anim.webp?t=" + Date.now();
        btn.style.display = 'none'; txt.style.display = 'none'; anim.style.display = 'block';

        const d = await doAction('catch_fish');
        setTimeout(() => { if (d.msg) showToast(d.msg); }, 400);

        // –¢–ê–ô–ú–ò–ù–ì 1100 –º—Å
        setTimeout(() => {
            anim.style.display = 'none'; txt.style.display = 'block'; btn.style.display = 'block';
        }, 1100);
    }

    function buyItem(id) {
        doAction('buy_stars', { id });
        document.getElementById('shopModal').style.display = 'none';
    }

    function openW() { document.getElementById('wModal').style.display = 'flex'; }
    function closeW() { document.getElementById('wModal').style.display = 'none'; }
    
    function submitWithdraw() {
        const w = document.getElementById('wallet').value;
        const a = document.getElementById('wAmount').value;
        if (a < 30000) return showToast("–ú–∏–Ω. 30,000 TC");
        if (!w) return showToast("–í–≤–µ–¥–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫!");
        doAction('withdraw', { wallet: w, amount: a });
        closeW();
    }

    function openTop() {
        const list = lastData.top.map((u, i) => 
            `<div style="display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px solid #333">
                <span>${i+1}. ${u.n}</span>
                <b style="color:gold">${u.b.toFixed(2)}</b>
            </div>`
        ).join('');
        document.getElementById('topList').innerHTML = list || "–î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç";
        document.getElementById('topModal').style.display = 'flex';
    }

    function shareRef() {
        const uid = tg.initDataUnsafe?.user?.id || "569502967";
        const link = `https://t.me/Tama_fishing_2026_bot?start=${uid}`;
        const el = document.createElement('textarea'); el.value = link; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
        showToast("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=–õ–æ–≤–∏ —Ä—ã–±—É –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã!`);
    }

    function tab(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('p-' + id).classList.add('active');
        el.classList.add('active');
        load();
    }
    
    load();
    setInterval(load, 15000); // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫
</script>
</body>
</html>
