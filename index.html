<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TAMACOIN FISHING WORLD v4.4.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        :root {
            --gold: #FFD700;
            --gold-dark: #B8860B;
            --bg: #050810;
            --glass: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.12);
            --blue: #0088CC;
            --blue-dark: #005580;
            --red: #e91e63;
            --green: #4caf50;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            background-image: radial-gradient(circle at 50% 0%, #1a2a4a 0%, #050810 70%);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        /* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–õ–ê–®–ö–ò: –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –∏—Å—á–µ–∑–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é */
        #wood-alert {
            position: fixed;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            background: linear-gradient(135deg, #5d4037 0%, #3e2723 100%);
            color: #d7ccc8;
            padding: 20px 35px;
            border-radius: 20px;
            border: 3px solid #795548;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            text-align: center;
            font-weight: 800;
            font-size: 18px;
            display: none; /* –§–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ */
            animation: alertPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes alertPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–∏—è —è—â–∏–∫–∞ */
        #prize-modal {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            background: white;
            color: black;
            padding: 30px;
            border-radius: 30px;
            z-index: 20000;
            text-align: center;
            box-shadow: 0 0 100px rgba(255,215,0,0.6);
        }

        .page {
            display: none;
            height: 100vh;
            flex-direction: column;
            padding: 20px 20px 100px 20px;
            overflow-y: auto;
        }

        .page.active { display: flex; animation: pageIn 0.3s ease-out; }

        @keyframes pageIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –°–¢–ò–õ–ò –®–ê–ü–ö–ò –ò –ò–ù–¢–ï–†–§–ï–ô–°–ê */
        .header-info { text-align: center; margin-bottom: 10px; }
        .lvl-tag {
            display: inline-block;
            background: var(--gold);
            color: #000;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 8px;
            box-shadow: 0 4px 10px rgba(255, 215, 0, 0.2);
        }

        .balance-display { font-size: 42px; font-weight: 900; letter-spacing: -1px; }
        .balance-display span { color: var(--gold); font-size: 24px; }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .stat-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 12px 5px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-card b { display: block; font-size: 18px; color: white; }
        .stat-card small { font-size: 9px; color: #8892b0; text-transform: uppercase; font-weight: 700; }

        .lake-container {
            flex-grow: 1;
            background: rgba(0,0,0,0.2);
            border-radius: 30px;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 15px;
            overflow: hidden;
        }

        #fish-sprite {
            width: 200px;
            display: none;
            filter: drop-shadow(0 0 30px var(--blue));
            animation: fishSwim 1.5s ease-in-out;
        }

        #bag-captcha {
            position: absolute;
            width: 85px;
            display: none;
            z-index: 100;
            filter: drop-shadow(0 0 20px var(--gold));
            cursor: pointer;
        }

        /* –ö–ù–û–ü–ö–ò */
        .btn {
            border: none;
            border-radius: 24px;
            font-weight: 800;
            cursor: pointer;
            transition: 0.2s cubic-bezier(0.2, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .btn-main {
            background: linear-gradient(180deg, var(--blue) 0%, var(--blue-dark) 100%);
            padding: 22px;
            font-size: 20px;
            color: white;
            box-shadow: 0 8px 25px rgba(0, 136, 204, 0.3);
        }

        .btn-daily {
            background: linear-gradient(180deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: black;
            padding: 15px;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .btn:active { transform: scale(0.95); opacity: 0.9; }
        .btn:disabled { background: #333; color: #666; cursor: default; box-shadow: none; }

        /* –ú–ï–ù–Æ –ò –°–ï–ö–¶–ò–ò */
        .menu-section {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 22px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .section-head {
            padding: 18px 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
        }

        .section-body {
            display: none;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-top: 1px solid var(--glass-border);
        }

        .menu-section.open .section-body { display: block; }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stars-btn {
            background: linear-gradient(90deg, #FFD700, #FFA500);
            border: none;
            color: black;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 13px;
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-bar {
            position: fixed;
            bottom: 0; left: 0;
            width: 100%;
            height: 85px;
            background: rgba(5, 8, 16, 0.96);
            display: flex;
            border-top: 1px solid var(--glass-border);
            padding: 0 10px;
            backdrop-filter: blur(15px);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #556080;
            text-decoration: none;
            transition: 0.2s;
        }

        .nav-item.active { color: var(--gold); }
        .nav-item i { font-size: 24px; margin-bottom: 4px; }
        .nav-item span { font-size: 10px; font-weight: 700; text-transform: uppercase; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —è—â–∏–∫–∞ */
        @keyframes boxAction {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1); }
        }
        .box-moving { animation: boxAction 0.2s infinite; }

    </style>
</head>
<body>

<div id="wood-alert">–í–ï–°: 0.00 –ö–ì</div>

<div id="prize-modal">
    <h2 style="margin-top:0">–í–´–ò–ì–†–´–®! ‚ú®</h2>
    <div id="prize-amount" style="font-size: 36px; font-weight: 900; color: #B8860B; margin: 15px 0;">+0 TC</div>
    <button class="btn btn-main" style="padding: 12px; font-size: 14px;" onclick="closePrize()">–û–¢–õ–ò–ß–ù–û</button>
</div>

<div id="page-game" class="page active">
    <div class="header-info">
        <div id="user-level" class="lvl-tag">–ó–ê–ì–†–£–ó–ö–ê...</div>
        <div class="balance-display" id="display-balance">0 <span>TC</span></div>
    </div>

    <div class="stat-grid">
        <div class="stat-card"><small>–≠–ù–ï–†–ì–ò–Ø</small><b id="val-energy">0</b></div>
        <div class="stat-card"><small>–ü–†–û–ß–ù–û–°–¢–¨</small><b id="val-durability">0%</b></div>
        <div class="stat-card"><small>–Ø–©–ò–ö–ò</small><b id="val-boxes">0</b></div>
    </div>

    <div class="lake-container">
        <img src="https://cdn-icons-png.flaticon.com/512/2953/2953363.png" id="bag-captcha" onclick="handleBagClick()">
        <img src="https://cdn-icons-png.flaticon.com/512/2275/2275038.png" id="fish-sprite">
        <div style="position:absolute; bottom:15px; font-size:10px; color:#556080; font-weight:700;">–í–û–î–û–ï–ú –¢–ê–ú–ê–ö–û–ò–ù</div>
    </div>

    <div class="controls">
        <button id="btn-daily-bonus" class="btn btn-daily" onclick="triggerAction('get_daily')">–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° üéÅ</button>
        <button id="btn-cast" class="btn btn-main" onclick="processFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
    </div>
</div>

<div id="page-menu" class="page">
    <h2 style="margin-top:0">–ò–ù–í–ï–ù–¢–ê–†–¨ –ò –ú–ê–ì–ê–ó–ò–ù</h2>

    <div class="menu-section">
        <div class="section-head" onclick="toggleAccordion(this)"><span>üì¶ –ú–û–ò –Ø–©–ò–ö–ò</span><span>‚ñº</span></div>
        <div class="section-body" style="text-align:center;">
            <p>–î–æ—Å—Ç—É–ø–Ω–æ: <b id="val-boxes-menu">0</b> —à—Ç.</p>
            <img id="box-render" src="https://cdn-icons-png.flaticon.com/512/679/679821.png" style="width:100px; margin: 10px 0;">
            <button class="btn btn-main" style="padding: 12px; font-size: 14px;" onclick="startBoxOpening()">–û–¢–ö–†–´–¢–¨ –Ø–©–ò–ö ‚ú®</button>
        </div>
    </div>

    <div class="menu-section">
        <div class="section-head" onclick="toggleAccordion(this)"><span>üêü –ú–û–ô –£–õ–û–í</span><span>‚ñº</span></div>
        <div class="section-body">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>–í–µ—Å –≤ —Å—É–º–∫–µ: <b id="val-fish">0.00</b> –∫–≥</div>
                <button class="stars-btn" style="background:var(--blue); color:white;" onclick="triggerAction('sell_fish')">–ü–†–û–î–ê–¢–¨</button>
            </div>
        </div>
    </div>

    <div class="menu-section">
        <div class="section-head" onclick="toggleAccordion(this)" style="background: var(--gold); color: black;">
            <span>‚≠êÔ∏è –ü–†–ï–ú–ò–£–ú –ú–ê–ì–ê–ó–ò–ù</span><span>‚ñº</span>
        </div>
        <div class="section-body">
            <div class="shop-item"><div><b>–°—Ç–∞—Ä—Ç –ü–∞–∫</b><br><small>5–∫ TC + 5 —è—â–∏–∫–æ–≤</small></div><button class="stars-btn" onclick="triggerAction('buy_stars',{itemId:'item_1'})">50 ‚≠êÔ∏è</button></div>
            <div class="shop-item"><div><b>–õ–∏—Ü–µ–Ω–∑–∏—è X2</b><br><small>–¶–µ–Ω–∞ —Ä—ã–±—ã x2 –≤–µ—á–Ω–æ</small></div><button class="stars-btn" onclick="triggerAction('buy_stars',{itemId:'item_2'})">499 ‚≠êÔ∏è</button></div>
            <div class="shop-item"><div><b>–ù–∞–±–æ—Ä "–ö–ò–¢"</b><br><small>50–∫ TC + –≠–Ω–µ—Ä–≥–∏—è</small></div><button class="stars-btn" onclick="triggerAction('buy_stars',{itemId:'item_3'})">999 ‚≠êÔ∏è</button></div>
            <div class="shop-item"><div><b>–ù–µ–æ–Ω–æ–≤–∞—è –£–¥–∞</b><br><small>–ù–µ –ª–æ–º–∞–µ—Ç—Å—è</small></div><button class="stars-btn" onclick="triggerAction('buy_stars',{itemId:'item_4'})">1499 ‚≠êÔ∏è</button></div>
            <div class="shop-item"><div><b>–°–∫–ª–∞–¥ —è—â–∏–∫–æ–≤</b><br><small>10 –ú–µ–≥–∞-—è—â–∏–∫–æ–≤</small></div><button class="stars-btn" onclick="triggerAction('buy_stars',{itemId:'item_5'})">299 ‚≠êÔ∏è</button></div>
            <div class="shop-item"><div><b>VIP –°—Ç–∞—Ç—É—Å</b><br><small>–≠–Ω–µ—Ä–≥–∏—è 200 –µ–¥.</small></div><button class="stars-btn" onclick="triggerAction('buy_stars',{itemId:'item_6'})">799 ‚≠êÔ∏è</button></div>
        </div>
    </div>

    <div class="menu-section">
        <div class="section-head" onclick="toggleAccordion(this)"><span>üí≥ –í–´–í–û–î –°–†–ï–î–°–¢–í</span><span>‚ñº</span></div>
        <div class="section-body">
            <input type="text" id="inp-wallet" placeholder="–í–∞—à TON –∫–æ—à–µ–ª–µ–∫" style="width:100%; padding:15px; background:#000; border:1px solid #333; color:white; border-radius:15px; margin-bottom:10px;">
            <input type="number" id="inp-amount" placeholder="–°—É–º–º–∞ (–æ—Ç 30 000)" style="width:100%; padding:15px; background:#000; border:1px solid #333; color:white; border-radius:15px; margin-bottom:15px;">
            <button class="btn btn-main" style="background:var(--red);" onclick="requestWithdrawal()">–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£</button>
        </div>
    </div>
</div>

<nav class="nav-bar">
    <a href="javascript:void(0)" class="nav-item active" onclick="switchTab('page-game', this)"><i>üéÆ</i><span>–ò–≥—Ä–∞</span></a>
    <a href="javascript:void(0)" class="nav-item" onclick="switchTab('page-menu', this)"><i>üéí</i><span>–ú–µ–Ω—é</span></a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const API_URL = 'https://tama-bot-server.onrender.com/api/action'; // –ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê –°–í–û–ô
    
    let userState = { castCount: 0 };

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–ª–∞—à–∫–∞ —Ç–µ–ø–µ—Ä—å –∏—Å—á–µ–∑–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏
    function showWoodAlert(text) {
        const el = document.getElementById('wood-alert');
        el.innerText = text;
        el.style.display = 'block';
        
        setTimeout(() => {
            el.style.display = 'none';
        }, 2500);
    }

    function toggleAccordion(el) {
        el.parentElement.classList.toggle('open');
    }

    function switchTab(pageId, navEl) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        navEl.classList.add('active');
        tg.HapticFeedback.impactOccurred('light');
    }

    async function triggerAction(action, extra = {}) {
        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: tg.initDataUnsafe?.user?.id || "7883085758",
                    userName: tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫",
                    action, ...extra
                })
            });
            const data = await response.json();
            
            if (data.msg && action !== 'load_data') {
                if (action === 'catch_fish') showWoodAlert(data.msg);
                else tg.showAlert(data.msg);
            }

            if (data.winAmount) {
                document.getElementById('prize-amount').innerText = `+${data.winAmount} TC`;
                document.getElementById('prize-modal').style.display = 'block';
            }

            refreshUI(data);
        } catch (e) {
            console.error("API Error:", e);
        }
    }

    function refreshUI(d) {
        if (!d || !d.id) return;
        userState.castCount = d.castCount;
        
        document.getElementById('display-balance').innerHTML = Math.floor(d.b).toLocaleString() + ' <span>TC</span>';
        document.getElementById('val-energy').innerText = Math.floor(d.energy);
        document.getElementById('val-durability').innerText = d.durability + '%';
        document.getElementById('val-boxes').innerText = d.boxes;
        document.getElementById('val-boxes-menu').innerText = d.boxes;
        document.getElementById('val-fish').innerText = (d.fish || 0).toFixed(2);
        document.getElementById('user-level').innerText = d.level || "–°–ê–õ–ê–ì–ê üå±";
    }

    function processFishing() {
        if ((userState.castCount + 1) % 5 === 0) {
            const bag = document.getElementById('bag-captcha');
            bag.style.left = (Math.random() * 60 + 10) + "%";
            bag.style.top = (Math.random() * 60 + 10) + "%";
            bag.style.display = 'block';
            document.getElementById('btn-cast').disabled = true;
            tg.HapticFeedback.notificationOccurred('warning');
        } else {
            const fish = document.getElementById('fish-sprite');
            fish.style.display = 'block';
            tg.HapticFeedback.impactOccurred('medium');
            setTimeout(() => {
                fish.style.display = 'none';
                triggerAction('catch_fish');
            }, 1200);
        }
    }

    function handleBagClick() {
        document.getElementById('bag-captcha').style.display = 'none';
        document.getElementById('btn-cast').disabled = false;
        triggerAction('catch_fish', { captchaPassed: true });
    }

    function startBoxOpening() {
        const count = parseInt(document.getElementById('val-boxes-menu').innerText);
        if (count <= 0) return tg.showAlert("–ù–µ—Ç —è—â–∏–∫–æ–≤!");
        
        const img = document.getElementById('box-render');
        img.classList.add('box-moving');
        tg.HapticFeedback.impactOccurred('heavy');

        setTimeout(() => {
            img.classList.remove('box-moving');
            triggerAction('open_box');
        }, 1500);
    }

    function closePrize() {
        document.getElementById('prize-modal').style.display = 'none';
    }

    function requestWithdrawal() {
        const wallet = document.getElementById('inp-wallet').value;
        const amount = document.getElementById('inp-amount').value;
        if (!wallet || amount < 30000) return tg.showAlert("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ!");
        triggerAction('withdraw', { wallet, amount });
    }

    tg.ready();
    tg.expand();
    triggerAction('load_data');
</script>
</body>
</html>
