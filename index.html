<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Crypto Fishing</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --dark: #0a0e1a; --wood: #5d4037; --glass: rgba(255,255,255,0.07); }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }
        
        /* –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ */
        #news-line { background: rgba(255, 215, 0, 0.1); color: var(--gold); padding: 8px 0; font-size: 11px; border-bottom: 1px solid rgba(255,215,0,0.2); overflow: hidden; white-space: nowrap; }
        #news-content { display: inline-block; animation: marquee 25s linear infinite; padding-left: 100%; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .page { display: none; height: calc(100vh - 75px); padding: 15px; box-sizing: border-box; flex-direction: column; overflow-y: auto; }
        .page.active { display: flex; }

        /* –ü–ª–∞—à–∫–∞ —É–ª–æ–≤–∞ */
        #wood-plate { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0); background: var(--wood); border: 3px solid #3e2723; border-radius: 12px; padding: 20px; text-align: center; width: 70%; z-index: 2000; box-shadow: 0 10px 40px rgba(0,0,0,0.9); transition: 0.4s; }
        #wood-plate.show { transform: translate(-50%, -50%) scale(1); }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        .acc-item { background: var(--glass); border-radius: 12px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.1); }
        .acc-head { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; }
        .acc-body { display: none; padding: 15px; grid-template-columns: 1fr 1fr; gap: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
        .acc-item.open .acc-body { display: grid; }

        .lake-zone { height: 200px; position: relative; background: radial-gradient(circle, #1a2a44 0%, #0a0e1a 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; border: 1px solid rgba(0,136,204,0.3); transition: 0.5s; }
        #fish-anim { width: 80px; display: none; animation: pulse 0.6s infinite alternate; }
        @keyframes pulse { from { transform: scale(0.8); } to { transform: scale(1.2); } }

        .btn-cast { width: 100%; padding: 20px; background: var(--gold); border: none; border-radius: 15px; font-weight: 900; font-size: 18px; color: #000; box-shadow: 0 4px 15px rgba(255,215,0,0.3); }
        .btn-cast:disabled { background: #555; opacity: 0.6; }

        nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #0d121f; display: flex; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #5a6275; text-decoration: none; }
        .nav-item.active { color: var(--gold); }

        .toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: var(--gold); color: #000; padding: 10px 20px; border-radius: 20px; display:none; z-index:3000; font-weight:bold; font-size: 13px; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; background: rgba(0,0,0,0.4); border: 1px solid #444; color: #fff; border-radius: 8px; }
        .shop-btn { background: #2e7d32; color: white; border: none; padding: 8px; border-radius: 6px; font-weight: bold; width: 100%; }
    </style>
</head>
<body>

<div id="news-line">
    <div id="news-content">–û–∂–∏–¥–∞–Ω–∏–µ —Å–≤–æ–¥–æ–∫ —Å –≤–æ–¥–æ–µ–º–æ–≤... üé£</div>
</div>

<div id="toast" class="toast"></div>

<div id="wood-plate" onclick="this.classList.remove('show')">
    <div style="font-size:12px; opacity:0.8; color:white;">–í–ê–® –£–õ–û–í:</div>
    <p id="catch-res" style="font-size: 26px; font-weight: 900; margin: 15px 0; color: #fff;"></p>
    <div style="font-size:10px; color:var(--gold);">–ù–ê–ñ–ú–ò, –ß–¢–û–ë–´ –£–ë–†–ê–¢–¨</div>
</div>

<div id="p-game" class="page active">
    <div style="text-align:center; margin: 10px 0;">
        <div id="u-b" style="font-size:42px; font-weight:900; color:var(--gold);">0</div>
        <div style="font-size:12px; opacity:0.6; letter-spacing: 2px;">TAMACON (TC)</div>
    </div>

    <div style="display:flex; gap:10px; margin-bottom:15px;">
        <div style="flex:1; background:var(--glass); padding:10px; border-radius:12px; text-align:center;">‚ö° <span id="u-en">0</span></div>
        <div style="flex:1; background:var(--glass); padding:10px; border-radius:12px; text-align:center;">üõ†Ô∏è <span id="u-dur">0%</span></div>
    </div>

    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
        <button id="loc-sea" onclick="setLoc('sea')" style="flex:1; padding:12px; border-radius:10px; border:none; background: var(--gold); font-weight:bold;">üåä –ú–û–†–ï</button>
        <button id="loc-lake" onclick="setLoc('hope_lake')" style="flex:1; padding:12px; border-radius:10px; border:none; background: rgba(255,255,255,0.1); font-weight:bold; color:white;">‚ú® –û–ó–ï–†–û</button>
    </div>

    <div id="ocean" class="lake-zone">
        <img src="https://cdn-icons-png.flaticon.com/512/2274/2274532.png" id="fish-anim">
    </div>

    <button id="btn-cast" class="btn-cast" onclick="doCast()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
    <button id="btn-daily" style="margin-top:10px; width:100%; padding:12px; background:#2e7d32; border:none; color:white; border-radius:10px; font-weight:bold; display:none;" onclick="api('get_daily')">üéÅ –ë–û–ù–£–°</button>
</div>

<div id="p-shop" class="page">
    <div class="acc-item open">
        <div class="acc-head">üêü –°–ê–î–û–ö</div>
        <div class="acc-body" style="display:flex; justify-content:space-between; grid-template-columns:none;">
            <span>–í–µ—Å: <b id="u-fish">0</b> –∫–≥</span>
            <button onclick="api('sell')" style="background:var(--gold); border:none; padding:8px 15px; border-radius:8px; font-weight:bold;">–ü–†–û–î–ê–¢–¨</button>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)">üõí –ú–ê–ì–ê–ó–ò–ù TC <span>‚ñº</span></div>
        <div class="acc-body">
            <div style="text-align:center; font-size:12px;">–ú—è–∫–∏—à (100)<button class="shop-btn" onclick="api('buy',{id:'myakish'})">–ö–£–ü–ò–¢–¨</button></div>
            <div style="text-align:center; font-size:12px;">–†–µ–º–æ–Ω—Ç (50)<button class="shop-btn" onclick="api('buy',{id:'repair'})">–ö–£–ü–ò–¢–¨</button></div>
            <div style="text-align:center; font-size:12px;">–≠–Ω–µ—Ä–≥–∏—è (50)<button class="shop-btn" onclick="api('buy',{id:'energy'})">–ö–£–ü–ò–¢–¨</button></div>
            <div style="text-align:center; font-size:12px;">–õ–∏—Ü–µ–Ω–∑–∏—è (1000)<button class="shop-btn" onclick="api('buy',{id:'license'})">–ö–£–ü–ò–¢–¨</button></div>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)">üí≥ –í–´–í–û–î (–æ—Ç 30–∫) <span>‚ñº</span></div>
        <div class="acc-body" style="grid-template-columns:1fr;">
            <input id="w-wallet" placeholder="–í–∞—à TON –ö–æ—à–µ–ª–µ–∫">
            <input id="w-sum" type="number" placeholder="–°—É–º–º–∞ TC">
            <button onclick="withdraw()" style="background:#0088cc; color:white; border:none; padding:12px; border-radius:10px; font-weight:bold;">–°–û–ó–î–ê–¢–¨ –ó–ê–Ø–í–ö–£</button>
        </div>
    </div>
</div>

<div id="p-info" class="page">
    <h3 style="color:var(--gold);">–ü–†–ê–í–ò–õ–ê –ò–ì–†–´</h3>
    <p style="font-size:13px; opacity:0.8;">–õ–æ–≤–∏—Ç–µ —Ä—ã–±—É, –∫–æ–ø–∏—Ç–µ Tamacoin –∏ –≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –ª–∏—Å—Ç–∏–Ω–≥—É! <br><br>
    - üåä <b>–ú–æ—Ä–µ:</b> –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö.<br>
    - ‚ú® <b>–û–∑–µ—Ä–æ:</b> –Ω—É–∂–µ–Ω VIP –ø—Ä–æ–ø—É—Å–∫. –†—ã–±–∞ x2, –µ—Å—Ç—å –ó–æ–ª–æ—Ç–æ–π –ö–∞—Ä–ø (5000 TC).<br>
    - üí≥ <b>–í—ã–≤–æ–¥:</b> –æ—Ç 30,000 TC –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–æ–º.</p>
    
    <div id="ref-section" style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-top:20px;">
        <div style="font-size:12px; color:var(--gold); margin-bottom:10px;">–í–ê–®–ê –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê:</div>
        <div id="ref-link" style="font-size:11px; word-break:break-all; margin-bottom:10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
</div>

<nav>
    <a href="#" class="nav-item active" onclick="showP('p-game',this)">–ò–ì–†–ê</a>
    <a href="#" class="nav-item" onclick="showP('p-shop',this)">–ú–ê–ì–ê–ó–ò–ù</a>
    <a href="#" class="nav-item" onclick="showP('p-info',this)">–ò–ù–§–û</a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const URL = 'https://tama-bot-server.onrender.com/api/action'; // –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ô
    let user = {};
    let currentLoc = 'sea';

    tg.ready();
    tg.expand();

    function showP(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    function toggleAcc(el) { el.parentElement.classList.toggle('open'); }
    
    function toast(txt) {
        const t = document.getElementById('toast');
        t.innerText = txt; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2500);
    }

    function setLoc(loc) {
        currentLoc = loc;
        document.getElementById('loc-sea').style.background = (loc === 'sea') ? 'var(--gold)' : 'rgba(255,255,255,0.1)';
        document.getElementById('loc-sea').style.color = (loc === 'sea') ? 'black' : 'white';
        document.getElementById('loc-lake').style.background = (loc === 'hope_lake') ? 'var(--gold)' : 'rgba(255,255,255,0.1)';
        document.getElementById('loc-lake').style.color = (loc === 'hope_lake') ? 'black' : 'white';
        document.getElementById('ocean').style.background = (loc === 'hope_lake') ? 'radial-gradient(circle, #2c3e50 0%, #000 100%)' : 'radial-gradient(circle, #1a2a44 0%, #0a0e1a 100%)';
    }

    async function api(action, payload = {}) {
        try {
            const uid = tg.initDataUnsafe?.user?.id || "12345";
            const uname = tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫";
            const r = await fetch(URL, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ userId: uid, userName: uname, action, payload })
            });
            const d = await r.json();
            if (d.isBanned) { document.body.innerHTML = "<h1 style='color:red;text-align:center;margin-top:50px;'>–í–´ –ó–ê–ë–ê–ù–ï–ù–´</h1>"; return; }
            if (d.msg) toast(d.msg);
            render(d);
            if (d.catchData) {
                document.getElementById('catch-res').innerHTML = `${d.catchData.type}<br><span style="color:var(--gold)">${d.catchData.w}</span>`;
                document.getElementById('wood-plate').classList.add('show');
            }
        } catch(e) { console.error(e); }
    }

    function render(d) {
        user = d;
        document.getElementById('u-b').innerText = Math.floor(d.b).toLocaleString();
        document.getElementById('u-fish').innerText = (d.fish || 0).toFixed(2);
        document.getElementById('u-en').innerText = d.energy || 0;
        document.getElementById('u-dur').innerText = Math.max(0, d.dur || 0) + '%';
        
        // –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞
        if (d.logs) {
            document.getElementById('news-content').innerText = d.logs.join('  ‚Ä¢  ');
        }

        // –ë–æ–Ω—É—Å
        const canBonus = (Date.now() - d.lastBonus > 86400000);
        document.getElementById('btn-daily').style.display = canBonus ? 'block' : 'none';

        // –†–µ—Ñ–∫–∞
        const rUrl = "https://t.me/–¢–í–û–ô_–ë–û–¢?start=" + d.id;
        document.getElementById('ref-link').innerHTML = `${rUrl} <br><button onclick="copyR('${rUrl}')" style="margin-top:10px; padding:5px 10px; background:var(--gold); border:none; border-radius:5px; font-size:10px; font-weight:bold;">–ö–û–ü–ò–†–û–í–ê–¢–¨</button>`;
    }

    function copyR(txt) {
        const el = document.createElement('textarea'); el.value = txt; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
    }

    function doCast() {
        if (user.energy < 2) return toast("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏!");
        const f = document.getElementById('fish-anim');
        const b = document.getElementById('btn-cast');
        f.style.display = 'block'; b.disabled = true;
        setTimeout(() => {
            f.style.display = 'none'; b.disabled = false;
            api('cast', { location: currentLoc });
        }, 1200);
    }

    function withdraw() {
        const w = document.getElementById('w-wallet').value;
        const s = document.getElementById('w-sum').value;
        if (!w || !s) return toast("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");
        api('withdraw', { wallet: w, sum: s });
    }

    api('load');
    setInterval(() => api('load'), 60000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É
</script>
</body>
</html>

