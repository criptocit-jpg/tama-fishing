<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tama Fishing PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #0a1128; font-family: 'Arial', sans-serif; color: white; overflow: hidden; }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∫–ª–∞–¥–æ–∫ */
        .page { display: none; height: 100vh; width: 100vw; position: relative; }
        .page.active { display: flex; flex-direction: column; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è (–ù–∏–∂–Ω–µ–µ –º–µ–Ω—é) */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: rgba(0, 0, 0, 0.9); display: flex; 
            justify-content: space-around; align-items: center; border-top: 1px solid #333; z-index: 1000;
        }
        .nav-item { text-align: center; font-size: 12px; color: #888; transition: 0.3s; }
        .nav-item.active { color: #ffd700; transform: scale(1.1); }
        .nav-item i { display: block; font-size: 24px; margin-bottom: 4px; }

        /* –°—Ç–∏–ª–∏ –°–∞–¥–∫–∞ –∏ –ú–∞–≥–∞–∑–∏–Ω–∞ */
        .content-area { padding: 20px; text-align: center; flex-grow: 1; overflow-y: auto; }
        .stat-card { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #444; }
        .btn-action { background: #4CAF50; color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; margin-top: 10px; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ä—ã–±—ã (–∫–∞–∫ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑) */
        #fishAnim { position: absolute; top: 30%; left: 50%; transform: translateX(-50%); width: 250px; display: none; }

        .balance-header { font-size: 24px; color: #ffd700; margin: 10px 0; }
    </style>
</head>
<body>

    <div id="page-game" class="page active">
        <div class="content-area">
            <div class="balance-header">üí∞ <span id="game-balance">0.00</span> TC</div>
            <img src="" id="fishAnim">
            <div style="margin-top: auto; padding-bottom: 100px;">
                <button class="btn-action" id="catchBtn" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
            </div>
        </div>
    </div>

    <div id="page-sadok" class="page">
        <div class="content-area">
            <h2>üéí –¢–í–û–ô –°–ê–î–û–ö</h2>
            <div class="stat-card">
                <p>–†—ã–±—ã –≤ —Å–∞–¥–∫–µ: <b id="sadok-fish">0</b> –∫–≥</p>
                <p>–ü—Ä–æ—á–Ω–æ—Å—Ç—å —É–¥–æ—á–∫–∏: <b id="sadok-rod">100</b>%</p>
            </div>
            <button class="btn-action" style="background: #e53935;" onclick="sellFish()">–ü–†–û–î–ê–¢–¨ –í–°–Æ –†–´–ë–£ üí∞</button>
            <button class="btn-action" style="background: #0288d1;" onclick="repairRod()">–ü–û–ß–ò–ù–ò–¢–¨ –£–î–û–ß–ö–£ (5 TC)</button>
        </div>
    </div>

    <div id="page-shop" class="page">
        <div class="content-area">
            <h2>üõí –ú–ê–ì–ê–ó–ò–ù</h2>
            <div class="stat-card">
                <p>üõ∞ –≠—Ö–æ–ª–æ—Ç (3 –∑–∞—Ä—è–¥–∞)</p>
                <button class="btn-action">–ö–£–ü–ò–¢–¨ (0.5 USDT)</button>
            </div>
            <div class="stat-card">
                <p>üåä –û–∑–µ—Ä–æ –ù–∞–¥–µ–∂–¥—ã</p>
                <button class="btn-action">–û–¢–ö–†–´–¢–¨ (1.0 USDT)</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showPage('game', this)"><span>üé£</span><br>–ò–≥—Ä–∞</div>
        <div class="nav-item" onclick="showPage('sadok', this)"><span>üéí</span><br>–°–∞–¥–æ–∫</div>
        <div class="nav-item" onclick="showPage('shop', this)"><span>üõí</span><br>–ú–∞–≥–∞–∑–∏–Ω</div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    const SERVER_URL = 'https://tama-bot-server.onrender.com/api/action';
    const userId = tg.initDataUnsafe?.user?.id || 569502967;

    function showPage(pageId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        el.classList.add('active');
        updateData(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
    }

    async function updateData() {
        const res = await fetch(`${SERVER_URL}?userId=${userId}`);
        const data = await res.json();
        document.getElementById('game-balance').innerText = data.balance.toFixed(2);
        document.getElementById('sadok-fish').innerText = data.fish.toFixed(2);
        document.getElementById('sadok-rod').innerText = data.rod_durability;
    }

    async function startFishing() {
        const btn = document.getElementById('catchBtn');
        const anim = document.getElementById('fishAnim');
        btn.disabled = true;

        setTimeout(async () => {
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            anim.src = "fish_anim.webp?t=" + new Date().getTime();
            anim.style.display = 'block';

            await fetch(SERVER_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ userId, action: 'catch_fish' })
            });

            setTimeout(() => {
                anim.style.display = 'none';
                btn.disabled = false;
                updateData();
            }, 2000);
        }, 1500);
    }

    async function sellFish() {
        await fetch(SERVER_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ userId, action: 'sell_fish' })
        });
        updateData();
        tg.showAlert("–†—ã–±–∞ –ø—Ä–æ–¥–∞–Ω–∞!");
    }

    // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    updateData();
    tg.expand();
</script>
</body>
</html>
