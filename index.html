<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tamacoin Fishing Gold 4.1.5</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffd700; --bg: #0f172a; --panel: rgba(30, 41, 59, 0.9); }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 0; overflow: hidden; height: 100vh; }

        .marquee { background: #020617; height: 26px; overflow: hidden; display: flex; align-items: center; border-bottom: 1px solid var(--gold); }
        .marquee-content { white-space: nowrap; animation: scroll 25s linear infinite; font-size: 13px; color: var(--gold); }
        @keyframes scroll { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        .timers-row { display: flex; justify-content: space-between; padding: 8px 15px; font-family: monospace; font-size: 11px; background: rgba(0,0,0,0.3); }
        .timer-val { color: var(--gold); font-weight: bold; }

        .balance-container { display: flex; justify-content: center; margin: 5px 0; }
        .balance-main { 
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 5px 20px; border-radius: 20px; border: 1px solid var(--gold);
            min-width: 130px; text-align: center;
        }
        .balance-value { font-size: 18px; font-weight: 900; color: var(--gold); }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 0 10px 10px 10px; }
        .stat-card { background: var(--panel); border: 1px solid #334155; border-radius: 10px; padding: 6px; text-align: center; }
        .stat-card span { display: block; font-size: 9px; text-transform: uppercase; color: #94a3b8; }

        /* --- –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê --- */
        #game-area { height: 40vh; width: 100%; position: relative; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #1e293b 0%, #0f172a 100%); }
        
        /* –ü–æ–ø–ª–∞–≤–æ–∫ —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        .float { width: 120px; height: 120px; display: none; z-index: 10; }
        .float-active { display: block; animation: bobbing 0.65s ease-in-out infinite; } 
        @keyframes bobbing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        #catch-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        .catch-modal { background: #5d4037; padding: 15px; border: 3px solid #3e2723; border-radius: 15px; text-align: center; width: 75%; }

        /* --- –ö–ù–û–ü–ö–ò --- */
        .controls { position: fixed; bottom: 65px; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 8px; z-index: 90; }
        
        .btn-main { 
            width: 92%; height: 50px; border-radius: 10px; border: none;
            font-size: 18px; font-weight: 800; color: white; cursor: pointer;
            transition: 0.1s; display: block;
        }
        .btn-cast { background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%); box-shadow: 0 4px 0 #92400e; }
        .btn-bonus { background: #10b981; box-shadow: 0 4px 0 #065f46; margin-bottom: 5px; }
        .btn-main:active { transform: translateY(3px); box-shadow: none; }
        .btn-main:disabled { background: #4b5563; box-shadow: none; opacity: 0.5; }

        .tab-content { display: none; padding: 15px; height: 65vh; overflow-y: auto; padding-bottom: 110px; }
        .tab-active { display: block; }
        
        .top-table { width: 100%; border-collapse: collapse; }
        .top-table td { padding: 10px; border-bottom: 1px solid #334155; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 55px; background: #020617; border-top: 1px solid #334155; display: flex; z-index: 100; }
        .nav-item { flex: 1; text-align: center; color: #64748b; font-size: 10px; padding-top: 8px; }
        .nav-item i { display: block; font-size: 18px; }
        .nav-item.active { color: var(--gold); }
    </style>
</head>
<body>

    <div class="header">
        <div class="marquee"><div class="marquee-content" id="events-line">Tamacoin 4.1.5 –∑–∞–≥—Ä—É–∂–µ–Ω...</div></div>
        <div class="timers-row">
            <div>üåÖ –ó–æ–ª–æ—Ç–æ–π —á–∞—Å: <span id="gold-timer" class="timer-val">00:00:00</span></div>
            <div>üéÅ –ë–æ–Ω—É—Å —á–µ—Ä–µ–∑: <span id="bonus-timer" class="timer-val">...</span></div>
        </div>
    </div>

    <div class="balance-container">
        <div class="balance-main">
            <div class="balance-value"><span id="main-balance">0</span> TC</div>
        </div>
    </div>

    <div id="tab-main" class="tab-content tab-active">
        <div class="stats-grid">
            <div class="stat-card"><span>–≠–Ω–µ—Ä–≥–∏—è</span><b id="energy">...</b></div>
            <div class="stat-card"><span>–£–¥–æ—á–∫–∞</span><b id="dur">...</b></div>
            <div class="stat-card"><span>–î–∂–µ–∫–ø–æ—Ç</span><b id="jackpot" style="color:var(--gold)">...</b></div>
        </div>
        
        <div id="game-area">
            <img id="float-img" src="fish_anim.webp" class="float">
            <div id="status-msg" style="position:absolute; bottom:20px; color:#3b82f6; font-weight:bold;"></div>
            
            <div id="catch-overlay">
                <div class="catch-modal">
                    <h3 style="color:var(--gold); margin:0;">–£–õ–û–í! üêü</h3>
                    <div id="catch-info" style="font-size: 20px; margin:15px 0; font-weight:bold; color:white;"></div>
                    <button class="btn-main btn-cast" style="width:100%; height:40px; font-size:14px;" onclick="closeCatch()">–ó–ê–ë–†–ê–¢–¨</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-shop" class="tab-content">
        <h3 style="text-align:center;">–†—ã–Ω–æ–∫</h3>
        <button class="btn-main btn-cast" style="width:100%; margin-bottom:20px;" onclick="doAction('sell')">–ü–†–û–î–ê–¢–¨ –†–´–ë–£</button>
        <div id="shop-items"></div>
    </div>

    <div id="tab-top" class="tab-content">
        <h3 style="text-align:center; color:var(--gold);">–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h3>
        <table class="top-table" id="top-list"></table>
    </div>

    <div id="tab-info" class="tab-content">
        <h3 style="text-align:center;">–ò–Ω—Ñ–æ-–ø–∞–Ω–µ–ª—å</h3>
        <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; font-size:14px;">
            <p>üÜî –¢–≤–æ–π ID: <span id="stat-id">...</span></p>
            <p>üé£ –í—Å–µ–≥–æ –∑–∞–±—Ä–æ—Å–æ–≤: <span id="stat-total">0</span></p>
            <p>üí∞ –ë–∞–ª–∞–Ω—Å: <span id="stat-balance">0</span> TC</p>
            <hr style="border:0; border-top:1px solid #334155; margin:10px 0;">
            <p style="font-size:12px; color:#94a3b8;">* –î–∂–µ–∫–ø–æ—Ç –≤—ã–¥–∞–µ—Ç—Å—è —Å–∞–º–æ–º—É –∞–∫—Ç–∏–≤–Ω–æ–º—É —Ä—ã–±–∞–∫—É –≤ –∫–æ–Ω—Ü–µ –Ω–µ–¥–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; margin-bottom:10px; text-align:left; line-height:1.4; font-size: 13px;">
            <b>üé£ –ö–∞–∫ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å</b><br>
            ‚Ä¢ –†—ã–±–∞–ª–∫–∞<br>
            ‚Ä¢ –ó–æ–ª–æ—Ç–æ–π —á–∞—Å<br>
            ‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã<br>
            ‚Ä¢ –†–µ–¥–∫–∏–µ —Å–æ–±—ã—Ç–∏—è<br>
            ‚Ä¢ –î–∂–µ–∫–ø–æ—Ç<br>
            ‚Ä¢ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
        </div>
    </div>

    <div class="controls" id="main-controls">
        <button id="bonus-btn" class="btn-main btn-bonus" onclick="doAction('get_daily')">–ü–û–õ–£–ß–ò–¢–¨ –ë–û–ù–£–°</button>
        <button id="cast-btn" class="btn-main btn-cast" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨</button>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showTab('main')"><i>üé£</i>–õ–æ–≤–ª—è</div>
        <div class="nav-item" onclick="showTab('shop')"><i>üõí</i>–†—ã–Ω–æ–∫</div>
        <div class="nav-item" onclick="showTab('top')"><i>üèÜ</i>–¢–æ–ø</div>
        <div class="nav-item" onclick="showTab('info')"><i>‚ÑπÔ∏è</i>–ò–Ω—Ñ–æ</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const userId = tg.initDataUnsafe?.user?.id || '7883085758';
        const userName = tg.initDataUnsafe?.user?.first_name || '–†—ã–±–∞–∫';
        
        const API = 'https://tama-bot-server.onrender.com/api/action'; 
        let lastBalance = 0;
        let lastBonusTime = 0;

        async function doAction(action, payload = {}) {
            try {
                const r = await fetch(API, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ userId, userName, action, payload })
                });
                const d = await r.json();
                updateUI(d);
            } catch(e) { document.getElementById('cast-btn').disabled = false; }
        }

        function updateUI(d) {
            document.getElementById('energy').innerText = d.energy + '%';
            document.getElementById('dur').innerText = Math.floor(d.dur) + '%';
            document.getElementById('jackpot').innerText = Math.floor(d.jackpot.pool).toLocaleString();
            document.getElementById('main-balance').innerText = d.b.toLocaleString();
            lastBalance = d.b;

            if(d.msg) document.getElementById('status-msg').innerText = d.msg;
            if(d.events) document.getElementById('events-line').innerText = d.events.join('  |  ');
            
            lastBonusTime = d.lastBonus;
            document.getElementById('ref-link').innerText = `https://t.me/—Ç–≤–æ–π_–±–æ—Ç?start=${userId}`;
            
            if(d.top) {
                document.getElementById('top-list').innerHTML = d.top.map((u, i) => `<tr><td>${i+1}. ${u.n}</td><td style="text-align:right">${u.b} TC</td></tr>`).join('');
            }

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π –±–æ–Ω—É—Å–∞ (—Ä–∞–∑–º–µ—Ä —Ç–µ–ø–µ—Ä—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —á–µ—Ä–µ–∑ CSS –∫–ª–∞—Å—Å btn-main)
            document.getElementById('bonus-btn').style.display = (Date.now() - d.lastBonus < 86400000) ? 'none' : 'block';

            if(d.catchData) {
                document.getElementById('catch-info').innerText = `${d.catchData.type} ${d.catchData.w} –∫–≥`;
                document.getElementById('catch-overlay').style.display = 'flex';
                document.getElementById('float-img').classList.remove('float-active');
            } else {
                document.getElementById('cast-btn').disabled = false;
            }
        }

        function startFishing() {
            const btn = document.getElementById('cast-btn');
            const img = document.getElementById('float-img');
            
            btn.disabled = true;
            img.classList.add('float-active'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            document.getElementById('status-msg').innerText = "–ó–∞–±—Ä–æ—Å...";

            setTimeout(() => { 
                doAction('cast'); 
                // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–µ –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è —Å–∞–º–∞, –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–¥–µ—Ç –æ—Ç–≤–µ—Ç –∏–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–≥–∏–∫–∞ UI
                // –ù–æ –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º —Å–∫—Ä—ã—Ç—å –µ—ë –ü–ï–†–ï–î –ø–æ–∫–∞–∑–æ–º —É–ª–æ–≤–∞ (–∫–∞–∫ –≤ –±–∞–∑–µ):
                img.classList.remove('float-active'); 
            }, 1300);
        }

        function closeCatch() {
            document.getElementById('catch-overlay').style.display = 'none';
            document.getElementById('cast-btn').disabled = false;
            document.getElementById('status-msg').innerText = "";
        }

        function showTab(name) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('tab-active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + name).classList.add('tab-active');
            event.currentTarget.classList.add('active');
            document.getElementById('main-controls').style.display = (name === 'main') ? 'flex' : 'none';
        }

        function copyRef() {
            navigator.clipboard.writeText(document.getElementById('ref-link').innerText);
            tg.showAlert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
        }

        setInterval(() => {
            const now = Date.now();
            const diffBonus = (lastBonusTime + 86400000) - now;
            document.getElementById('bonus-timer').innerText = diffBonus > 0 ? new Date(diffBonus).toISOString().substr(11, 8) : "–ì–û–¢–û–í!";
        }, 1000);

        doAction('load');
    </script>
</body>
</html>

