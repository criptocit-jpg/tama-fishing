<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Fishing Full</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --bg: #050810; --glass: rgba(255, 255, 255, 0.08); --blue: #0088CC; --red: #e91e63; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; }
        
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ø–ª–∞—à–∫–∞ */
        #wood-alert {
            position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #5d4037, #3e2723);
            padding: 20px 40px; border-radius: 20px; border: 3px solid #795548;
            z-index: 9999; display: none; text-align: center; font-weight: bold;
        }

        .page { display: none; height: 100vh; padding: 20px; box-sizing: border-box; flex-direction: column; }
        .page.active { display: flex; }
        
        .lvl-tag { background: var(--gold); color: #000; padding: 2px 10px; border-radius: 8px; font-size: 10px; font-weight: 900; }
        .balance-val { font-size: 40px; font-weight: 900; text-align: center; }
        
        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 15px 0; }
        .stat-item { background: var(--glass); padding: 10px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        
        .fishing-area { flex-grow: 1; position: relative; background: rgba(0,0,0,0.2); border-radius: 25px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255,255,255,0.1); }
        #fishAnim { width: 180px; display: none; }
        #captcha-bag { position: absolute; width: 80px; display: none; z-index: 100; cursor: pointer; }

        .btn { border: none; border-radius: 20px; color: white; font-weight: 800; width: 100%; cursor: pointer; }
        .btn-blue { background: linear-gradient(180deg, var(--blue), #005580); padding: 20px; font-size: 18px; }
        .btn-gold { background: linear-gradient(180deg, var(--gold), #B8860B); color: #000; padding: 15px; margin-bottom: 10px; }
        
        .section { background: var(--glass); border-radius: 18px; margin-bottom: 10px; }
        .section-header { padding: 15px; display: flex; justify-content: space-between; font-weight: bold; }
        .section-content { display: none; padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .section.open .section-content { display: block; }

        .item-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .btn-stars { background: linear-gradient(90deg, #FFD700, #FFA500); color: #000; padding: 8px 15px; border-radius: 10px; font-weight: bold; }

        #prize-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; color: #000; padding: 30px; border-radius: 20px; z-index: 10000; text-align: center; border: 5px solid var(--gold); }

        .navbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 80px; background: rgba(5,8,16,0.98); display: flex; border-top: 1px solid rgba(255,255,255,0.1); }
        .nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #556080; text-decoration: none; font-size: 10px; }
        .nav-link.active { color: var(--gold); }
    </style>
</head>
<body>

<div id="wood-alert"></div>
<div id="prize-modal"><h2 id="win-txt"></h2><button class="btn btn-blue" onclick="this.parentElement.style.display='none'">–£–†–ê!</button></div>

<div id="game" class="page active">
    <div class="header-info" style="text-align: center;">
        <div id="u-lvl" class="lvl-tag">–°–ê–õ–ê–ì–ê üå±</div>
        <div class="balance-val" id="b-container">0 <span>TC</span></div>
    </div>
    <div class="stats">
        <div class="stat-item"><small>–≠–ù–ï–†–ì–ò–Ø</small><b id="u-en">0</b></div>
        <div class="stat-item"><small>–£–î–û–ß–ö–ê</small><b id="u-dur">0%</b></div>
        <div class="stat-item"><small>–Ø–©–ò–ö–ò</small><b id="u-box">0</b></div>
    </div>
    <div class="fishing-area">
        <img src="https://cdn-icons-png.flaticon.com/512/2953/2953363.png" id="captcha-bag" onclick="catchBag()">
        <img src="https://cdn-icons-png.flaticon.com/512/2275/2275038.png" id="fishAnim">
    </div>
    <div style="padding-bottom:100px;">
        <button id="btn-daily" class="btn btn-gold" onclick="doAction('get_daily')">–ë–û–ù–£–° üéÅ</button>
        <button id="cast-btn" class="btn btn-blue" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
    </div>
</div>

<div id="menu" class="page">
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
    <div class="section">
        <div class="section-header" onclick="toggleSection(this)"><span>üì¶ –ú–û–ò –Ø–©–ò–ö–ò</span><span>‚ñº</span></div>
        <div class="section-content" style="text-align:center;">
            <img id="box-img" src="https://cdn-icons-png.flaticon.com/512/679/679821.png" style="width:80px;">
            <p>–£ –≤–∞—Å: <b id="u-box-menu">0</b></p>
            <button class="btn btn-blue" onclick="openBoxAnim()">–û–¢–ö–†–´–¢–¨ –Ø–©–ò–ö</button>
        </div>
    </div>
    <div class="section">
        <div class="section-header" onclick="toggleSection(this)" style="background:var(--gold); color:#000;"><span>‚≠êÔ∏è –ú–ê–ì–ê–ó–ò–ù STARS</span><span>‚ñº</span></div>
        <div class="section-content">
            <div class="item-row"><div>–°—Ç–∞—Ä—Ç –ü–∞–∫ (5–∫ TC)</div><button class="btn-stars" onclick="doAction('buy_stars',{itemId:'item_1'})">50 ‚≠êÔ∏è</button></div>
            <div class="item-row"><div>–õ–∏—Ü–µ–Ω–∑–∏—è X2 (–í–µ—á–Ω–æ)</div><button class="btn-stars" onclick="doAction('buy_stars',{itemId:'item_2'})">499 ‚≠êÔ∏è</button></div>
            <div class="item-row"><div>–ù–∞–±–æ—Ä –ö–∏—Ç (50–∫ TC)</div><button class="btn-stars" onclick="doAction('buy_stars',{itemId:'item_3'}) ...">999 ‚≠êÔ∏è</button></div>
            <div class="item-row"><div>–í–µ—á–Ω–∞—è —É–¥–æ—á–∫–∞</div><button class="btn-stars" onclick="doAction('buy_stars',{itemId:'item_4'})">1499 ‚≠êÔ∏è</button></div>
            <div class="item-row"><div>10 –ú–µ–≥–∞-–Ø—â–∏–∫–æ–≤</div><button class="btn-stars" onclick="doAction('buy_stars',{itemId:'item_5'})">299 ‚≠êÔ∏è</button></div>
            <div class="item-row"><div>VIP –°—Ç–∞—Ç—É—Å</div><button class="btn-stars" onclick="doAction('buy_stars',{itemId:'item_6'})">799 ‚≠êÔ∏è</button></div>
        </div>
    </div>
    <div class="section">
        <div class="section-header" onclick="toggleSection(this)"><span>üí≥ –í–´–í–û–î</span><span>‚ñº</span></div>
        <div class="section-content">
            <input type="text" id="wallet" placeholder="TON Wallet" style="width:100%; padding:10px; margin-bottom:5px;">
            <input type="number" id="amount" placeholder="–°—É–º–º–∞ (30000+)" style="width:100%; padding:10px; margin-bottom:5px;">
            <button class="btn btn-blue" style="background:var(--red)" onclick="withdraw()">–í–´–í–ï–°–¢–ò</button>
        </div>
    </div>
    <button class="btn btn-blue" onclick="doAction('sell_fish')" style="margin-top:10px;">–ü–†–û–î–ê–¢–¨ –í–°–Æ –†–´–ë–£</button>
</div>

<nav class="navbar">
    <a href="#" class="nav-link active" onclick="showPage('game', this)"><span>üéÆ</span>–ò–≥—Ä–∞</a>
    <a href="#" class="nav-link" onclick="showPage('menu', this)"><span>üéí</span>–ú–µ–Ω—é</a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const API_URL = '–¢–í–û–ô_URL/api/action';
    let currentCastCount = 0;

    function showWood(text) {
        const w = document.getElementById('wood-alert');
        w.innerText = text; w.style.display = 'block';
        setTimeout(() => { w.style.display = 'none'; }, 2000);
    }

    function toggleSection(h) { h.parentElement.classList.toggle('open'); }
    function showPage(p, el) {
        document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
        document.getElementById(p).classList.add('active');
        document.querySelectorAll('.nav-link').forEach(x=>x.classList.remove('active'));
        el.classList.add('active');
    }

    async function doAction(action, extra = {}) {
        const r = await fetch(API_URL, {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ userId: tg.initDataUnsafe?.user?.id || "7883085758", action, ...extra })
        });
        const d = await r.json();
        if(d.msg) { if(action==='catch_fish') showWood(d.msg); else tg.showAlert(d.msg); }
        if(d.win) { document.getElementById('win-txt').innerText = `+${d.win} TC`; document.getElementById('prize-modal').style.display='block'; }
        updateUI(d);
    }

    function updateUI(d) {
        document.getElementById('b-container').innerHTML = Math.floor(d.b) + ' <span>TC</span>';
        document.getElementById('u-en').innerText = Math.floor(d.energy);
        document.getElementById('u-dur').innerText = d.durability + '%';
        document.getElementById('u-box').innerText = d.boxes;
        document.getElementById('u-box-menu').innerText = d.boxes;
        document.getElementById('u-lvl').innerText = d.level;
        currentCastCount = d.castCount;
    }

    function startFishing() {
        if((currentCastCount + 1) % 5 === 0) {
            const b = document.getElementById('captcha-bag');
            b.style.display = 'block'; b.style.left = Math.random()*70+'%'; b.style.top = Math.random()*70+'%';
            document.getElementById('cast-btn').disabled = true;
        } else {
            document.getElementById('fishAnim').style.display='block';
            setTimeout(()=>{ document.getElementById('fishAnim').style.display='none'; doAction('catch_fish'); }, 1200);
        }
    }

    function catchBag() {
        document.getElementById('captcha-bag').style.display='none';
        document.getElementById('cast-btn').disabled = false;
        doAction('catch_fish', {captchaPassed:true});
    }

    function openBoxAnim() {
        const img = document.getElementById('box-img');
        img.style.transform = "scale(1.2) rotate(10deg)";
        setTimeout(()=> { img.style.transform=""; doAction('open_box'); }, 500);
    }

    function withdraw() {
        const w = document.getElementById('wallet').value;
        const a = document.getElementById('amount').value;
        doAction('withdraw', {wallet: w, amount: a});
    }

    tg.expand();
    doAction('load_data');
</script>
</body>
</html>
