<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Gold Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --gold: #FFD700;
            --gold-dark: #B8860B;
            --bg: #050810;
            --glass: rgba(255, 255, 255, 0.06);
            --glass-border: rgba(255, 255, 255, 0.12);
            --blue: #0088CC;
            --blue-dark: #005580;
        }

        body {
            margin: 0; padding: 0;
            background: var(--bg);
            background-image: radial-gradient(circle at top right, #0a1530, var(--bg));
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü—ã */
        .page { display: none; height: 100vh; flex-direction: column; padding: 25px 20px; box-sizing: border-box; overflow: hidden; }
        .page.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –®–∞–ø–∫–∞ –±–∞–ª–∞–Ω—Å–∞ */
        .header-ui { text-align: center; margin-top: 5px; flex-shrink: 0; }
        .balance-val { font-size: 48px; font-weight: 900; color: #fff; margin-top: 2px; display: block; }
        .balance-val span { color: var(--gold); }
        .level-badge { 
            display: inline-block; background: var(--glass); border: 1px solid var(--gold); 
            padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 800;
            text-transform: uppercase; color: var(--gold); margin-bottom: 8px;
        }

        /* –¢–∞–π–º–µ—Ä—ã */
        .timer-row { font-size: 10px; color: #8892b0; margin-top: 8px; letter-spacing: 1px; }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; flex-shrink: 0; }
        .stat-item {
            background: var(--glass); border: 1px solid var(--glass-border);
            border-radius: 18px; padding: 12px; text-align: center; backdrop-filter: blur(10px);
        }
        .stat-item small { display: block; font-size: 9px; color: #8892b0; text-transform: uppercase; margin-bottom: 4px; }
        .stat-item b { font-size: 18px; font-weight: 800; }

        /* –ó–æ–Ω–∞ —Ä—ã–±–∞–ª–∫–∏ (–ú–∞–∫—Å–∏–º—É–º –º–µ—Å—Ç–∞) */
        .fishing-area { 
            flex-grow: 1; display: flex; align-items: center; justify-content: center; 
            position: relative; width: 100%; margin-bottom: 5px;
        }
        #fishAnim { 
            width: 100%; height: auto; max-height: 95%; object-fit: contain;
            display: none; filter: drop-shadow(0 0 40px var(--blue)); 
            animation: fishPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes fishPop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* –ì–ª—É–±–æ–∫–æ–≤–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º */
        .risk-control {
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 15px 20px; display: flex; 
            justify-content: space-between; align-items: center; margin-bottom: 15px;
        }
        .risk-info b { display: block; font-size: 14px; color: #ff4d4d; }
        .risk-info span { font-size: 10px; color: #888; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            border: none; border-radius: 22px; color: white; font-size: 18px; 
            font-weight: 800; width: 100%; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-blue { background: linear-gradient(180deg, var(--blue) 0%, var(--blue-dark) 100%); padding: 22px; box-shadow: 0 6px 20px rgba(0, 136, 204, 0.3); }
        .btn-gold { background: linear-gradient(180deg, var(--gold) 0%, var(--gold-dark) 100%); color: #000; padding: 18px; margin-bottom: 10px; }
        .btn:active { transform: scale(0.96); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navbar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 85px;
            background: rgba(5, 8, 16, 0.95); backdrop-filter: blur(15px);
            display: flex; border-top: 1px solid var(--glass-border); z-index: 1000;
        }
        .nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #556080; text-decoration: none; }
        .nav-link.active { color: var(--gold); }
        .nav-link span { font-size: 24px; margin-bottom: 2px; }
        .nav-link label { font-size: 10px; font-weight: 700; text-transform: uppercase; }

        /* –ú–æ–¥–∞–ª–∫–∏ (–ò–Ω—Ñ–æ / –°–µ–∫—Ü–∏–∏) */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.96); display: none; flex-direction: column; padding: 40px 25px; z-index: 9999; box-sizing: border-box; overflow-y: auto; }
        .modal h2 { color: var(--gold); font-size: 28px; margin-bottom: 20px; }
        .info-card { background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; padding: 20px; margin-bottom: 15px; line-height: 1.6; }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å (Switch) */
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #ff4d4d; }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body>

<div id="game" class="page active">
    <div class="header-ui">
        <div id="u-level" class="level-badge">–ù–û–í–ò–ß–û–ö üé£</div>
        <div class="balance-val" id="b-display">0 <span>TC</span></div>
        <div class="timer-row" id="global-timers">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="stats">
        <div class="stat-item"><small>–≠–Ω–µ—Ä–≥–∏—è</small><b id="u-en">0</b></div>
        <div class="stat-item"><small>–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</small><b id="u-art">0/5</b></div>
    </div>

    <div class="fishing-area">
        <img src="fish_anim.webp" id="fishAnim" alt="–†—ã–±–∞–ª–∫–∞">
    </div>

    <div class="risk-control">
        <div class="risk-info">
            <b>–ì–õ–£–ë–û–ö–û–í–û–î–ù–´–ô –†–ï–ñ–ò–ú</b>
            <span>–†–∏—Å–∫ –æ–±—Ä—ã–≤–∞ | –£–ª–æ–≤ x10</span>
        </div>
        <label class="switch">
            <input type="checkbox" id="isDeep">
            <span class="slider"></span>
        </label>
    </div>

    <div class="bottom-actions">
        <button class="btn btn-gold" id="btn-bonus" onclick="doAction('get_bonus')">–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° üéÅ</button>
        <button class="btn btn-blue" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
    </div>
</div>

<div id="info-modal" class="modal">
    <h2>–ò–ù–°–¢–†–£–ö–¶–ò–Ø</h2>
    <div class="info-card">
        <b>üí∞ –≠–ö–û–ù–û–ú–ò–ö–ê:</b><br>
        1 –∫–≥ —Ä—ã–±—ã = 0.5 TC. <br>
        –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥: 30,000 TC.
    </div>
    <div class="info-card">
        <b>üåü –ó–û–õ–û–¢–û–ô –ß–ê–°:</b><br>
        –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 19:00 –ø–æ —Å–µ—Ä–≤–µ—Ä—É –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –∂–æ—Ä. –í–µ—Å—å —É–ª–æ–≤ —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è (x2)!
    </div>
    <div class="info-card">
        <b>üè∫ –ê–†–¢–ï–§–ê–ö–¢–´:</b><br>
        –°–æ–±–µ—Ä–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–∑ 5 —Ä–µ–¥–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ –ø–æ–ª—É—á–∏—Ç–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ 30,000 TC –Ω–∞ –±–∞–ª–∞–Ω—Å.
    </div>
    <div class="info-card" style="border-color: #ff4d4d;">
        <b>‚ö†Ô∏è –ü–û–î–î–ï–†–ñ–ö–ê:</b><br>
        –°–≤—è–∑—å —Å –∞–¥–º–∏–Ω–æ–º: –°–∫–æ—Ä–æ...
    </div>
    <button class="btn btn-blue" onclick="closeInfo()">–ü–û–ù–Ø–¢–ù–û</button>
</div>

<nav class="navbar">
    <a href="#" class="nav-link active" onclick="showPage('game', this)"><span>üéÆ</span><label>–ò–≥—Ä–∞</label></a>
    <a href="#" class="nav-link" onclick="openInfo()"><span>‚ÑπÔ∏è</span><label>–ò–Ω—Ñ–æ</label></a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const API = 'https://tama-bot-server.onrender.com/api/action';
    let currentB = 0;

    tg.ready();
    tg.expand();

    function openInfo() { document.getElementById('info-modal').style.display = 'flex'; }
    function closeInfo() { document.getElementById('info-modal').style.display = 'none'; }

    // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Ü–∏—Ñ—Ä –±–∞–ª–∞–Ω—Å–∞
    function animateBalance(target) {
        const el = document.getElementById('b-display');
        const start = currentB;
        const duration = 1200;
        let startTime = null;

        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / duration, 1);
            const current = Math.floor(progress * (target - start) + start);
            el.innerHTML = current.toLocaleString() + ' <span>TC</span>';
            if (progress < 1) {
                window.requestAnimationFrame(step);
            } else {
                currentB = target;
            }
        }
        window.requestAnimationFrame(step);
    }

    function updateTimers() {
        const now = new Date();
        const h = now.getHours();
        const m = now.getMinutes();
        
        let goldenText = "";
        if(h === 19) {
            goldenText = "üåü –ó–û–õ–û–¢–û–ô –ß–ê–° –í –†–ê–ó–ì–ê–†–ï!";
        } else {
            const wait = h >= 19 ? 19 + 24 - h : 19 - h;
            goldenText = `–î–æ –ó–æ–ª–æ—Ç–æ–≥–æ —á–∞—Å–∞: ~${wait}—á`;
        }
        document.getElementById('global-timers').innerText = goldenText + " | –ë–æ–Ω—É—Å –≥–æ—Ç–æ–≤!";
    }

    async function doAction(action) {
        try {
            const res = await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    userId: tg.initDataUnsafe?.user?.id || "7883085758",
                    userName: tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫",
                    action: action,
                    isDeep: document.getElementById('isDeep').checked
                })
            });
            const data = await res.json();
            if(data.msg) tg.showAlert(data.msg);
            if(data.isGoldFish) tg.HapticFeedback.notificationOccurred('success');
            updateUI(data);
        } catch(e) { console.error(e); }
    }

    function updateUI(d) {
        animateBalance(d.b);
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('u-art').innerText = (d.artifacts?.length || 0) + "/5";
        
        // –†–∞–Ω–≥–∏
        const levels = ["–ù–æ–≤–∏—á–æ–∫ üé£", "–†—ã–±–∞–∫ üõ∂", "–ü—Ä–æ—Ñ–∏ üõ•Ô∏è", "–ú–∞—Å—Ç–µ—Ä üö¢", "–õ–ï–ì–ï–ù–î–ê üëë"];
        const lIdx = Math.min(4, Math.floor(d.b / 10000));
        document.getElementById('u-level').innerText = levels[lIdx];
        updateTimers();
    }

    function startFishing() {
        const anim = document.getElementById('fishAnim');
        anim.style.display = 'block';
        tg.HapticFeedback.impactOccurred('heavy');
        
        setTimeout(() => {
            anim.style.display = 'none';
            doAction('catch_fish');
        }, 1300); // 1.3 —Å–µ–∫—É–Ω–¥—ã –∑–∞–¥–µ—Ä–∂–∫–∏
    }

    // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    setInterval(() => doAction('load'), 30000);
    setInterval(updateTimers, 60000);
    doAction('load');
</script>
</body>
</html>
