<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tama Fishing Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #0d1b4a; font-family: 'Arial', sans-serif; overflow: hidden; color: white; }

        /* –§–æ–Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å–æ —Å–∫—Ä–∏–Ω–∞ */
        .game-area { 
            position: relative; 
            height: 65vh; 
            background: url('https://i.imgur.com/K6L87X0.png') no-repeat center bottom; 
            background-size: cover;
        }

        /* –£–¥–æ—á–∫–∞ (—Ç–æ–Ω–∫–∞—è –∏ —Å—Ç–∏–ª—å–Ω–∞—è) */
        .fishing-rod {
            position: absolute;
            bottom: 40px;
            right: 10px;
            width: 6px;
            height: 280px;
            background: linear-gradient(to top, #4b3621, #8d6e63);
            border-radius: 5px;
            transform-origin: bottom right;
            transform: rotate(-40deg);
            transition: 0.3s;
            z-index: 10;
        }

        /* –õ–µ—Å–∫–∞ */
        .fishing-line {
            position: absolute;
            top: 0;
            left: 3px;
            width: 1px;
            height: 220px;
            background: rgba(255, 255, 255, 0.6);
            transform-origin: top;
            transform: rotate(40deg);
        }

        /* –ü–æ–ø–ª–∞–≤–æ–∫ */
        .bobber {
            position: absolute;
            bottom: -10px;
            left: -7px;
            width: 14px;
            height: 24px;
            background: #ff1744;
            border: 2px solid white;
            border-radius: 50% 50% 2px 2px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∫–ª–µ–≤–∫–∏ */
        @keyframes bite {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(12px); }
        }
        .active-bite { animation: bite 0.4s infinite; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥ –∫–∞—Ä—Ç–∏–Ω–∫–æ–π */
        .ui { 
            height: 35vh; 
            background: #0d1b4a; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 15px; 
            padding: 0 20px;
        }

        .btn-group { display: flex; gap: 15px; width: 100%; max-width: 400px; }
        .btn { 
            flex: 1; 
            padding: 18px; 
            border: none; 
            border-radius: 15px; 
            font-size: 18px; 
            font-weight: bold; 
            color: white; 
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
            transition: 0.1s;
        }
        .btn-catch { background: #4caf50; }
        .btn-sell { background: #f44336; }
        .btn:active { transform: translateY(3px); box-shadow: none; }

        #status { color: #88bdff; font-size: 14px; font-weight: bold; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="game-area">
    <div class="fishing-rod" id="rod">
        <div class="fishing-line">
            <div class="bobber" id="bobber"></div>
        </div>
    </div>
</div>

<div class="ui">
    <div id="status">–ì–æ—Ç–æ–≤ –∫ –∑–∞–±—Ä–æ—Å—É</div>
    <div class="btn-group">
        <button class="btn btn-catch" id="catchBtn" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
        <button class="btn btn-sell" onclick="sendAction('sell_fish')">–ü–†–û–î–ê–¢–¨ üí∞</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const SERVER_URL = 'https://tama-bot-server.onrender.com/api/action';

    async function startFishing() {
        const btn = document.getElementById('catchBtn');
        const bobber = document.getElementById('bobber');
        const status = document.getElementById('status');
        const rod = document.getElementById('rod');

        btn.disabled = true;
        status.innerText = "–£–¥–æ—á–∫–∞ –∑–∞–±—Ä–æ—à–µ–Ω–∞...";
        
        // 1. –ñ–¥–µ–º –ø–æ–∫–ª–µ–≤–∫—É
        setTimeout(() => {
            bobber.classList.add('active-bite');
            rod.style.transform = 'rotate(-35deg)'; // –£–¥–æ—á–∫–∞ —á—É—Ç—å –Ω–∞–∫–ª–æ–Ω—è–µ—Ç—Å—è
            status.innerText = "–ö–õ–Æ–ï–¢! –¢–Ø–ù–ï–ú...";
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('heavy');
        }, 2000);

        // 2. –í—ã—Ç—è–≥–∏–≤–∞–µ–º
        setTimeout(async () => {
            bobber.classList.remove('active-bite');
            rod.style.transform = 'rotate(-50deg)'; // –†–µ–∑–∫–∏–π —Ä—ã–≤–æ–∫ –≤–≤–µ—Ä—Ö
            
            await sendAction('catch_fish');
            
            setTimeout(() => {
                rod.style.transform = 'rotate(-40deg)';
                btn.disabled = false;
                status.innerText = "–£—Å–ø–µ—à–Ω—ã–π —É–ª–æ–≤!";
            }, 1000);
        }, 4500);
    }

    async function sendAction(act) {
        const user = tg.initDataUnsafe?.user;
        if (!user) return;
        try {
            await fetch(SERVER_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: user.id, action: act })
            });
        } catch (e) { console.error(e); }
    }
</script>

</body>
</html>
