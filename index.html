<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tamacoin Fishing</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --dark: #0a0e1a; --wood: #5d4037; }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        .page { display: none; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 90px; }
        .active { display: block; }
        
        /* –ö–û–†–ò–ì–ê (–ü–õ–ê–®–ö–ê –£–õ–û–í–ê) */
        #wood-plate {
            position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: var(--wood); border: 4px solid #3e2723; border-radius: 15px;
            padding: 20px; text-align: center; width: 80%; z-index: 100;
            box-shadow: 0 0 20px rgba(0,0,0,0.8); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #wood-plate.show { transform: translate(-50%, -50%) scale(1); }
        #wood-plate h3 { margin: 0; color: var(--gold); text-transform: uppercase; font-size: 14px; }
        #wood-plate p { font-size: 24px; font-weight: 900; margin: 10px 0; }

        /* –¢–ê–ô–ú–ï–†–´ */
        .timers { display: flex; justify-content: space-between; font-size: 11px; color: var(--gold); margin-bottom: 10px; }
        
        /* –ú–ê–ì–ê–ó–ò–ù */
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .item-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; font-size: 12px; }
        .item-card b { display: block; margin-bottom: 5px; color: var(--gold); }
        .btn-buy { width: 100%; border: none; background: #2e7d32; color: white; border-radius: 5px; padding: 5px; font-weight: bold; }
        
        /* NAV */
        nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #161b2c; display: flex; border-top: 1px solid #2d3244; }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #70758a; text-decoration: none; }
        .nav-btn.active { color: var(--gold); }
        .nav-btn i { font-size: 20px; margin-bottom: 4px; font-style: normal; }

        .lake { width: 100%; height: 250px; background: rgba(0,136,204,0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; position: relative; }
        #fish-anim { width: 120px; display: none; }
        .marquee { background: rgba(0,0,0,0.3); padding: 5px; font-size: 11px; white-space: nowrap; overflow: hidden; margin-top: 10px; border-radius: 5px; }
        .toast { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: var(--gold); color: black; padding: 8px 15px; border-radius: 20px; font-weight: bold; display: none; z-index: 1000; }
    </style>
</head>
<body>

<div id="toast" class="toast"></div>

<div id="wood-plate" onclick="this.classList.remove('show')">
    <h3>–£–õ–û–í –ò–ó –ì–õ–£–ë–ò–ù–´</h3>
    <p id="catch-res">–ö–†–ê–°–ù–û–ü–ï–†–ö–ê<br>1.25 –∫–≥</p>
    <small>–ö–ª–∏–∫–Ω–∏, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å</small>
</div>

<div id="p-game" class="page active">
    <div class="timers">
        <span>–ó–û–õ–û–¢–û–ô –ß–ê–°: <b id="t-gold">--:--</b></span>
        <span>–ë–û–ù–£–°: <b id="t-daily">--:--</b></span>
    </div>
    <div style="text-align:center; margin-bottom:15px;">
        <div style="font-size:12px; opacity:0.6;">–ë–ê–õ–ê–ù–° TC</div>
        <div style="font-size:32px; font-weight:900; color:var(--gold);" id="u-b">0</div>
    </div>
    
    <div class="lake">
        <img src="fish_anim.webp" id="fish-anim">
        <div id="status">–ì–û–¢–û–í –ö –ó–ê–ë–†–û–°–£</div>
    </div>
    
    <button style="width:100%; padding:15px; background:var(--gold); border:none; border-radius:15px; font-weight:900; margin-top:15px;" id="btn-cast" onclick="doCast()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
    
    <div class="marquee"><div id="log-line">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</div></div>
</div>

<div id="p-sadok" class="page">
    <div class="item-card" style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
        <div>–í —Å–∞–¥–∫–µ: <b id="u-fish">0</b> –∫–≥</div>
        <button onclick="api('sell')" style="background:var(--gold); border:none; padding:10px 20px; border-radius:8px; font-weight:bold;">–ü–†–û–î–ê–¢–¨</button>
    </div>

    <h3>–ú–ê–ì–ê–ó–ò–ù TC</h3>
    <div class="shop-grid">
        <div class="item-card"><b>–ú—è–∫–∏—à</b>100 TC<button class="btn-buy" onclick="api('buy',{id:'myakish'})">–ö–£–ü–ò–¢–¨</button></div>
        <div class="item-card"><b>–ù–∞–±–æ—Ä —Å–Ω–∞—Å—Ç–µ–π</b>200 TC<button class="btn-buy" onclick="api('buy',{id:'gear'})">–ö–£–ü–ò–¢–¨</button></div>
        <div class="item-card"><b>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</b>50 TC<button class="btn-buy" onclick="api('buy',{id:'energy'})">–ö–£–ü–ò–¢–¨</button></div>
        <div class="item-card"><b>–†–µ–º–æ–Ω—Ç</b>50 TC<button class="btn-buy" onclick="api('buy',{id:'repair'})">–ö–£–ü–ò–¢–¨</button></div>
    </div>

    <h3 style="color:var(--gold)">VIP –ú–ê–ì–ê–ó–ò–ù (STARS)</h3>
    <div class="shop-grid">
        <div class="item-card"><b>–¢–∏—Ç–∞–Ω–æ–≤–∞—è —É–¥–æ—á–∫–∞</b>150 ‚≠ê<button class="btn-buy" onclick="api('buy',{id:'titan'})">–ö–£–ü–ò–¢–¨</button></div>
        <div class="item-card"><b>–í–µ–¥—Ä–æ –ø—Ä–∏–∫–æ—Ä–º–∫–∏</b>200 ‚≠ê<button class="btn-buy" onclick="api('buy',{id:'bait'})">–ö–£–ü–ò–¢–¨</button></div>
        <div class="item-card"><b>–õ–∏—Ü–µ–Ω–∑–∏—è</b>500 ‚≠ê<button class="btn-buy" onclick="api('buy',{id:'license'})">–ö–£–ü–ò–¢–¨</button></div>
    </div>

    <h3>–í–´–í–û–î –°–†–ï–î–°–¢–í</h3>
    <div class="item-card">
        <input id="w-wallet" placeholder="–ù–æ–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞" style="width:90%; padding:8px; margin-bottom:5px;">
        <input id="w-sum" type="number" placeholder="–°—É–º–º–∞ TC" style="width:90%; padding:8px; margin-bottom:5px;">
        <button onclick="withdraw()" style="width:96%; background:#0088cc; border:none; color:white; padding:10px; border-radius:5px;">–ó–ê–ö–ê–ó–ê–¢–¨ –í–´–í–û–î</button>
    </div>
</div>

<div id="p-top" class="page">
    <h2>üèÜ –¢–û–ü –†–´–ë–ê–ö–û–í</h2>
    <div id="top-list"></div>
</div>

<div id="p-info" class="page">
    <h2>‚ÑπÔ∏è –û –ì–†–ï</h2>
    <div class="item-card">
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –õ–æ–≤–∏ —Ä—ã–±—É, –∫–æ–ø–∏ TC –∏ –æ–±–º–µ–Ω–∏–≤–∞–π –∏—Ö –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏. <br><br>
        –ö–∞–∂–¥—ã–π –∑–∞–±—Ä–æ—Å —Ç—Ä–∞—Ç–∏—Ç 2 —ç–Ω–µ—Ä–≥–∏–∏. –í 19:00 –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ó–æ–ª–æ—Ç–æ–π —á–∞—Å ‚Äî –≤–µ—Å —É–ª–æ–≤–∞ —Ö2!</p>
    </div>
    <h3>–¢–í–û–Ø –°–°–´–õ–ö–ê</h3>
    <div class="item-card" id="ref-link" style="word-break:break-all; color:var(--gold);"></div>
</div>

<nav>
    <a href="#" class="nav-btn active" onclick="showP('p-game',this)"><i>üéÆ</i>–ò–ì–†–ê</a>
    <a href="#" class="nav-btn" onclick="showP('p-sadok',this)"><i>üéí</i>–°–ê–î–û–ö</a>
    <a href="#" class="nav-btn" onclick="showP('p-top',this)"><i>üèÜ</i>–¢–û–ü</a>
    <a href="#" class="nav-btn" onclick="showP('p-info',this)"><i>‚ÑπÔ∏è</i>–ò–ù–§–û</a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const URL = 'https://tama-bot-server.onrender.com/api/action';
    let user = {};

    function showP(id, el) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        el.classList.add('active');
    }

    function toast(t) {
        const el = document.getElementById('toast');
        el.innerText = t; el.style.display='block';
        setTimeout(()=>el.style.display='none', 3000);
    }

    async function api(action, payload = {}) {
        try {
            const r = await fetch(URL, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ userId: tg.initDataUnsafe.user?.id || "7883085758", userName: tg.initDataUnsafe.user?.first_name || "–†—ã–±–∞–∫", action, payload })
            });
            const d = await r.json();
            if (d.msg) toast(d.msg);
            render(d);
            if (d.catchData) showWood(d.catchData);
        } catch(e) { console.log(e); }
    }

    function render(d) {
        user = d;
        document.getElementById('u-b').innerText = Math.floor(d.b).toLocaleString();
        document.getElementById('u-fish').innerText = (d.fish || 0).toFixed(2);
        document.getElementById('log-line').innerText = d.logs.join(' ‚Ä¢ ');
        document.getElementById('ref-link').innerText = `https://t.me/TamacoinBot?start=${d.id}`;
        
        if(d.top) {
            document.getElementById('top-list').innerHTML = d.top.map((x,i)=>`<div class="item-card" style="margin-bottom:5px;">${i+1}. ${x.n} - ${x.b} TC</div>`).join('');
        }
    }

    function doCast() {
        const f = document.getElementById('fish-anim');
        const b = document.getElementById('btn-cast');
        f.style.display = 'block'; b.disabled = true;
        document.getElementById('status').innerText = "–ó–ê–ë–†–û–°...";
        
        setTimeout(() => {
            f.style.display = 'none'; b.disabled = false;
            document.getElementById('status').innerText = "–ì–û–¢–û–í";
            api('cast');
        }, 1300);
    }

    function showWood(data) {
        const w = document.getElementById('wood-plate');
        document.getElementById('catch-res').innerHTML = `${data.type}<br>${data.w} –∫–≥`;
        w.classList.add('show');
        setTimeout(()=>w.classList.remove('show'), 4000);
    }

    function withdraw() {
        const wallet = document.getElementById('w-wallet').value;
        const sum = document.getElementById('w-sum').value;
        if(!wallet || !sum) return toast("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");
        api('withdraw', {wallet, sum: parseInt(sum)});
    }

    // –¢–∞–π–º–µ—Ä—ã
    setInterval(() => {
        const now = new Date();
        const h = now.getHours();
        const goldVal = (h === 19) ? "–ê–ö–¢–ò–í–ï–ù! üî•" : `—á–µ—Ä–µ–∑ ${19-h > 0 ? 19-h : 24-h+19}—á`;
        document.getElementById('t-gold').innerText = goldVal;
        
        const nextBonus = (user.lastBonus || 0) + 86400000;
        const diff = nextBonus - Date.now();
        if(diff > 0) {
            const hh = Math.floor(diff/3600000);
            const mm = Math.floor((diff%3600000)/60000);
            const ss = Math.floor((diff%60000)/1000);
            document.getElementById('t-daily').innerText = `${hh}:${mm}:${ss}`;
        } else {
            document.getElementById('t-daily').innerText = "–ì–û–¢–û–í";
        }
    }, 1000);

    api('load');
</script>
</body>
</html>
