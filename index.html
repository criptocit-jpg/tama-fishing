<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Gold 3.6.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°–æ—Ö—Ä–∞–Ω—è—é —Ç–≤–æ–∏ —Å—Ç–∏–ª–∏ –∏ –¥–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–µ */
        :root { --gold: #FFD700; --bg: #050810; --blue: #0088CC; --glass: rgba(255,255,255,0.06); }
        body { margin: 0; background: var(--bg); color: white; font-family: -apple-system, sans-serif; overflow: hidden; }

        #toast { position: fixed; top: 30px; left: 50%; transform: translateX(-50%) translateY(-150%); background: var(--gold); color: #000; padding: 15px 30px; border-radius: 30px; font-weight: 900; z-index: 10000; transition: 0.4s; text-align: center; box-shadow: 0 5px 20px rgba(255,215,0,0.4); }
        #toast.show { transform: translateX(-50%) translateY(0); }

        #wood-alert { position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%) translateY(200%); background: #3e2723; color: #fff; padding: 12px 25px; border-radius: 15px; border: 2px solid #5d4037; font-weight: bold; transition: 0.5s; z-index: 99; text-align: center; }
        #wood-alert.show { transform: translateX(-50%) translateY(0); }

        .page { display: none; height: 100vh; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .page.active { display: flex; }
        
        .balance-val { font-size: 42px; font-weight: 900; text-align: center; color: var(--gold); }
        .lvl-badge { background: white; color: black; padding: 2px 10px; border-radius: 10px; font-size: 10px; font-weight: 800; vertical-align: middle; }

        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin: 15px 0; }
        .stat-item { background: var(--glass); padding: 10px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .stat-item small { font-size: 9px; color: #8892b0; display: block; }

        .fishing-area { flex-grow: 1; position: relative; overflow: hidden; background: rgba(0,0,0,0.2); border-radius: 30px; margin-bottom: 10px; border: 1px dashed rgba(255,255,255,0.1); }
        #fishAnim { width: 100%; height: auto; display: none; }
        #captcha-bag { position: absolute; width: 80px; height: 80px; display: none; z-index: 100; cursor: pointer; filter: drop-shadow(0 0 15px var(--gold)); }

        .timer-row { display: flex; justify-content: space-between; font-size: 10px; color: #8892b0; margin-bottom: 10px; padding: 0 5px; }

        .btn { border: none; border-radius: 20px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-blue { background: var(--blue); color: white; padding: 22px; width: 100%; font-size: 18px; }
        .btn-gold { background: var(--gold); color: black; padding: 15px; width: 100%; margin-bottom: 10px; }

        .navbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 80px; background: #000; display: flex; border-top: 1px solid #222; }
        .nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; text-decoration: none; font-size: 10px; }
        .nav-link.active { color: var(--gold); }
        .nav-link span { font-size: 20px; }
    </style>
</head>
<body>

<div id="toast"></div>
<div id="wood-alert"></div>

<div id="game" class="page active">
    <div style="text-align:center;"><span id="u-lvl" class="lvl-badge">–ó–ê–ì–†–£–ó–ö–ê...</span></div>
    <div class="balance-val" id="b1">0</div>
    
    <div class="timer-row">
        <span id="gh-timer">–ó–û–õ–û–¢–û–ô –ß–ê–°: --:--:--</span>
        <span id="daily-timer">–ë–û–ù–£–°: --:--:--</span>
    </div>

    <div class="stats">
        <div class="stat-item"><small>–≠–ù–ï–†–ì–ò–Ø</small><b id="u-en">0</b></div>
        <div class="stat-item"><small>–£–î–û–ß–ö–ê</small><b id="u-dur">0%</b></div>
        <div class="stat-item"><small>–Ø–©–ò–ö–ò</small><b id="u-box">0</b></div>
    </div>

    <div class="fishing-area" id="lake">
        <img src="https://cdn-icons-png.flaticon.com/512/2953/2953363.png" id="captcha-bag" onclick="catchBag()">
        <img src="fish_anim.webp" id="fishAnim">
    </div>

    <div style="padding-bottom: 90px;">
        <button id="btn-daily" class="btn btn-gold" onclick="doAction('get_daily')">–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° üéÅ</button>
        <button id="cast-btn" class="btn btn-blue" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
    </div>
</div>

<div id="menu" class="page">
    <h2>–†—é–∫–∑–∞–∫ –∏ –ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="stat-item" style="margin-bottom:10px;">–£–ª–æ–≤: <b id="u-fish">0</b> –∫–≥ <button onclick="doAction('sell_fish')">–ü–†–û–î–ê–¢–¨</button></div>
    <div class="stat-item" style="margin-bottom:10px;">–ü—Ä–æ—á–Ω–æ—Å—Ç—å: <b id="u-dur2">0</b>% <button onclick="doAction('repair')">–ß–ò–ù–ò–¢–¨ (50 TC)</button></div>
    <hr>
    <div onclick="doAction('buy_item', {itemId:'energy'})" style="background:var(--glass); padding:15px; border-radius:10px; margin-top:10px;">–ö—É–ø–∏—Ç—å –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ (30 TC)</div>
</div>

<nav class="navbar">
    <a href="#" class="nav-link active" onclick="showPage('game', this)"><span>üéÆ</span><label>–ò–≥—Ä–∞</label></a>
    <a href="#" class="nav-link" onclick="showPage('menu', this)"><span>üéí</span><label>–ú–µ–Ω—é</label></a>
    <a href="#" class="nav-link" onclick="showPage('top', this)"><span>üèÜ</span><label>–¢–æ–ø</label></a>
    <a href="#" class="nav-link" onclick="showPage('info', this)"><span>‚ÑπÔ∏è</span><label>–ò–Ω—Ñ–æ</label></a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const API = 'https://—Ç–≤–æ–π-—Å–µ—Ä–≤–µ—Ä.com/api/action';
    let nextDaily = 0;
    let castCount = 0;

    function showToast(txt, isLong = false) {
        const t = document.getElementById('toast');
        t.innerText = txt; t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), isLong ? 5000 : 2500);
    }

    function showWood(txt) {
        const w = document.getElementById('wood-alert');
        w.innerText = txt; w.classList.add('show');
        setTimeout(() => w.classList.remove('show'), 3500);
    }

    function animateValue(id, start, end) {
        const obj = document.getElementById(id);
        let current = start;
        const range = end - start;
        const step = range / 20;
        const timer = setInterval(() => {
            current += step;
            if ((step > 0 && current >= end) || (step < 0 && current <= end)) {
                obj.innerText = Math.floor(end).toLocaleString();
                clearInterval(timer);
            } else {
                obj.innerText = Math.floor(current).toLocaleString();
            }
        }, 30);
    }

    async function doAction(action, extra = {}) {
        const res = await fetch(API, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ userId: tg.initDataUnsafe?.user?.id || "7883085758", action, ...extra })
        });
        const d = await res.json();
        if (d.msg) {
            // –õ–û–ì–ò–ö–ê –ò–ó –ü–£–ù–ö–¢–ê 4:
            if (action === 'catch_fish') showWood(d.msg); 
            else showToast(d.msg);
        }
        updateUI(d);
    }

    function updateUI(d) {
        const oldB = parseInt(document.getElementById('b1').innerText.replace(/\s/g, '')) || 0;
        animateValue('b1', oldB, d.b);
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('u-dur').innerText = d.durability + '%';
        document.getElementById('u-dur2').innerText = d.durability;
        document.getElementById('u-box').innerText = d.boxes;
        document.getElementById('u-fish').innerText = d.fish.toFixed(2);
        document.getElementById('u-lvl').innerText = d.level;
        nextDaily = d.lastBonus + 86400000;
        castCount = d.castCount;
    }

    function startFishing() {
        if ((castCount + 1) % 5 === 0) {
            showToast("–ü–û–ô–ú–ê–ô –ú–ï–®–û–ß–ï–ö! üß∫", true); // –°–≤–µ—Ä—Ö—É –ø—Ä–∏ –∫–∞–ø—á–µ
            const bag = document.getElementById('captcha-bag');
            const lake = document.getElementById('lake');
            bag.style.left = Math.random() * (lake.clientWidth - 80) + "px";
            bag.style.top = Math.random() * (lake.clientHeight - 80) + "px";
            bag.style.display = 'block';
            document.getElementById('cast-btn').disabled = true;
        } else {
            const anim = document.getElementById('fishAnim');
            anim.style.display = 'block';
            setTimeout(() => {
                anim.style.display = 'none';
                doAction('catch_fish');
            }, 1200);
        }
    }

    function catchBag() {
        document.getElementById('captcha-bag').style.display = 'none';
        document.getElementById('cast-btn').disabled = false;
        doAction('catch_fish', {captchaPassed: true});
    }

    // –¢–ê–ô–ú–ï–†–´
    setInterval(() => {
        const now = Date.now();
        // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
        const diff = nextDaily - now;
        if (diff > 0) {
            const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
            document.getElementById('daily-timer').innerText = `–ë–û–ù–£–°: ${h}:${m}:${s}`;
            document.getElementById('btn-daily').disabled = true;
        } else {
            document.getElementById('daily-timer').innerText = `–ë–û–ù–£–°: –ì–û–¢–û–í!`;
            document.getElementById('btn-daily').disabled = false;
        }

        // –ó–æ–ª–æ—Ç–æ–π —á–∞—Å (–¥–æ 19:00)
        const d = new Date();
        if (d.getHours() === 19) {
            document.getElementById('gh-timer').innerText = "–ó–û–õ–û–¢–û–ô –ß–ê–°: –ê–ö–¢–ò–í–ï–ù! üî•";
        } else {
            let target = new Date(); target.setHours(19, 0, 0, 0);
            if (d.getHours() >= 19) target.setDate(target.getDate() + 1);
            const gDiff = target - d;
            const gh = Math.floor(gDiff/3600000), gm = Math.floor((gDiff%3600000)/60000), gs = Math.floor((gDiff%60000)/1000);
            document.getElementById('gh-timer').innerText = `–î–û –ó–û–õ–û–¢–û–ì–û –ß–ê–°–ê: ${gh}:${gm}:${gs}`;
        }
    }, 1000);

    function showPage(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }
    
    // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    doAction('load');
</script>
</body>
</html>
