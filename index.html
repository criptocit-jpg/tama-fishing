<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Fishing 6.2.1</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --dark: #0a0e1a; --wood: #5d4037; --glass: rgba(255,255,255,0.07); }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }
        
        /* –°–¢–†–ê–ù–ò–¶–´ */
        .page { display: none; height: 100vh; padding: 15px; box-sizing: border-box; flex-direction: column; padding-bottom: 110px; }
        .page.active { display: flex; }
        
        /* –ü–õ–ê–®–ö–ê –ö–û–†–Ø–ì–ê */
        #wood-plate {
            position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: var(--wood); border: 3px solid #3e2723; border-radius: 12px;
            padding: 15px; text-align: center; width: 75%; z-index: 2000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #wood-plate.show { transform: translate(-50%, -50%) scale(1); }

        /* –ê–ö–ö–û–†–î–ï–û–ù (–ú–ê–ì–ê–ó–ò–ù) */
        .acc-item { background: var(--glass); border-radius: 12px; margin-bottom: 8px; border: 1px solid rgba(255,255,255,0.1); overflow: hidden; }
        .acc-head { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; background: rgba(255,255,255,0.02); }
        .acc-body { display: none; padding: 10px; grid-template-columns: 1fr 1fr; gap: 8px; border-top: 1px solid rgba(255,255,255,0.1); }
        .acc-item.open .acc-body { display: grid; }

        /* –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –¢–ê–ô–ú–ï–†–û–í */
        .top-row { display: flex; justify-content: space-between; font-size: 11px; color: var(--gold); margin-bottom: 10px; font-family: monospace; }
        
        /* –ó–û–ù–ê –õ–û–í–õ–ò */
        .lake-zone { flex-grow: 1; position: relative; background: radial-gradient(circle, #1a2a44 0%, #0a0e1a 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; border: 1px solid rgba(0,136,204,0.2); }
        #fish-anim { width: 100px; display: none; }
        
        /* –ö–ù–û–ü–ö–ò */
        .btn-cast { width: 100%; padding: 20px; background: var(--gold); border: none; border-radius: 18px; font-weight: 900; font-size: 18px; color: #000; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn-daily { background: #2e7d32; color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; margin-bottom: 10px; font-weight: bold; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: #0d121f; display: flex; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #5a6275; text-decoration: none; transition: 0.3s; }
        .nav-item.active { color: var(--gold); background: rgba(255,215,0,0.03); }
        .nav-item i { font-size: 22px; font-style: normal; margin-bottom: 3px; }
        
        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .stat-mini { background: var(--glass); padding: 8px; border-radius: 8px; text-align: center; font-size: 11px; }
        .shop-btn { background: #2e7d32; color: white; border: none; padding: 5px; border-radius: 5px; width: 100%; margin-top: 5px; font-size: 10px; font-weight: bold; }
        
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--gold); color: #000; padding: 10px 20px; border-radius: 20px; display:none; z-index:3000; font-weight:bold; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 12px; margin-bottom: 8px; background: rgba(0,0,0,0.3); border: 1px solid #333; color: #fff; border-radius: 8px; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="toast" class="toast"></div>

<div id="wood-plate" onclick="this.classList.remove('show')">
    <div style="font-size:10px; opacity:0.7; color:white;">–í–´ –í–´–õ–û–í–ò–õ–ò:</div>
    <p id="catch-res" style="font-size: 22px; font-weight: 900; margin: 10px 0;"></p>
    <div style="font-size:9px; color:var(--gold);">–ö–õ–ò–ö–ù–ò–¢–ï, –ß–¢–û–ë–´ –ó–ê–ë–†–ê–¢–¨</div>
</div>

<div id="p-game" class="page active">
    <div class="top-row">
        <div>–ó–û–õ–û–¢–û–ô –ß–ê–°: <b id="t-gold">--:--:--</b></div>
        <div>–ë–û–ù–£–°: <b id="t-daily">--:--:--</b></div>
    </div>
    
    <div style="text-align:center; margin-bottom:10px;">
        <div id="u-b" style="font-size:36px; font-weight:900; color:var(--gold);">0</div>
        <div style="font-size:10px; opacity:0.5; letter-spacing: 1px;">TAMACON BALANCE</div>
    </div>

    <div style="display:flex; gap:5px; margin-bottom:10px;">
        <div class="stat-mini" style="flex:1;">‚ö° <span id="u-en">0</span></div>
        <div class="stat-mini" style="flex:1;">üõ†Ô∏è <span id="u-dur">0%</span></div>
        <div class="stat-mini" style="flex:1;">üì¶ <span id="u-box">0</span></div>
    </div>

    <div class="lake-zone">
        <img src="fish_anim.webp" id="fish-anim">
        <div id="status" style="opacity:0.4; font-weight: bold;">–û–ö–ï–ê–ù –ñ–î–ï–¢</div>
    </div>

    <div style="margin-top: auto;">
        <button id="btn-daily" class="btn-daily" onclick="api('get_daily')">–ó–ê–ë–†–ê–¢–¨ –ë–û–ù–£–° üéÅ</button>
        <button id="btn-cast" class="btn-cast" onclick="doCast()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
    </div>
</div>

<div id="p-sadok" class="page">
    <div class="acc-item open">
        <div class="acc-head">üêü –í–ê–® –£–õ–û–í</div>
        <div class="acc-body" style="display:flex; justify-content:space-between; grid-template-columns:none; align-items: center;">
            <span>–†—ã–±–∞ –≤ —Å–∞–¥–∫–µ: <b id="u-fish">0</b> –∫–≥</span>
            <button onclick="api('sell')" style="background:var(--gold); border:none; padding:10px 15px; border-radius:8px; font-weight:bold; color:#000;">–ü–†–û–î–ê–¢–¨</button>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)">üõí –ú–ê–ì–ê–ó–ò–ù TC <span>‚ñº</span></div>
        <div class="acc-body">
            <div class="stat-mini"><b>–ú—è–∫–∏—à</b>100 TC<button class="shop-btn" onclick="api('buy',{id:'myakish'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–°–Ω–∞—Å—Ç–∏</b>200 TC<button class="shop-btn" onclick="api('buy',{id:'gear'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–≠–Ω–µ—Ä–≥–∏—è</b>50 TC<button class="shop-btn" onclick="api('buy',{id:'energy'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–†–µ–º–æ–Ω—Ç</b>50 TC<button class="shop-btn" onclick="api('buy',{id:'repair'})">–ö–£–ü–ò–¢–¨</button></div>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)" style="color:var(--gold)">üíé VIP STARS <span>‚ñº</span></div>
        <div class="acc-body">
            <div class="stat-mini"><b>–¢–∏—Ç–∞–Ω</b>150 ‚≠ê<button class="shop-btn" onclick="api('buy',{id:'titan'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–ü—Ä–∏–∫–æ—Ä–º</b>200 ‚≠ê<button class="shop-btn" onclick="api('buy',{id:'bait'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–°–Ω–∞—Å—Ç–∏+</b>200 ‚≠ê<button class="shop-btn" onclick="api('buy',{id:'strong'})">–ö–£–ü–ò–¢–¨</button></div>
            <div class="stat-mini"><b>–û–∑–µ—Ä–æ</b>500 ‚≠ê<button class="shop-btn" onclick="api('buy',{id:'license'})">–ö–£–ü–ò–¢–¨</button></div>
        </div>
    </div>

    <div class="acc-item">
        <div class="acc-head" onclick="toggleAcc(this)">üí≥ –í–´–í–û–î <span>‚ñº</span></div>
        <div class="acc-body" style="grid-template-columns:1fr;">
            <input id="w-wallet" placeholder="–ù–æ–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞ (TON)">
            <input id="w-sum" type="number" placeholder="–°—É–º–º–∞ TC">
            <button onclick="withdraw()" style="background:#0088cc; color:white; border:none; padding:12px; border-radius:10px; width:100%; font-weight: bold;">–°–û–ó–î–ê–¢–¨ –ó–ê–Ø–í–ö–£</button>
        </div>
    </div>
</div>

<div id="p-top" class="page">
    <h2 style="text-align:center; color:var(--gold);">üèÜ –¢–û–ü 10 –†–´–ë–ê–ö–û–í</h2>
    <div id="top-list"></div>
</div>

<div id="p-info" class="page">
    <h2 style="color:var(--gold);">–ò–ù–§–û–†–ú–ê–¶–ò–Ø</h2>
    <div class="acc-item open">
        <div class="acc-head">–û–ë –ò–ì–†–ï</div>
        <div class="acc-body" style="display:block; font-size:13px; line-height: 1.5;">
            –õ–æ–≤–∏ —Ä—ã–±—É, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π TC –∏ –≤—ã–≤–æ–¥–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å! <br><br>
            <b>üî• –ó–æ–ª–æ—Ç–æ–π —á–∞—Å:</b> –í 19:00 –ø–æ —Å–µ—Ä–≤–µ—Ä—É —É–ª–æ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞.<br>
            <b>üë®‚Äçüë©‚Äçüëß –†–µ—Ñ–µ—Ä–∞–ª—ã:</b> –ü–æ–ª—É—á–∞–π 10% –æ—Ç –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–∏ —Ä—ã–±—ã —Ç–≤–æ–∏–º–∏ –¥—Ä—É–∑—å—è–º–∏.
        </div>
    </div>
    <div style="margin-top:20px; font-size:11px; opacity: 0.6;">–í–ê–®–ê –ü–†–ò–ì–õ–ê–°–ò–¢–ï–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê:</div>
    <div id="ref-link" style="background:rgba(255,255,255,0.05); padding:12px; border-radius:10px; word-break:break-all; font-size:11px; color:var(--gold); border: 1px dashed rgba(255,215,0,0.3); margin-top: 5px;"></div>
</div>

<nav>
    <a href="javascript:void(0)" class="nav-item active" onclick="showP('p-game',this)"><i>üéÆ</i>–ò–ì–†–ê</a>
    <a href="javascript:void(0)" class="nav-item" onclick="showP('p-sadok',this)"><i>üéí</i>–°–ê–î–û–ö</a>
    <a href="javascript:void(0)" class="nav-item" onclick="showP('p-top',this)"><i>üèÜ</i>–¢–û–ü</a>
    <a href="javascript:void(0)" class="nav-item" onclick="showP('p-info',this)"><i>‚ÑπÔ∏è</i>–ò–ù–§–û</a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const URL = 'https://tama-bot-server.onrender.com/api/action';
    let user = { lastBonus: 0 };

    tg.ready();
    tg.expand();

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
    function showP(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞
    function toggleAcc(el) {
        el.parentElement.classList.toggle('open');
    }

    // –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function toast(txt) {
        const t = document.getElementById('toast');
        t.innerText = txt;
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2500);
    }

    // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
    async function api(action, payload = {}) {
        try {
            const uid = tg.initDataUnsafe?.user?.id || "7883085758";
            const uname = tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫";
            
            const r = await fetch(URL, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ userId: uid, userName: uname, action, payload })
            });
            
            if (!r.ok) throw new Error("–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç");
            const d = await r.json();
            
            if (d.msg) toast(d.msg);
            render(d);
            
            if (d.catchData) {
                const w = document.getElementById('wood-plate');
                document.getElementById('catch-res').innerHTML = d.catchData.type + '<br>' + d.catchData.w + ' –∫–≥';
                w.classList.add('show');
            }
        } catch(e) { 
            console.error("API Error:", e);
            // –î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –Ω–µ –¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É "–∑–∞–≤–∏—Å–Ω—É—Ç—å"
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    function render(d) {
        if (!d || !d.id) return;
        user = d;
        document.getElementById('u-b').innerText = Math.floor(d.b).toLocaleString();
        document.getElementById('u-fish').innerText = (d.fish || 0).toFixed(2);
        document.getElementById('u-en').innerText = d.energy || 0;
        document.getElementById('u-dur').innerText = Math.max(0, d.dur || 0) + '%';
        document.getElementById('u-box').innerText = d.boxes || 0;
        document.getElementById('ref-link').innerText = "https://t.me/TamacoinBot?start=" + d.id;
        
        if(d.top) {
            document.getElementById('top-list').innerHTML = d.top.map((x,i)=>
                `<div class="stat-mini" style="margin-bottom:5px; display:flex; justify-content:space-between; align-items:center;"><span>${i+1}. ${x.n}</span><b>${Math.floor(x.b)} TC</b></div>`
            ).join('');
        }
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–±—Ä–æ—Å–∞
    function doCast() {
        const f = document.getElementById('fish-anim');
        const b = document.getElementById('btn-cast');
        const s = document.getElementById('status');
        
        f.style.display = 'block';
        b.disabled = true;
        s.innerText = "–ó–ê–ë–†–û–° –õ–ï–°–ö–ò...";
        s.style.opacity = "1";

        setTimeout(() => {
            f.style.display = 'none';
            b.disabled = false;
            s.innerText = "–û–ö–ï–ê–ù –°–ü–û–ö–û–ï–ù";
            s.style.opacity = "0.4";
            api('cast');
        }, 1300);
    }

    // –õ–æ–≥–∏–∫–∞ –≤—ã–≤–æ–¥–∞
    function withdraw() {
        const wallet = document.getElementById('w-wallet').value;
        const sum = document.getElementById('w-sum').value;
        if(!wallet || !sum) {
            toast("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
            return;
        }
        api('withdraw', {wallet, sum: parseInt(sum)});
    }

    // –¢–∞–π–º–µ—Ä—ã (–ó–æ–ª–æ—Ç–æ–π —á–∞—Å –∏ –ë–æ–Ω—É—Å)
    setInterval(() => {
        const now = new Date();
        
        // 1. –ó–æ–ª–æ—Ç–æ–π —á–∞—Å (–¥–æ 19:00)
        let target = new Date();
        target.setHours(19,0,0,0);
        if (now > target) target.setDate(target.getDate() + 1);
        let diff = target - now;
        
        const h = String(Math.floor(diff/3600000)).padStart(2,'0');
        const m = String(Math.floor((diff%3600000)/60000)).padStart(2,'0');
        const s = String(Math.floor((diff%60000)/1000)).padStart(2,'0');
        
        document.getElementById('t-gold').innerText = (now.getHours() === 19) ? "–ê–ö–¢–ò–í–ï–ù! üî•" : h + ":" + m + ":" + s;
        
        // 2. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
        let bDiff = (user.lastBonus + 86400000) - Date.now();
        if(bDiff > 0) {
            const bh = String(Math.floor(bDiff/3600000)).padStart(2,'0');
            const bm = String(Math.floor((bDiff%3600000)/60000)).padStart(2,'0');
            const bs = String(Math.floor((bDiff%60000)/1000)).padStart(2,'0');
            document.getElementById('t-daily').innerText = bh + ":" + bm + ":" + bs;
            document.getElementById('btn-daily').style.display = 'none';
        } else {
            document.getElementById('t-daily').innerText = "–ì–û–¢–û–í";
            document.getElementById('btn-daily').style.display = 'block';
        }
    }, 1000);

    // –°–∞–º—ã–π –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—Ö–æ–¥–µ
    api('load');
</script>
</body>
</html>
