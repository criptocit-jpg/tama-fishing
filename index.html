<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Fishing</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --dark: #0a0e1a; --wood: #5d4037; --glass: rgba(255,255,255,0.07); }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }
        
        /* –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ */
        #news-line { background: rgba(0,0,0,0.5); color: var(--gold); padding: 8px 0; font-size: 11px; border-bottom: 1px solid #1e2638; overflow: hidden; white-space: nowrap; }
        #news-content { display: inline-block; animation: marquee 25s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }

        .page { display: none; height: calc(100vh - 75px); padding: 15px; box-sizing: border-box; flex-direction: column; overflow-y: auto; }
        .page.active { display: flex; }

        /* –ü–ª–∞—à–∫–∞ —É–ª–æ–≤–∞ */
        #wood-plate { position: fixed; top: 45%; left: 50%; transform: translate(-50%, -50%) scale(0); background: var(--wood); border: 4px solid #3e2723; border-radius: 15px; padding: 25px; text-align: center; width: 260px; z-index: 2000; box-shadow: 0 0 50px rgba(0,0,0,0.8); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #wood-plate.show { transform: translate(-50%, -50%) scale(1); }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ª–æ–∫–∞—Ü–∏–π */
        .loc-tabs { display: flex; background: rgba(0,0,0,0.3); padding: 4px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #1e2638; }
        .tab { flex: 1; padding: 10px; text-align: center; border-radius: 8px; font-size: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .tab.active { background: var(--gold); color: black; box-shadow: 0 2px 10px rgba(255,215,0,0.3); }

        .lake-zone { height: 220px; position: relative; background: radial-gradient(circle, #1a2a44 0%, #000 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; border: 1px solid #1e3a5f; transition: 0.5s; overflow: hidden; }
        #fish-anim { width: 80px; display: none; filter: drop-shadow(0 0 10px var(--gold)); }

        .btn-cast { width: 100%; padding: 20px; background: var(--gold); border: none; border-radius: 18px; font-weight: 900; font-size: 20px; color: #000; text-transform: uppercase; }
        .btn-cast:disabled { background: #444; color: #888; }

        .timer-badge { font-size: 10px; opacity: 0.6; margin-top: 5px; }

        nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: #070a14; display: flex; border-top: 1px solid #1e2638; padding-bottom: 10px; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; color: #4a5265; text-decoration: none; }
        .nav-item.active { color: var(--gold); }
    </style>
</head>
<body>

<div id="news-line"><div id="news-content">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–∫–µ–∞–Ω–∞...</div></div>

<div id="wood-plate" onclick="this.classList.remove('show')">
    <div style="font-size:12px; color:#cfd8dc; text-transform:uppercase; letter-spacing:1px;">–í–µ–ª–∏–∫–æ–ª–µ–ø–Ω—ã–π —É–ª–æ–≤!</div>
    <div id="catch-name" style="font-size:18px; font-weight:bold; margin:10px 0; color:var(--gold);">–†—ã–±–∞</div>
    <div id="catch-weight" style="font-size:32px; font-weight:900; color:white;">0.00 –∫–≥</div>
    <div style="margin-top:15px; font-size:10px; color:#8d6e63;">–ö–õ–ò–ö–ù–ò, –ß–¢–û–ë–´ –ó–ê–ë–†–ê–¢–¨</div>
</div>

<div id="p-game" class="page active">
    <div style="text-align:center; margin-bottom:10px;">
        <div id="u-b" style="font-size:48px; font-weight:900; color:var(--gold);">0</div>
        <div style="font-size:11px; opacity:0.5; letter-spacing:2px;">TAMACON COINS</div>
    </div>

    <div style="display:flex; gap:10px; margin-bottom:15px;">
        <div style="flex:1; background:var(--glass); padding:10px; border-radius:15px; text-align:center;">
            <div style="font-size:18px;">‚ö° <span id="u-en">0</span></div>
            <div id="en-timer" class="timer-badge">FULL</div>
        </div>
        <div style="flex:1; background:var(--glass); padding:10px; border-radius:15px; text-align:center;">
            <div style="font-size:18px;">üõ†Ô∏è <span id="u-dur">0</span>%</div>
            <div class="timer-badge">–ü–†–û–ß–ù–û–°–¢–¨</div>
        </div>
    </div>

    <div class="loc-tabs">
        <div id="tab-sea" class="tab active" onclick="setLoc('sea')">üåä –ú–û–†–ï</div>
        <div id="tab-lake" class="tab" onclick="setLoc('hope_lake')">‚ú® –û–ó–ï–†–û VIP</div>
    </div>

    <div id="ocean" class="lake-zone">
        <img src="https://cdn-icons-png.flaticon.com/512/2274/2274532.png" id="fish-anim">
    </div>

    <button id="btn-cast" class="btn-cast" onclick="doCast()">–ó–ê–ë–†–û–°–ò–¢–¨ üé£</button>
    <button id="btn-daily" style="width:100%; padding:15px; margin-top:10px; background:#2e7d32; border:none; border-radius:15px; color:white; font-weight:bold; display:none;" onclick="api('get_daily')">üéÅ –ë–û–ù–£–°</button>
</div>

<div id="p-shop" class="page">
    <h2 style="color:var(--gold)">–ú–ê–ì–ê–ó–ò–ù</h2>
    <div style="background:var(--glass); padding:20px; border-radius:15px; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
        <div>
            <b>–í–ê–® –°–ê–î–û–ö</b><br>
            <span id="u-fish" style="font-size:20px;">0</span> –∫–≥
        </div>
        <button onclick="api('sell')" style="background:var(--gold); border:none; padding:10px 20px; border-radius:10px; font-weight:bold;">–ü–†–û–î–ê–¢–¨ –í–°–Å</button>
    </div>

    <div style="background:var(--glass); padding:15px; border-radius:15px; margin-bottom:10px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span>üé´ –õ–∏—Ü–µ–Ω–∑–∏—è –û–∑–µ—Ä–æ</span>
            <button onclick="api('request_buy',{id:'license'})" style="background:#0088cc; color:white; border:none; padding:8px 15px; border-radius:10px; font-weight:bold;">1 TON</button>
        </div>
        <p style="font-size:10px; opacity:0.6; margin-top:5px;">–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –û–∑–µ—Ä—É –ù–∞–¥–µ–∂–¥—ã —Å –∫—Ä—É–ø–Ω–æ–π —Ä—ã–±–æ–π.</p>
    </div>

    <div style="background:var(--glass); padding:15px; border-radius:15px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span>üõ†Ô∏è –ü–æ–ª–Ω—ã–π —Ä–µ–º–æ–Ω—Ç</span>
            <button onclick="api('repair')" style="background:#444; color:white; border:none; padding:8px 15px; border-radius:10px; font-weight:bold;">50 TC</button>
        </div>
    </div>
</div>

<div id="p-info" class="page">
    <h2 style="color:var(--gold)">–¢–û–ü –†–´–ë–ê–ö–û–í</h2>
    <div id="top-list" style="background:var(--glass); border-radius:15px; padding:10px;"></div>
    
    <div style="margin-top:20px; background:rgba(255,215,0,0.05); padding:15px; border-radius:15px; border:1px dashed var(--gold);">
        <div style="font-size:11px; color:var(--gold);">–†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê:</div>
        <div id="ref-link" style="font-size:11px; word-break:break-all; margin-top:5px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
</div>

<nav>
    <a href="#" class="nav-item active" onclick="showP('p-game',this)">–ò–ì–†–ê</a>
    <a href="#" class="nav-item" onclick="showP('p-shop',this); api('load');">–ú–ê–ì–ê–ó–ò–ù</a>
    <a href="#" class="nav-item" onclick="showP('p-info',this); api('get_top');">–¢–û–ü</a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const URL = 'https://tama-bot-server.onrender.com/api/action';
    let user = {}; let currentLoc = 'sea';
    tg.expand();

    async function api(action, payload = {}) {
        const uid = tg.initDataUnsafe?.user?.id || "123";
        const uname = tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫";
        try {
            const r = await fetch(URL, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ userId: uid, userName: uname, action, payload })
            });
            const d = await r.json();
            if (d.msg) tg.showAlert(d.msg);
            if (d.top) renderTop(d.top); else render(d);
            if (d.catchData) showCatch(d.catchData);
        } catch(e) { console.error(e); }
    }

    function render(d) {
        user = d;
        document.getElementById('u-b').innerText = Math.floor(d.b).toLocaleString();
        document.getElementById('u-fish').innerText = (d.fish || 0).toFixed(2);
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('u-dur').innerText = d.dur;
        document.getElementById('news-content').innerText = d.logs ? d.logs.join('  ‚Ä¢  ') : "";
        document.getElementById('ref-link').innerText = "https://t.me/tama_fishing_2026_bot?start=" + d.id;
        
        // –õ–æ–≥–∏–∫–∞ –±–æ–Ω—É—Å–∞
        const nextB = d.lastBonus + 86400000;
        const bBtn = document.getElementById('btn-daily');
        if (Date.now() > nextB) {
            bBtn.style.display = 'block'; bBtn.innerText = "üéÅ –ü–û–õ–£–ß–ò–¢–¨ –ë–û–ù–£–°";
        } else {
            bBtn.style.display = 'block'; bBtn.style.background = '#333';
            updateBonusTimer(nextB);
        }
    }

    function updateBonusTimer(next) {
        const bBtn = document.getElementById('btn-daily');
        const itv = setInterval(() => {
            const left = next - Date.now();
            if (left <= 0) { clearInterval(itv); render(user); return; }
            const h = Math.floor(left/3600000);
            const m = Math.floor((left%3600000)/60000);
            const s = Math.floor((left%60000)/1000);
            bBtn.innerText = `üéÅ ${h}—á ${m}–º ${s}—Å`;
        }, 1000);
    }

    function showCatch(c) {
        document.getElementById('catch-name').innerText = c.type;
        document.getElementById('catch-weight').innerText = c.w;
        document.getElementById('wood-plate').classList.add('show');
    }

    function doCast() {
        if (user.energy < 2) return tg.showAlert("‚ö° –ú–∞–ª–æ —ç–Ω–µ—Ä–≥–∏–∏!");
        const f = document.getElementById('fish-anim');
        const b = document.getElementById('btn-cast');
        f.style.display = 'block'; b.disabled = true;
        setTimeout(() => { f.style.display = 'none'; b.disabled = false; api('cast', { location: currentLoc }); }, 1300);
    }

    function setLoc(l) {
        currentLoc = l;
        document.getElementById('tab-sea').classList.toggle('active', l === 'sea');
        document.getElementById('tab-lake').classList.toggle('active', l === 'hope_lake');
        document.getElementById('ocean').style.background = (l === 'hope_lake') 
            ? 'radial-gradient(circle, #2c3e50 0%, #000 100%)' 
            : 'radial-gradient(circle, #1a2a44 0%, #000 100%)';
    }

    function renderTop(top) {
        document.getElementById('top-list').innerHTML = top.map((p, i) => `
            <div style="display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid rgba(255,255,255,0.05);">
                <span>${i+1}. ${p.n}</span>
                <b style="color:var(--gold)">${p.b} TC</b>
            </div>
        `).join('');
    }

    function showP(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    api('load');
</script>
</body>
</html>
