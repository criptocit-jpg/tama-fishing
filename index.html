<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tama Fishing Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; background: #070b1a; color: white; font-family: sans-serif; overflow: hidden; }
        .page { display: none; height: 100vh; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .page.active { display: flex; }
        
        /* –ö–æ—Ä–æ–±–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ */
        .box-container { display: flex; justify-content: space-around; margin-top: 20px; display: none; }
        .box { width: 80px; height: 80px; background: #ffd700; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 40px; box-shadow: 0 5px 15px gold; }
        
        /* –ú–æ–¥–∞–ª–∫–∞ –≤—ã–≤–æ–¥–∞ */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); display:none; z-index:2000; align-items:center; justify-content:center; }
        .modal-content { background: #1a2235; padding: 25px; border-radius: 20px; width: 80%; }
        
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #444; background: #0d1425; color: white; }
        .btn { background: #4CAF50; border: none; padding: 15px; border-radius: 12px; color: white; font-weight: bold; width: 100%; margin-top: 10px; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 75px; background: #000; display: flex; border-top: 1px solid #333; }
        .nav-item { flex: 1; text-align: center; color: #555; font-size: 10px; display: flex; flex-direction: column; justify-content: center; }
        .nav-item.active { color: #ffd700; }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: #fff; color: #000; padding: 10px 20px; border-radius: 50px; font-weight: bold; transition: 0.5s; z-index: 9999; }
        #toast.show { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>
    <div id="toast"></div>

    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <h3>–í–´–í–û–î –°–†–ï–î–°–¢–í</h3>
            <input type="text" id="wallet" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ TON">
            <input type="number" id="wAmount" placeholder="–°—É–º–º–∞ (min 30000)">
            <button class="btn" onclick="submitWithdraw()">–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£</button>
            <button class="btn" style="background:#444" onclick="closeModal()">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>

    <div id="p-game" class="page active">
        <div style="text-align: center; font-size: 32px; color: gold; font-weight: bold;"><span id="b1">0.00</span> TC</div>
        <div style="display:flex; justify-content: space-between; margin: 15px 0;">
            <div class="card">‚≠ê –†–∞–Ω–≥: <span id="u-lvl">1</span></div>
            <div class="card">üîã –≠–Ω–µ—Ä–≥–∏—è: <span id="u-en">0</span></div>
        </div>
        
        <div style="flex-grow:1; display:flex; align-items:center; justify-content:center;">
            <img src="fish_anim.webp" id="fishAnim" style="width:250px; display:none;">
            <div id="idle-text">üåä –ó–∞–∫–∏–¥—ã–≤–∞–π!</div>
        </div>

        <div id="refBoxes" class="box-container">
            <div class="box" onclick="pickBox()">üéÅ</div>
            <div class="box" onclick="pickBox()">üéÅ</div>
            <div class="box" onclick="pickBox()">üéÅ</div>
        </div>

        <button class="btn" id="cBtn" onclick="doFish()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
    </div>

    <div id="p-sadok" class="page">
        <h2>üéí –°–ê–î–û–ö</h2>
        <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:15px;">
            <p>üêü –í–µ—Å —É–ª–æ–≤–∞: <span id="s-fish">0.00</span> –∫–≥</p>
            <p>üîß –°–æ—Å—Ç–æ—è–Ω–∏–µ: <span id="s-rod">100</span>%</p>
        </div>
        <button class="btn" onclick="doAction('sell_fish')">–ü–†–û–î–ê–¢–¨ –í–°–Å üí∞</button>
        <button class="btn" style="background:#e53935" onclick="openModal()">–í–´–í–ï–°–¢–ò TC üí≥</button>
    </div>

    <div id="p-shop" class="page">
        <h2>üõí –ú–ê–ì–ê–ó–ò–ù</h2>
        <button class="btn" onclick="shareRef()">üîó –ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê (+üéÅ)</button>
        <button class="btn" style="background:#0288d1" onclick="doAction('repair_rod')">–ü–û–ß–ò–ù–ò–¢–¨ (10 TC)</button>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="tab('game', this)">üéÆ –ò–ì–†–ê</div>
        <div class="nav-item" onclick="tab('sadok', this)">üéí –°–ê–î–û–ö</div>
        <div class="nav-item" onclick="tab('shop', this)">üõí –ú–ê–ì–ê–ó–ò–ù</div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    const url = 'https://tama-bot-server.onrender.com/api/action';
    tg.ready(); tg.expand();

    // –ó–≤—É–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–π –∫–æ—Ä–æ—Ç–∫–∏–µ mp3 —Å—Å—ã–ª–∫–∏)
    const s_catch = new Audio('https://www.myinstants.com/media/sounds/splash.mp3');
    const s_sell = new Audio('https://www.myinstants.com/media/sounds/coins.mp3');

    function showToast(txt) {
        const t = document.getElementById('toast'); t.innerText = txt;
        t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000);
    }

    async function load() {
        const r = await fetch(`${url}?userId=${tg.initDataUnsafe?.user?.id || "569502967"}`);
        const d = await r.json();
        updateUI(d);
    }

    function updateUI(d) {
        document.getElementById('b1').innerText = d.balance.toFixed(2);
        document.getElementById('u-lvl').innerText = d.level;
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('s-fish').innerText = d.fish.toFixed(2);
        document.getElementById('s-rod').innerText = d.rod_durability;
    }

    async function doAction(act, extra = {}) {
        const r = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ userId: tg.initDataUnsafe?.user?.id || "569502967", action: act, ...extra })
        });
        const d = await r.json();
        if (d.msg) showToast(d.msg);
        if (act === 'sell_fish') s_sell.play();
        updateUI(d);
        return d;
    }

    async function doFish() {
        const btn = document.getElementById('cBtn');
        btn.disabled = true;
        s_catch.play();
        const data = await doAction('catch_fish');
        document.getElementById('fishAnim').style.display = 'block';
        document.getElementById('idle-text').style.display = 'none';
        
        setTimeout(() => {
            document.getElementById('fishAnim').style.display = 'none';
            document.getElementById('idle-text').style.display = 'block';
            btn.disabled = false;
        }, 2500);
    }

    function openModal() { document.getElementById('withdrawModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('withdrawModal').style.display = 'none'; }

    async function submitWithdraw() {
        const wallet = document.getElementById('wallet').value;
        const amount = document.getElementById('wAmount').value;
        if (!wallet || amount < 30000) return showToast("–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö");
        await doAction('withdraw', { wallet, amount });
        closeModal();
    }

    function shareRef() {
        const link = `https://t.me/Tama_fishing_2026_bot?start=${tg.initDataUnsafe?.user?.id || ""}`;
        tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=–õ–æ–≤–∏ —Ä—ã–±—É –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π TC!`);
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ—Ä–æ–±–∫–∏ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
        document.getElementById('refBoxes').style.display = 'flex';
    }

    function pickBox() {
        showToast("üéÅ –í—ã –ø–æ–ª—É—á–∏–ª–∏ 500 TC!");
        document.getElementById('refBoxes').style.display = 'none';
        // –¢—É—Ç –º–æ–∂–Ω–æ –¥–µ—Ä–Ω—É—Ç—å doAction –Ω–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–∞
    }

    function tab(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('p-' + id).classList.add('active');
        el.classList.add('active');
    }

    load();
</script>
</body>
</html>
