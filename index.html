<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Fishing Gold - Monolith v4.2.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* * ==========================================
         * –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò
         * ==========================================
         */
        :root {
            --gold: #FFD700;
            --gold-dark: #B8860B;
            --blue: #0088CC;
            --blue-dark: #005580;
            --bg: #050810;
            --bg-sea: radial-gradient(circle at center, #001a33 0%, #050810 100%);
            --glass: rgba(255, 255, 255, 0.06);
            --glass-border: rgba(255, 255, 255, 0.12);
            --red: #e91e63;
            --green: #4caf50;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--bg);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* * ==========================================
         * –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò –û–í–ï–†–õ–ï–ò
         * ==========================================
         */
        #toast {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(-150%);
            background: var(--gold);
            color: #000;
            padding: 14px 28px;
            border-radius: 30px;
            font-weight: 800;
            font-size: 14px;
            z-index: 10000;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
            text-transform: uppercase;
        }

        #toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* –ê–ù–ò–ú–ê–¶–ò–Ø –û–¢–ö–†–´–¢–ò–Ø –Ø–©–ò–ö–ê */
        #box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            backdrop-filter: blur(10px);
        }

        .box-container {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .box-img {
            width: 160px;
            filter: drop-shadow(0 0 30px var(--gold));
            animation: box-shake 0.6s infinite ease-in-out;
        }

        @keyframes box-shake {
            0% { transform: rotate(0); }
            15% { transform: rotate(8deg); }
            30% { transform: rotate(-8deg); }
            45% { transform: rotate(6deg); }
            60% { transform: rotate(-6deg); }
            100% { transform: rotate(0); }
        }

        .prize-display {
            display: none;
            text-align: center;
            animation: prize-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes prize-pop {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1.2); opacity: 1; }
        }

        .prize-value {
            font-size: 48px;
            font-weight: 900;
            color: var(--gold);
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            margin-bottom: 10px;
        }

        /* * ==========================================
         * –°–¢–†–£–ö–¢–£–†–ê –°–¢–†–ê–ù–ò–¶
         * ==========================================
         */
        .page {
            display: none;
            height: 100vh;
            flex-direction: column;
            padding: 25px 20px 100px 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .page.active {
            display: flex;
        }

        .header-info {
            text-align: center;
            margin-top: 10px;
            flex-shrink: 0;
        }

        .loc-tag {
            color: var(--gold);
            font-size: 12px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .balance-label {
            font-size: 10px;
            color: #8892b0;
            letter-spacing: 3px;
            font-weight: 700;
        }

        .balance-val {
            font-size: 46px;
            font-weight: 900;
            color: #fff;
        }

        .balance-val span {
            color: var(--gold);
        }

        /* * ==========================================
         * –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê
         * ==========================================
         */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .stat-item {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 12px 5px;
            text-align: center;
        }

        .stat-item small {
            font-size: 9px;
            color: #556080;
            display: block;
            margin-bottom: 4px;
            font-weight: 800;
        }

        .stat-item b {
            font-size: 16px;
            font-weight: 800;
        }

        .fishing-area {
            flex-grow: 1;
            position: relative;
            background: rgba(0,0,0,0.2);
            border-radius: 30px;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: background 1s ease;
        }

        .fishing-area.sea-mode {
            background: var(--bg-sea);
            border: 1px solid var(--blue);
            box-shadow: inset 0 0 50px rgba(0, 136, 204, 0.2);
        }

        #fish-anim {
            width: 200px;
            display: none;
            filter: drop-shadow(0 0 30px var(--blue));
        }

        #bag-captcha {
            position: absolute;
            width: 70px;
            height: 70px;
            display: none;
            z-index: 100;
            filter: drop-shadow(0 0 20px var(--gold));
            cursor: pointer;
            animation: bag-float 2s infinite ease-in-out;
        }

        @keyframes bag-float {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.1); }
        }

        /* * ==========================================
         * –ú–ê–ì–ê–ó–ò–ù –ò –¢–û–í–ê–†–´
         * ==========================================
         */
        .shop-section-title {
            font-size: 14px;
            font-weight: 800;
            color: #8892b0;
            margin: 20px 0 10px 5px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
        }

        .shop-section-title.stars { color: #00d2ff; }

        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .shop-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 22px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: 0.2s;
        }

        .shop-card:active { transform: scale(0.95); }

        .shop-card b {
            font-size: 14px;
            margin-bottom: 4px;
            display: block;
        }

        .shop-card small {
            font-size: 10px;
            color: #556080;
            margin-bottom: 12px;
            line-height: 1.2;
            height: 24px;
            display: block;
        }

        .btn-buy {
            border: none;
            border-radius: 12px;
            padding: 8px 15px;
            width: 100%;
            font-weight: 800;
            font-size: 12px;
            cursor: pointer;
        }

        .btn-buy.tc { background: white; color: black; }
        .btn-buy.star { background: linear-gradient(90deg, #00d2ff, #3a7bd5); color: white; }

        /* * ==========================================
         * –ö–ù–û–ü–ö–ò –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø
         * ==========================================
         */
        .bottom-wrap {
            margin-top: 15px;
            flex-shrink: 0;
        }

        .btn-action {
            width: 100%;
            border: none;
            border-radius: 25px;
            padding: 20px;
            font-size: 18px;
            font-weight: 900;
            color: white;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            transition: 0.2s;
        }

        .btn-blue { background: linear-gradient(180deg, var(--blue), var(--blue-dark)); }
        .btn-gold { background: linear-gradient(180deg, var(--gold), var(--gold-dark)); color: black; margin-bottom: 10px;}

        .navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 85px;
            background: rgba(5, 8, 16, 0.98);
            display: flex;
            border-top: 1px solid var(--glass-border);
            z-index: 4000;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #556080;
            text-decoration: none;
            transition: 0.3s;
        }

        .nav-item.active { color: var(--gold); }
        .nav-item span { font-size: 24px; margin-bottom: 4px; }
        .nav-item label { font-size: 10px; font-weight: 800; text-transform: uppercase; }

    </style>
</head>
<body>

    <div id="toast"></div>

    <div id="box-overlay">
        <div class="box-container" id="box-stage">
            <img src="https://cdn-icons-png.flaticon.com/512/679/679821.png" class="box-img" id="main-box-img">
        </div>
        <div class="prize-display" id="prize-stage">
            <div class="prize-value" id="prize-num">+0 TC</div>
            <div style="font-size: 14px; color: #8892b0; margin-bottom: 30px;">–£–õ–û–í –ò–ó –Ø–©–ò–ö–ê –î–û–ë–ê–í–õ–ï–ù!</div>
            <button class="btn-action btn-gold" style="width: 220px;" onclick="closeBox()">–û–¢–õ–ò–ß–ù–û!</button>
        </div>
    </div>

    <div id="game" class="page active">
        <div class="header-info">
            <div id="current-loc" class="loc-tag">üìç –û–ó–ï–†–û –ù–ê–î–ï–ñ–î–´</div>
            <div class="balance-label">–í–ê–® –ë–ê–õ–ê–ù–°</div>
            <div class="balance-val"><span id="u-bal">0</span> <span>TC</span></div>
        </div>

        <div class="stats-grid">
            <div class="stat-item">
                <small>–≠–ù–ï–†–ì–ò–Ø</small>
                <b id="u-en">0</b>
            </div>
            <div class="stat-item">
                <small>–ü–†–û–ß–ù–û–°–¢–¨</small>
                <b id="u-dur">0%</b>
            </div>
            <div class="stat-item">
                <small>–Ø–©–ò–ö–ò</small>
                <b id="u-box" style="color:var(--gold)">0</b>
            </div>
        </div>

        <div class="fishing-area" id="water-zone">
            <img src="https://cdn-icons-png.flaticon.com/512/2953/2953363.png" id="bag-captcha" onclick="handleBagClick()">
            <img src="https://cdn-icons-png.flaticon.com/512/2271/2271253.png" id="fish-anim">
            <div id="status-text" style="position:absolute; bottom:20px; font-size:12px; font-weight:800; color:rgba(255,255,255,0.4)">–ì–û–¢–û–í –ö –ó–ê–ë–†–û–°–£</div>
        </div>

        <div class="bottom-wrap">
            <button id="daily-btn" class="btn-action btn-gold" onclick="apiAction('get_daily')">
                –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° üéÅ
            </button>
            <button id="cast-btn" class="btn-action btn-blue" onclick="startFishing()">
                –ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£
            </button>
        </div>
    </div>

    <div id="shop" class="page">
        <h2 style="margin: 10px 0 5px 0;">–ú–ê–ì–ê–ó–ò–ù</h2>
        <p style="font-size: 12px; color: #8892b0; margin-bottom: 20px;">–£–ª—É—á—à–∞–π —Å–Ω–∞—Å—Ç–∏ –∏ –ø–æ–∫—É–ø–∞–π –¥–æ—Å—Ç—É–ø –≤ –Ω–æ–≤—ã–µ –≤–æ–¥—ã</p>

        <div class="shop-section-title">üì¶ –ó–ê –ò–ì–†–û–í–´–ï TC</div>
        <div class="shop-grid">
            <div class="shop-card">
                <b>–ú—è–∫–∏—à</b>
                <small>5 –∑–∞–±—Ä–æ—Å–æ–≤ –±–µ–∑ –ø—Ä–æ–º–∞—Ö–∞</small>
                <button class="btn-buy tc" onclick="apiAction('buy_tc', {itemId:'bread'})">50 TC</button>
            </div>
            <div class="shop-card">
                <b>–ú–∞—Å–ª–æ</b>
                <small>–°–Ω–∏–∂–∞–µ—Ç –∏–∑–Ω–æ—Å –Ω–∞ 50%</small>
                <button class="btn-buy tc" onclick="apiAction('buy_tc', {itemId:'oil'})">150 TC</button>
            </div>
            <div class="shop-card">
                <b>–£–¥–∞—á–∞</b>
                <small>–®–∞–Ω—Å —è—â–∏–∫–∞ +10%</small>
                <button class="btn-buy tc" onclick="apiAction('buy_tc', {itemId:'hook'})">500 TC</button>
            </div>
            <div class="shop-card">
                <b>–û–±–µ–¥</b>
                <small>–ü–æ–ª–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è (100)</small>
                <button class="btn-buy tc" onclick="apiAction('buy_tc', {itemId:'meal'})">800 TC</button>
            </div>
        </div>

        <div class="shop-section-title stars">‚≠êÔ∏è –ó–ê PREMIUM (STARS)</div>
        <div class="shop-grid">
            <div class="shop-card">
                <b>–í –ú–û–†–ï</b>
                <small>–î–æ—Å—Ç—É–ø –≤ –ª–æ–∫–∞—Ü–∏—é –ú–æ—Ä–µ</small>
                <button class="btn-buy star" onclick="apiAction('buy_stars', {itemId:'sea_pass'})">‚≠êÔ∏è 250</button>
            </div>
            <div class="shop-card">
                <b>–ö–æ–Ω—Ç—Ä–∞–∫—Ç</b>
                <small>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ +20%</small>
                <button class="btn-buy star" onclick="apiAction('buy_stars', {itemId:'contract'})">‚≠êÔ∏è 500</button>
            </div>
            <div class="shop-card">
                <b>–≠—Ö–æ–ª–æ—Ç</b>
                <small>–í–∏–¥–µ—Ç—å —Ä—ã–±—É –∑–∞—Ä–∞–Ω–µ–µ</small>
                <button class="btn-buy star" onclick="apiAction('buy_stars', {itemId:'sonar'})">‚≠êÔ∏è 150</button>
            </div>
            <div class="shop-card">
                <b>–¢–∏—Ç–∞–Ω</b>
                <small>–í–µ—á–Ω–∞—è —É–¥–æ—á–∫–∞</small>
                <button class="btn-buy star" onclick="apiAction('buy_stars', {itemId:'rod'})">‚≠êÔ∏è 1000</button>
            </div>
            <div class="shop-card">
                <b>–ú–∞–≥–Ω–∏—Ç</b>
                <small>X2 —à–∞–Ω—Å —è—â–∏–∫–æ–≤</small>
                <button class="btn-buy star" onclick="apiAction('buy_stars', {itemId:'magnet'})">‚≠êÔ∏è 400</button>
            </div>
            <div class="shop-card">
                <b>–ù–∞–±–æ—Ä</b>
                <small>5–∫ TC + 10 —è—â–∏–∫–æ–≤</small>
                <button class="btn-buy star" onclick="apiAction('buy_stars', {itemId:'bundle'})">‚≠êÔ∏è 800</button>
            </div>
        </div>
        
        <div style="height: 50px;"></div>
    </div>

    <div id="inventory" class="page">
        <h2>–ò–ù–í–ï–ù–¢–ê–†–¨</h2>
        <div class="stat-item" style="margin-bottom: 20px; padding: 20px;">
            <small>–í–ê–® –£–õ–û–í</small>
            <b id="u-fish-kg" style="font-size: 24px;">0.00 –∫–≥</b>
            <button class="btn-action btn-blue" style="margin-top: 15px; padding: 15px; font-size: 14px;" onclick="apiAction('sell_fish')">
                –ü–†–û–î–ê–¢–¨ –†–´–ë–£
            </button>
        </div>

        <div class="shop-section-title">–ê–ö–¢–ò–í–ù–´–ï –ë–£–°–¢–´</div>
        <div id="active-boosts" style="font-size: 12px; color: #8892b0; padding-left: 10px;">
            –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        </div>

        <div class="shop-section-title">–°–ï–†–í–ò–°</div>
        <button class="btn-action btn-gold" style="padding: 15px; font-size: 14px;" onclick="apiAction('repair')">
            –ü–û–ß–ò–ù–ò–¢–¨ –£–î–û–ß–ö–£ (50 TC)
        </button>
        
        <div class="shop-section-title">–û–¢–ö–†–´–¢–¨ –Ø–©–ò–ö–ò</div>
        <button id="box-btn-menu" class="btn-action btn-blue" style="background: var(--gold); color: black;" onclick="openBoxAnimation()">
            –û–¢–ö–†–´–¢–¨ –î–û–°–¢–£–ü–ù–´–ô –Ø–©–ò–ö
        </button>
    </div>

    <nav class="navbar">
        <a href="#" class="nav-item active" onclick="switchPage('game', this)">
            <span>üé£</span><label>–†—ã–±–∞–ª–∫–∞</label>
        </a>
        <a href="#" class="nav-item" onclick="switchPage('shop', this)">
            <span>üõí</span><label>–ú–∞–≥–∞–∑–∏–Ω</label>
        </a>
        <a href="#" class="nav-item" onclick="switchPage('inventory', this)">
            <span>üéí</span><label>–ú–µ–Ω—é</label>
        </a>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        const API_URL = 'https://tama-bot-server.onrender.com/api/action';
        let userData = {};

        tg.ready();
        tg.expand();

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function switchPage(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        async function apiAction(action, extra = {}) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: tg.initDataUnsafe?.user?.id || "7883085758",
                        userName: tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫",
                        action,
                        ...extra
                    })
                });
                const data = await response.json();
                userData = data;
                
                if (data.msg && action !== 'load') showToast(data.msg);
                renderUI(data);
                return data;
            } catch (e) {
                console.error("API Error:", e);
            }
        }

        function renderUI(d) {
            document.getElementById('u-bal').innerText = Math.floor(d.b).toLocaleString();
            document.getElementById('u-en').innerText = Math.floor(d.energy);
            document.getElementById('u-dur').innerText = Math.floor(d.durability) + '%';
            document.getElementById('u-box').innerText = d.boxes;
            document.getElementById('u-fish-kg').innerText = (d.fish || 0).toFixed(2) + ' –∫–≥';
            
            // –õ–æ–∫–∞—Ü–∏—è
            const zone = document.getElementById('water-zone');
            const locText = document.getElementById('current-loc');
            if (d.location === 'sea') {
                zone.classList.add('sea-mode');
                locText.innerText = "üåä –ì–õ–£–ë–û–ö–û–ï –ú–û–†–ï";
            } else {
                zone.classList.remove('sea-mode');
                locText.innerText = "üìç –û–ó–ï–†–û –ù–ê–î–ï–ñ–î–´";
            }

            // –ë—É—Å—Ç—ã
            const boostList = document.getElementById('active-boosts');
            let boosts = [];
            if (d.inventory?.oil > 0) boosts.push(`–ú–∞—Å–ª–æ (${d.inventory.oil} –∏—Å–ø.)`);
            if (d.inventory?.bread > 0) boosts.push(`–ù–∞–∂–∏–≤–∫–∞ (${d.inventory.bread} –∏—Å–ø.)`);
            if (d.inventory?.contract) boosts.push(`VIP –ö–æ–Ω—Ç—Ä–∞–∫—Ç (–ê–∫—Ç–∏–≤–µ–Ω)`);
            boostList.innerHTML = boosts.length > 0 ? boosts.join(' ‚Ä¢ ') : "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤";
        }

        function startFishing() {
            if ((userData.castCount + 1) % 5 === 0) {
                showToast("–ö–õ–Æ–ù–£–õ–û! –õ–û–í–ò –ú–ï–®–û–ß–ï–ö!");
                const b = document.getElementById('bag-captcha');
                b.style.display = 'block';
                b.style.left = (Math.random() * 70 + 10) + '%';
                b.style.top = (Math.random() * 50 + 20) + '%';
                tg.HapticFeedback.notificationOccurred('warning');
            } else {
                const fish = document.getElementById('fish-anim');
                fish.style.display = 'block';
                tg.HapticFeedback.impactOccurred('heavy');
                setTimeout(() => {
                    fish.style.display = 'none';
                    apiAction('catch_fish');
                }, 1200);
            }
        }

        function handleBagClick() {
            document.getElementById('bag-captcha').style.display = 'none';
            apiAction('catch_fish', { captchaPassed: true });
        }

        async function openBoxAnimation() {
            if (userData.boxes <= 0) return showToast("–ù–ï–¢ –î–û–°–¢–£–ü–ù–´–• –Ø–©–ò–ö–û–í!");
            
            const overlay = document.getElementById('box-overlay');
            const boxStage = document.getElementById('box-stage');
            const prizeStage = document.getElementById('prize-stage');
            const boxImg = document.getElementById('main-box-img');
            
            overlay.style.display = 'flex';
            boxStage.style.display = 'flex';
            prizeStage.style.display = 'none';
            boxImg.style.animation = 'box-shake 0.6s infinite ease-in-out';

            const result = await apiAction('open_box');
            
            setTimeout(() => {
                boxStage.style.display = 'none';
                prizeStage.style.display = 'block';
                document.getElementById('prize-num').innerText = `+${result.prize || 0} TC`;
                tg.HapticFeedback.notificationOccurred('success');
            }, 2000);
        }

        function closeBox() {
            document.getElementById('box-overlay').style.display = 'none';
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        setInterval(() => apiAction('load'), 10000);
        apiAction('load');

    </script>
</body>
</html>
