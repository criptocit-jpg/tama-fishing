<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Gold 3.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --blue: #0088CC; --bg: #050810; --glass: rgba(255,255,255,0.08); }
        body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; user-select: none; }
        
        .page { display: none; height: 100vh; padding: 20px; box-sizing: border-box; flex-direction: column; padding-bottom: 100px; }
        .active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .header-ui { text-align: center; margin-bottom: 10px; }
        .balance-val { font-size: 44px; font-weight: 900; color: var(--gold); }
        .level-badge { background: var(--glass); border: 1px solid var(--gold); padding: 3px 10px; border-radius: 20px; font-size: 10px; color: var(--gold); }

        .timer-box { font-size: 11px; color: #8892b0; margin-top: 5px; font-family: monospace; }

        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .stat-item { background: var(--glass); padding: 12px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .stat-item small { display: block; font-size: 9px; color: #8892b0; text-transform: uppercase; }
        .stat-item b { font-size: 18px; }

        .fishing-area { flex-grow: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        #fishAnim { width: 100%; max-height: 80%; object-fit: contain; display: none; filter: drop-shadow(0 0 30px var(--blue)); }

        /* –°–ê–î–û–ö –ò –ü–†–û–î–ê–ñ–ê */
        .market-box { background: rgba(0, 136, 204, 0.1); border: 1px dashed var(--blue); border-radius: 15px; padding: 10px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        
        .risk-row { background: var(--glass); padding: 12px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }

        .btn { border: none; border-radius: 20px; font-weight: 800; font-size: 16px; cursor: pointer; width: 100%; transition: 0.2s; }
        .btn-blue { background: var(--blue); color: #fff; padding: 18px; box-shadow: 0 4px 15px rgba(0,136,204,0.3); }
        .btn-gold { background: var(--gold); color: #000; padding: 15px; margin-bottom: 8px; }
        .btn:active { transform: scale(0.97); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 80px; background: #000; display: flex; border-top: 1px solid #222; z-index: 1000; }
        .nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; text-decoration: none; }
        .nav-link.active { color: var(--gold); }
        .nav-link span { font-size: 20px; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; flex-direction: column; padding: 30px; z-index: 2000; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="game" class="page active">
    <div class="header-ui">
        <div id="u-level" class="level-badge">–ù–û–í–ò–ß–û–ö üé£</div>
        <div class="balance-val" id="b-val">0 TC</div>
        <div class="timer-box" id="timers">–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏...</div>
    </div>

    <div class="stats">
        <div class="stat-item"><small>–≠–Ω–µ—Ä–≥–∏—è</small><b id="u-en">0</b></div>
        <div class="stat-item"><small>–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</small><b id="u-art">0/5</b></div>
    </div>

    <div class="market-box">
        <div><small style="color:#8892b0">–í —Å–∞–¥–∫–µ:</small> <b id="u-fish">0.00</b> –∫–≥</div>
        <button onclick="doAction('sell_fish')" style="background:var(--blue); border:none; color:#fff; border-radius:10px; padding:5px 10px; font-size:10px; font-weight:800;">–ü–†–û–î–ê–¢–¨</button>
    </div>

    <div class="fishing-area">
        <img src="fish_anim.webp" id="fishAnim">
    </div>

    <div class="risk-row">
        <div style="font-size:12px;"><b>–ì–õ–£–ë–û–ö–û–í–û–î–ù–´–ô –†–ï–ñ–ò–ú</b><br><small style="color:#888">–†–∏—Å–∫ –æ–±—Ä—ã–≤–∞ | –£–ª–æ–≤ x10</small></div>
        <input type="checkbox" id="isDeep" style="width:25px; height:25px;">
    </div>

    <div class="bottom-ui">
        <button class="btn btn-gold" onclick="doAction('get_bonus')" id="btn-bonus">–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° üéÅ</button>
        <button class="btn btn-blue" onclick="startFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
    </div>
</div>

<div id="info" class="modal">
    <h2 style="color:var(--gold)">–ò–ù–§–û–†–ú–ê–¶–ò–Ø</h2>
    <p>‚Ä¢ 1 –∫–≥ —Ä—ã–±—ã = 0.5 TC<br>‚Ä¢ –í—ã–≤–æ–¥ –æ—Ç 30,000 TC<br>‚Ä¢ –ó–æ–ª–æ—Ç–æ–π —á–∞—Å: 19:00 (x2)</p>
    <button class="btn btn-blue" onclick="closeInfo()">–ó–ê–ö–†–´–¢–¨</button>
</div>

<nav class="navbar">
    <a href="#" class="nav-link active" onclick="showPage('game', this)"><span>üéÆ</span><label>–ò–ì–†–ê</label></a>
    <a href="#" class="nav-link" onclick="openInfo()"><span>‚ÑπÔ∏è</span><label>–ò–ù–§–û</label></a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const API = 'https://tama-bot-server.onrender.com/api/action';
    let userB = 0;
    let nextBonusTime = 0;

    function openInfo() { document.getElementById('info').style.display = 'flex'; }
    function closeInfo() { document.getElementById('info').style.display = 'none'; }

    function formatTime(ms) {
        if (ms <= 0) return "00:00:00";
        let h = Math.floor(ms / 3600000).toString().padStart(2, '0');
        let m = Math.floor((ms % 3600000) / 60000).toString().padStart(2, '0');
        let s = Math.floor((ms % 60000) / 1000).toString().padStart(2, '0');
        return `${h}:${m}:${s}`;
    }

    function updateTimers() {
        const now = new Date();
        // –ó–æ–ª–æ—Ç–æ–π —á–∞—Å (19:00)
        let goldText = "";
        if(now.getHours() === 19) {
            goldText = "üåü –ó–û–õ–û–¢–û–ô –ß–ê–° –ò–î–ï–¢!";
        } else {
            let goldDate = new Date();
            goldDate.setHours(19,0,0,0);
            if(now > goldDate) goldDate.setDate(goldDate.getDate()+1);
            goldText = "–î–æ –ó–æ–ª–æ—Ç–æ–≥–æ —á–∞—Å–∞: " + formatTime(goldDate - now);
        }

        // –ë–æ–Ω—É—Å
        let bonusText = (nextBonusTime - now.getTime() > 0) 
            ? "–ë–æ–Ω—É—Å —á–µ—Ä–µ–∑: " + formatTime(nextBonusTime - now.getTime()) 
            : "–ë–æ–Ω—É—Å –≥–æ—Ç–æ–≤! üéÅ";

        document.getElementById('timers').innerText = `${goldText} | ${bonusText}`;
    }

    async function doAction(action) {
        const res = await fetch(API, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                userId: tg.initDataUnsafe?.user?.id || "7883085758",
                action, isDeep: document.getElementById('isDeep').checked
            })
        });
        const d = await res.json();
        if(d.msg) tg.showAlert(d.msg);
        updateUI(d);
    }

    function updateUI(d) {
        document.getElementById('b-val').innerText = Math.floor(d.b).toLocaleString() + " TC";
        document.getElementById('u-en').innerText = d.energy;
        document.getElementById('u-fish').innerText = d.fish.toFixed(2);
        document.getElementById('u-art').innerText = d.artifacts.length + "/5";
        nextBonusTime = d.lastBonus + 86400000;
        
        const levels = ["–ù–û–í–ò–ß–û–ö üé£", "–†–´–ë–ê–ö üõ∂", "–ü–†–û–§–ò üõ•Ô∏è", "–ú–ê–°–¢–ï–† üö¢", "–õ–ï–ì–ï–ù–î–ê üëë"];
        document.getElementById('u-level').innerText = levels[Math.min(4, Math.floor(d.b / 10000))];
    }

    function startFishing() {
        const a = document.getElementById('fishAnim');
        a.style.display = 'block';
        tg.HapticFeedback.impactOccurred('heavy');
        setTimeout(() => { a.style.display = 'none'; doAction('catch_fish'); }, 1300);
    }

    setInterval(updateTimers, 1000);
    doAction('load');
</script>
</body>
</html>
