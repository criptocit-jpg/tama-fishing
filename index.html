<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tamacoin Fishing Gold - MONOLITH v4.2.2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ==========================================
           –ë–ê–ó–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –ò –¶–í–ï–¢–ê
           ========================================== */
        :root {
            --gold: #FFD700;
            --gold-dark: #B8860B;
            --blue: #0088CC;
            --blue-dark: #005580;
            --bg: #050810;
            --glass: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.12);
            --red: #e91e63;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--bg);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* ==========================================
           –®–ê–ü–ö–ê –ò –°–¢–ê–¢–£–° –†–´–ë–ê–ö–ê (–¢–û –ß–¢–û –¢–´ –ü–†–û–°–ò–õ)
           ========================================== */
        .header-top {
            background: linear-gradient(180deg, #1a1f2c 0%, #050810 100%);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--glass-border);
        }

        .user-info-block {
            display: flex;
            flex-direction: column;
        }

        #u-name-display {
            font-size: 14px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rank-badge {
            background: var(--gold);
            color: #000;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 900;
            margin-top: 4px;
            display: inline-block;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        /* –¢–ê–ô–ú–ï–†–´ –ò –ë–û–ù–£–°–´ */
        .timer-row {
            display: flex;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(0,0,0,0.2);
        }

        .timer-card {
            flex: 1;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 8px;
            border-radius: 12px;
            text-align: center;
        }

        .timer-card small {
            display: block;
            font-size: 9px;
            color: #8892b0;
            text-transform: uppercase;
            font-weight: 700;
        }

        .timer-card b {
            font-size: 13px;
            color: var(--gold);
        }

        /* ==========================================
           –ë–ê–õ–ê–ù–° –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê
           ========================================== */
        .balance-section {
            text-align: center;
            padding: 30px 0;
            background: radial-gradient(circle at center, rgba(0, 136, 204, 0.1) 0%, transparent 70%);
        }

        .balance-label {
            font-size: 11px;
            color: #556080;
            letter-spacing: 3px;
            font-weight: 800;
        }

        .balance-main {
            font-size: 50px;
            font-weight: 900;
            margin-top: 5px;
        }

        .balance-main span {
            color: var(--gold);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            padding: 0 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 15px 5px;
            border-radius: 20px;
            text-align: center;
        }

        .stat-box small {
            display: block;
            font-size: 9px;
            color: #556080;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-box b {
            font-size: 18px;
            font-weight: 800;
        }

        /* ==========================================
           –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê (–í–û–î–ê)
           ========================================== */
        .lake-container {
            margin: 0 15px;
            height: 220px;
            background: rgba(0,0,0,0.4);
            border-radius: 35px;
            border: 1px solid var(--glass-border);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .lake-container.sea-mode {
            background: radial-gradient(circle, #001a33 0%, #050810 100%);
            border-color: var(--blue);
            box-shadow: inset 0 0 50px rgba(0, 136, 204, 0.3);
        }

        #bag-captcha {
            position: absolute;
            width: 75px;
            display: none;
            filter: drop-shadow(0 0 20px var(--gold));
            cursor: pointer;
            z-index: 500;
            animation: float-bag 2s infinite ease-in-out;
        }

        @keyframes float-bag {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.1); }
        }

        .status-indicator {
            position: absolute;
            bottom: 20px;
            font-size: 12px;
            font-weight: 800;
            color: rgba(255,255,255,0.3);
            text-transform: uppercase;
        }

        /* ==========================================
           –°–¢–†–ê–ù–ò–¶–´ –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø
           ========================================== */
        .page {
            display: none;
            height: 100vh;
            flex-direction: column;
            overflow-y: auto;
            padding-bottom: 120px;
            box-sizing: border-box;
        }

        .page.active {
            display: flex;
        }

        .action-btn {
            width: 90%;
            margin: 10px auto;
            border: none;
            border-radius: 25px;
            padding: 20px;
            font-size: 18px;
            font-weight: 900;
            color: white;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .btn-blue { background: linear-gradient(180deg, var(--blue), var(--blue-dark)); }
        .btn-gold { background: linear-gradient(180deg, var(--gold), var(--gold-dark)); color: black; }
        .action-btn:active { transform: scale(0.96); }

        /* –ú–ê–ì–ê–ó–ò–ù */
        .shop-title {
            padding: 20px;
            font-size: 14px;
            font-weight: 900;
            color: #8892b0;
            text-transform: uppercase;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 0 15px;
        }

        .shop-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 15px;
            text-align: center;
        }

        .shop-card b { font-size: 15px; display: block; margin-bottom: 5px; }
        .shop-card small { font-size: 11px; color: #556080; display: block; margin-bottom: 15px; min-height: 30px; }

        .buy-btn {
            border: none;
            border-radius: 12px;
            padding: 10px;
            width: 100%;
            font-weight: 800;
            cursor: pointer;
        }

        /* –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê */
        .ref-panel {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, transparent 100%);
            margin: 15px;
            padding: 25px;
            border-radius: 30px;
            border: 1px dashed var(--gold);
            text-align: center;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–Ø –û–¢–ö–†–´–¢–ò–Ø –Ø–©–ò–ö–ê */
        #box-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .box-image {
            width: 180px;
            filter: drop-shadow(0 0 30px var(--gold));
            animation: shake-box 0.5s infinite;
        }

        @keyframes shake-box {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }

        .prize-announcement {
            text-align: center;
            display: none;
            animation: pop-prize 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop-prize {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 85px;
            background: rgba(10, 14, 23, 0.98);
            display: flex;
            border-top: 1px solid var(--glass-border);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-link {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #444;
            text-decoration: none;
            transition: 0.3s;
        }

        .nav-link.active { color: var(--gold); }
        .nav-link span { font-size: 24px; margin-bottom: 5px; }
        .nav-link label { font-size: 10px; font-weight: 800; text-transform: uppercase; }

    </style>
</head>
<body>

    <div id="box-modal">
        <div id="box-opening-stage">
            <img src="https://cdn-icons-png.flaticon.com/512/679/679821.png" class="box-image">
            <h2 style="color:var(--gold); margin-top:30px;">–†–ê–°–ü–ê–ö–û–í–ö–ê...</h2>
        </div>
        <div id="box-prize-stage" class="prize-announcement">
            <div id="prize-text" style="font-size: 54px; font-weight: 900; color: var(--gold);">+500 TC</div>
            <p style="color: #8892b0; margin-bottom: 30px;">–£–õ–û–í –î–û–ë–ê–í–õ–ï–ù –í –ö–û–®–ï–õ–ï–ö</p>
            <button class="action-btn btn-gold" style="width: 200px;" onclick="closeBoxModal()">–û–¢–õ–ò–ß–ù–û</button>
        </div>
    </div>

    <div id="page-game" class="page active">
        <div class="header-top">
            <div class="user-info-block">
                <div id="u-name-display">–ó–ê–ì–†–£–ó–ö–ê...</div>
                <div class="rank-badge" id="u-rank-display">–°–ê–õ–ê–ì–ê üå±</div>
            </div>
            <div style="text-align: right">
                <div style="font-size: 9px; color: #556080; font-weight: 800;">STATUS</div>
                <div style="font-size: 11px; color: var(--gold); font-weight: 800;">ONLINE</div>
            </div>
        </div>

        <div class="timer-row">
            <div class="timer-card"><small>–ó–æ–ª–æ—Ç–æ–π —á–∞—Å</small><b>19:00 - 20:00</b></div>
            <div class="timer-card"><small>–ë–æ–Ω—É—Å</small><b id="timer-daily-val">–ì–û–¢–û–í</b></div>
        </div>

        <div class="balance-section">
            <div class="balance-label">–¢–ï–ö–£–©–ò–ô –ë–ê–õ–ê–ù–°</div>
            <div class="balance-main"><span id="u-balance-val">0</span> <span>TC</span></div>
        </div>

        <div class="stats-grid">
            <div class="stat-box"><small>–≠–ù–ï–†–ì–ò–Ø</small><b id="u-energy-val">0</b></div>
            <div class="stat-box"><small>–ü–†–û–ß–ù–û–°–¢–¨</small><b id="u-durability-val">0%</b></div>
            <div class="stat-box"><small>–Ø–©–ò–ö–ò</small><b id="u-boxes-val" style="color:var(--gold)">0</b></div>
        </div>

        <div class="lake-container" id="main-water-zone">
            <img src="https://cdn-icons-png.flaticon.com/512/2953/2953363.png" id="bag-captcha" onclick="handleCaptchaClick()">
            <div class="status-indicator" id="fishing-status-text">–û–ñ–ò–î–ê–ù–ò–ï –ó–ê–ë–†–û–°–ê</div>
        </div>

        <button class="action-btn btn-blue" onclick="attemptFishing()">–ó–ê–ë–†–û–°–ò–¢–¨ –£–î–û–ß–ö–£ üé£</button>
        <button class="action-btn btn-gold" onclick="apiAction('get_daily')">–ó–ê–ë–†–ê–¢–¨ –ë–û–ù–£–° üéÅ</button>
    </div>

    <div id="page-shop" class="page">
        <h2 style="padding: 20px 20px 0 20px; margin: 0;">–ú–ê–†–ö–ï–¢</h2>
        <div class="shop-title">–°–ù–ê–†–Ø–ñ–ï–ù–ò–ï (TC)</div>
        <div class="shop-grid">
            <div class="shop-card">
                <b>–•–ª–µ–±–Ω—ã–π –º—è–∫–∏—à</b>
                <small>5 –∑–∞–±—Ä–æ—Å–æ–≤ –±–µ–∑ –æ—Å–µ—á–µ–∫</small>
                <button class="buy-btn btn-blue" onclick="apiAction('buy_tc', {itemId:'bread'})">50 TC</button>
            </div>
            <div class="shop-card">
                <b>–¢–µ—Ö. –ú–∞—Å–ª–æ</b>
                <small>-50% –∏–∑–Ω–æ—Å–∞ —É–¥–æ—á–∫–∏</small>
                <button class="buy-btn btn-blue" onclick="apiAction('buy_tc', {itemId:'oil'})">150 TC</button>
            </div>
            <div class="shop-card">
                <b>–°—ã—Ç–Ω—ã–π –æ–±–µ–¥</b>
                <small>–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è 100</small>
                <button class="buy-btn btn-blue" onclick="apiAction('buy_tc', {itemId:'meal'})">800 TC</button>
            </div>
            <div class="shop-card">
                <b>–ù–∞–±–æ—Ä –∑–∞–ø—á–∞—Å—Ç–µ–π</b>
                <small>–†–µ–º–æ–Ω—Ç —É–¥–æ—á–∫–∏ –¥–æ 100%</small>
                <button class="buy-btn btn-blue" onclick="apiAction('repair')">50 TC</button>
            </div>
        </div>

        <div class="shop-title" style="color:var(--blue)">PREMIUM (STARS)</div>
        <div class="shop-grid">
            <div class="shop-card" style="border-color: var(--blue)">
                <b>–ë–∏–ª–µ—Ç –≤ –ú–æ—Ä–µ</b>
                <small>–î–æ—Å—Ç—É–ø –∫ –∫—Ä—É–ø–Ω–æ–º—É —É–ª–æ–≤—É</small>
                <button class="buy-btn btn-gold" onclick="apiAction('buy_stars', {itemId:'sea_pass'})">‚≠êÔ∏è 250</button>
            </div>
            <div class="shop-card" style="border-color: var(--blue)">
                <b>VIP –ö–æ–Ω—Ç—Ä–∞–∫—Ç</b>
                <small>+20% –∫ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä—ã–±—ã</small>
                <button class="buy-btn btn-gold" onclick="apiAction('buy_stars', {itemId:'contract'})">‚≠êÔ∏è 500</button>
            </div>
        </div>
        <div style="height: 50px;"></div>
    </div>

    <div id="page-profile" class="page">
        <h2 style="padding: 20px;">–ü–†–û–§–ò–õ–¨</h2>
        
        <div class="stat-box" style="margin: 0 15px; padding: 30px;">
            <small>–†–´–ë–ê –í –°–£–ú–ö–ï</small>
            <b id="u-fish-weight" style="font-size: 32px;">0.00 –ö–ì</b>
            <button class="action-btn btn-blue" style="margin-top: 20px; width: 100%;" onclick="apiAction('sell_fish')">–ü–†–û–î–ê–¢–¨ –í–ï–°–¨ –£–õ–û–í</button>
        </div>

        <div class="ref-panel">
            <div style="font-size: 16px; font-weight: 900; color: var(--gold); margin-bottom: 10px;">–ü–ê–†–¢–ù–ï–†–°–ö–ê–Ø –°–ï–¢–¨</div>
            <p style="font-size: 12px; color: #8892b0; margin-bottom: 20px;">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –∑–∞–±–∏—Ä–∞–π 10% –æ—Ç –∏—Ö –∑–∞—Ä–∞–±–æ—Ç–∫–∞!</p>
            <button class="action-btn btn-gold" style="font-size: 14px; padding: 15px;" onclick="copyReferralLink()">–ö–û–ü–ò–†–û–í–ê–¢–¨ –°–°–´–õ–ö–£</button>
        </div>

        <button class="action-btn btn-gold" style="background: var(--gold); color: black;" onclick="startBoxOpening()">–û–¢–ö–†–´–¢–¨ –î–û–ë–´–¢–´–ô –Ø–©–ò–ö</button>

        <div style="text-align: center; margin-top: 30px; padding: 20px; border-top: 1px solid var(--glass-border);">
            <div style="font-size: 10px; color: #333;">ACCOUNT ID: <span id="u-id-display">---</span></div>
            <div style="font-size: 10px; color: #333; margin-top: 5px;">PROTOCOL v4.2.2 STABLE</div>
        </div>
    </div>

    <nav class="nav-bar">
        <a href="#" class="nav-link active" onclick="switchTab('page-game', this)">
            <span>üé£</span><label>–†—ã–±–∞–ª–∫–∞</label>
        </a>
        <a href="#" class="nav-link" onclick="switchTab('page-shop', this)">
            <span>üõí</span><label>–ú–∞—Ä–∫–µ—Ç</label>
        </a>
        <a href="#" class="nav-link" onclick="switchTab('page-profile', this)">
            <span>üë§</span><label>–ü—Ä–æ—Ñ–∏–ª—å</label>
        </a>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        const API_ENDPOINT = 'https://tama-bot-server.onrender.com/api/action';
        let currentUserData = {};

        tg.ready();
        tg.expand();

        function switchTab(pageId, element) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            element.classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        async function apiAction(actionName, extraParams = {}) {
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: tg.initDataUnsafe?.user?.id || "7883085758",
                        userName: tg.initDataUnsafe?.user?.first_name || "–†—ã–±–∞–∫",
                        action: actionName,
                        ...extraParams
                    })
                });
                const data = await response.json();
                currentUserData = data;
                updateInterface();
                if (data.msg && actionName !== 'load') tg.showAlert(data.msg);
                return data;
            } catch (err) {
                console.error("API Error:", err);
            }
        }

        function updateInterface() {
            document.getElementById('u-balance-val').innerText = Math.floor(currentUserData.b).toLocaleString();
            document.getElementById('u-energy-val').innerText = Math.floor(currentUserData.energy);
            document.getElementById('u-durability-val').innerText = Math.floor(currentUserData.durability) + '%';
            document.getElementById('u-boxes-val').innerText = currentUserData.boxes;
            document.getElementById('u-fish-weight').innerText = (currentUserData.fish || 0).toFixed(2) + ' –ö–ì';
            
            document.getElementById('u-name-display').innerText = (currentUserData.n || "–†—ã–±–∞–∫").toUpperCase();
            document.getElementById('u-rank-display').innerText = currentUserData.level || "–°–ê–õ–ê–ì–ê üå±";
            document.getElementById('u-id-display').innerText = currentUserData.id;

            const waterZone = document.getElementById('main-water-zone');
            if (currentUserData.location === 'sea') {
                waterZone.classList.add('sea-mode');
            } else {
                waterZone.classList.remove('sea-mode');
            }
        }

        function attemptFishing() {
            if ((currentUserData.castCount + 1) % 5 === 0) {
                tg.HapticFeedback.notificationOccurred('warning');
                const bag = document.getElementById('bag-captcha');
                bag.style.display = 'block';
                bag.style.left = (Math.random() * 70 + 5) + '%';
                bag.style.top = (Math.random() * 50 + 10) + '%';
            } else {
                tg.HapticFeedback.impactOccurred('medium');
                apiAction('catch_fish');
            }
        }

        function handleCaptchaClick() {
            document.getElementById('bag-captcha').style.display = 'none';
            apiAction('catch_fish', { captchaPassed: true });
        }

        async function startBoxOpening() {
            if (currentUserData.boxes <= 0) return tg.showAlert("–£ –í–ê–° –ù–ï–¢ –î–û–°–¢–£–ü–ù–´–• –Ø–©–ò–ö–û–í!");
            
            const modal = document.getElementById('box-modal');
            const stage1 = document.getElementById('box-opening-stage');
            const stage2 = document.getElementById('box-prize-stage');
            
            modal.style.display = 'flex';
            stage1.style.display = 'flex';
            stage2.style.display = 'none';

            const result = await apiAction('open_box');

            setTimeout(() => {
                stage1.style.display = 'none';
                stage2.style.display = 'block';
                document.getElementById('prize-text').innerText = `+${result.prize} TC`;
                tg.HapticFeedback.notificationOccurred('success');
            }, 2000);
        }

        function closeBoxModal() {
            document.getElementById('box-modal').style.display = 'none';
            apiAction('load');
        }

        function copyReferralLink() {
            const link = `https://t.me/Tamacoin_bot?start=${currentUserData.id}`;
            const input = document.createElement("input");
            document.body.appendChild(input);
            input.value = link;
            input.select();
            document.execCommand("copy");
            document.body.removeChild(input);
            tg.showAlert("–†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê –°–ö–û–ü–ò–†–û–í–ê–ù–ê!");
        }

        // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        setInterval(() => apiAction('load'), 20000);
        apiAction('load');

    </script>
</body>
</html>
